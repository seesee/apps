<!doctype html><html lang="en-GB"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="app-version" content="2025.08.12.50"><link rel="icon" href="favicon.ico" type="image/x-icon"><title>Activity Tracker</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:url('data:image/svg+xml,<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><radialGradient id="bg" cx="35%" cy="30%" r="70%"><stop offset="0%" stop-color="%23b6a9ff"/><stop offset="100%" stop-color="%235a4fcf"/></radialGradient></defs><circle cx="32" cy="32" r="22" fill="url(%23bg)" stroke="%23b5adff" stroke-width="2"/><rect x="20" y="28" width="24" height="16" rx="3.5" fill="none" stroke="%235949bc" stroke-width="2"/><path d="M20 36h24M32 28v16" stroke="%235949bc" stroke-width="2" stroke-linecap="round" fill="none"/><circle cx="32" cy="26.5" r="8.0" fill="none" stroke="%23e6e4ff" stroke-width="1.5"/><path d="M32 26.5 L39.31 24.12" stroke="%23e6e4ff" stroke-width="1.2" stroke-linecap="round" fill="none"/><path d="M32 26.5 L31.45 20.9" stroke="%23e6e4ff" stroke-width="1.3" stroke-linecap="round" fill="none"/><circle cx="32" cy="26.5" r="1.15" fill="%23e6e4ff"/></svg>') center -50px/100vw auto no-repeat fixed,linear-gradient(135deg,#667eea 0,#764ba2 100%) 0 0/cover fixed;min-height:100vh;color:#333}hr{margin:15px 0;border:none;border-top:1px solid #e2e8f0;box-sizing:border-box;max-width:100%}.template-overlay hr{margin:10px 0;max-width:calc(100% - 20px)}.modal hr{margin:15px 0;max-width:calc(100% - 20px)}h2{margin-bottom:20px;padding-bottom:8px}h3{margin-bottom:16px;padding-bottom:6px}.container{max-width:1200px;margin:0 auto;padding:20px;background:rgba(255,255,255,.15);backdrop-filter:blur(1px);-webkit-backdrop-filter:blur(1px);border-radius:20px}.header{background:rgba(255,255,255,.75);backdrop-filter:blur(10px);border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 8px 32px rgba(0,0,0,.1);position:relative}.header .header-content{position:relative;z-index:1}.header .header-text{flex-grow:1}.header .header-text h1{margin:0 0 4px}.header .header-text p{margin:0}.nav{display:flex;justify-content:space-between;align-items:center;margin-top:15px;flex-wrap:wrap;gap:10px}.nav-left{display:flex;gap:15px;flex-shrink:0}.nav-right{display:flex;gap:10px;flex-shrink:0}.nav-btn{padding:10px 20px;border:none;background:#667eea;color:#fff;border-radius:8px;cursor:pointer;font-weight:500}.nav-btn:hover{background:#5a67d8;transform:translateY(-2px)}.nav-btn.active{background:#4c51bf;box-shadow:0 4px 15px rgba(76,81,191,.4)}.burger-anchor{position:absolute;top:0;right:0;width:1px;height:1px;pointer-events:none;visibility:hidden}.burger-menu{position:fixed;z-index:1000}.burger-btn{display:flex;flex-direction:column;justify-content:center;align-items:center;width:40px;height:40px;background:#667eea;border:none;border-radius:8px;cursor:pointer;transition:.3s;padding:8px}.burger-btn:hover{background:#5a67d8;transform:translateY(-2px)}.burger-line{width:20px;height:2px;background:#fff;margin:2px 0;transition:.3s;border-radius:1px}.burger-dropdown{position:absolute;top:100%;right:0;margin-top:4px;background:rgba(255,255,255,.9);backdrop-filter:blur(20px);border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,.15);z-index:1001;min-width:180px;overflow:hidden}.burger-item{display:block;width:100%;padding:12px 16px;background:0 0;border:none;text-align:left;color:#4a5568;font-weight:500;cursor:pointer;transition:background-color .2s}.burger-emoji{margin-right:8px}.burger-item:hover{background:#f7fafc;color:#2d3748}.dark-mode .burger-dropdown{background:rgba(26,32,44,.9);backdrop-filter:blur(20px);border:1px solid #4a5568}.dark-mode .burger-item{color:#e2e8f0}.dark-mode .burger-item:hover{background:#4a5568;color:#f7fafc}.burger-separator{height:1px;background:#e2e8f0;margin:8px 0}.dark-mode .burger-separator{background:#4a5568}.section{display:none;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-radius:15px;padding:30px;box-shadow:0 8px 32px rgba(0,0,0,.1)}.section.active{display:block}.form-group{margin-bottom:20px}.form-group-row{display:flex;gap:15px;margin-bottom:20px}.form-group-row .form-group{flex:1;margin-bottom:0}.notes-filters,.todo-filters{background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:20px;border:1px solid #e2e8f0}.filter-row{display:flex;gap:20px;align-items:center;flex-wrap:wrap}.filter-group{display:flex;align-items:center;gap:10px}.filter-group label{font-weight:600;color:#4a5568;margin:0;white-space:nowrap}.filter-group select{padding:8px 12px;border:2px solid #e2e8f0;border-radius:6px;font-size:14px;background:#fff;min-width:150px}.filter-group input{padding:8px 12px;border:2px solid #e2e8f0;border-radius:6px;font-size:14px;background:#fff;min-width:150px;transition:border-color .3s}.filter-group input:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.todo-stats{margin-bottom:15px;padding:10px 0;color:#666;font-size:14px}.todo-list{min-height:200px}.todo-item{background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:15px;transition:.2s;position:relative}.todo-item.todo-incomplete{border:1px solid #9b2c2c!important}.todo-item.todo-overdue{background:#fef5f5;border:1px solid #7b2d2d!important}.todo-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}.todo-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}.todo-content{flex:1}.todo-activity{font-size:16px;font-weight:600;color:#2d3748;margin-bottom:5px}.todo-description{color:#718096;font-size:14px;margin-bottom:10px;line-height:1.4}.todo-meta{display:flex;gap:15px;flex-wrap:wrap;font-size:12px;color:#a0aec0;margin-bottom:10px}.todo-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px}.todo-tag{background:#38a169;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;cursor:pointer;transition:.2s}.todo-tag:hover{background:#2f855a;transform:scale(1.05)}.todo-actions{display:flex;gap:8px;align-items:center}.entries-pagination,.todo-pagination{display:flex;justify-content:center;align-items:center;gap:20px;margin-top:30px;padding:20px 0}.entries-pagination .nav-btn,.notes-pagination .nav-btn,.report-navigation .nav-btn,.search-pagination .nav-btn,.todo-pagination .nav-btn{min-width:120px;text-align:center}.global-search{margin:20px auto;max-width:600px}@media (max-width:768px){.global-search{margin:15px 0;max-width:100%}}.search-container{position:relative;display:flex;align-items:center;gap:10px;flex-wrap:wrap}#globalSearch{flex:1;padding:15px 20px;border:2px solid #e2e8f0;border-radius:25px;font-size:16px;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.05);transition:.3s}.hashtag-browser-btn{padding:12px;background:#667eea;color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:16px;transition:.3s;flex-shrink:0}.hashtag-browser-btn:hover{background:#5a67d8;transform:scale(1.05)}#hashtagBrowserModal .hashtag-cloud{padding:20px;line-height:1.8;text-align:center;max-height:400px;overflow-y:auto}.hashtag-cloud-item{display:inline-block;margin:5px 8px;padding:4px 12px;background:rgba(255,255,255,.1);border:1px solid currentColor;border-radius:15px;cursor:pointer;transition:.3s;text-decoration:none;white-space:nowrap;font-weight:600;box-shadow:0 2px 4px rgba(0,0,0,.1)}.hashtag-cloud-item:hover{transform:scale(1.05) translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.2);background:rgba(255,255,255,.2)}.dark-mode .hashtag-cloud-item{background:rgba(0,0,0,.2)}.dark-mode .hashtag-cloud-item:hover{background:rgba(0,0,0,.3);box-shadow:0 4px 12px rgba(0,0,0,.4)}#globalSearch:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1),0 4px 20px rgba(0,0,0,.1)}.search-results{position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid #e2e8f0;border-top:none;border-radius:0 0 15px 15px;box-shadow:0 8px 25px rgba(0,0,0,.1);z-index:1000;max-height:400px;overflow-y:auto}.search-suggestion{padding:12px 20px;cursor:pointer;border-bottom:1px solid #f7fafc;transition:background-color .2s}.search-suggestion:hover{background:#f7fafc}.search-suggestion.selected{background:#667eea;color:#fff}.search-suggestion-activity{font-weight:600;margin-bottom:4px}.search-suggestion-meta{font-size:12px;color:#a0aec0}.search-suggestion.selected .search-suggestion-meta{color:rgba(255,255,255,.8)}.search-hashtag{background:#667eea;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;margin-right:4px}.search-controls{background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:20px;border:1px solid #e2e8f0}.search-info{margin-bottom:15px;font-size:14px;color:#666}.search-options{display:flex;gap:20px;align-items:center;flex-wrap:wrap}.search-results-list{min-height:200px}.search-result-item{background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:15px;transition:.2s}.search-result-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}.search-result-item.result-todo{border:1px solid #9b2c2c!important}.search-result-item.result-completed{border:1px solid #38a169!important}.search-result-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}.search-result-content{flex:1}.search-result-activity{font-size:16px;font-weight:600;color:#2d3748;margin-bottom:5px}.search-result-description{color:#718096;font-size:14px;margin-bottom:10px;line-height:1.4}.search-result-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px}.search-result-tag{background:#38a169;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;cursor:pointer;transition:.2s}.search-result-tag:hover{background:#2f855a;transform:scale(1.05)}.search-result-meta{display:flex;gap:15px;flex-wrap:wrap;font-size:12px;color:#a0aec0;margin-bottom:10px}.search-result-actions{display:flex;gap:8px;align-items:center}.notes-pagination,.search-pagination{display:flex;justify-content:center;align-items:center;gap:20px;margin-top:30px;padding:20px 0}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:#4a5568}.form-group input,.form-group select,.form-group textarea{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:16px;transition:border-color .3s}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.form-group-buttons{margin-top:32px}.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:16px;transition:.3s;margin-right:10px;margin-bottom:10px}.btn-small{margin-right:5px;margin-bottom:5px}.due-date-quick-sets{display:flex;gap:12px;margin-top:8px;flex-wrap:wrap}.due-date-group{display:flex;gap:4px;flex:1}.due-date-group .btn-quick-set{flex:1;min-width:0;text-align:center}.form-actions-split{display:flex;gap:8px;margin-top:16px;width:100%;box-sizing:border-box;margin-left:0;margin-right:0}.form-actions-split .btn{flex:1;min-width:0;text-align:center;box-sizing:border-box;margin-right:0;margin-bottom:0}.todo-quick-set{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}.btn-quick-set{padding:8px 12px;font-size:14px;background:#e2e8f0;color:#4a5568;border:1px solid #cbd5e0;border-radius:4px;cursor:pointer;transition:.2s}.todo-quick-set .btn-quick-set{flex:1;min-width:0;text-align:center}.btn-quick-set:hover{background:#cbd5e0;border-color:#a0aec0}.btn-quick-set.active{background:#38a169;color:#fff;border-color:#2f855a}.btn-quick-set.active:hover{background:#2f855a;border-color:#276749}.btn-primary{background:#667eea;color:#fff}.btn-primary:hover{background:#5a67d8;transform:translateY(-2px)}.btn-secondary{background:#718096;color:#fff}.btn-secondary:hover{background:#4a5568}.btn-danger{background:#e53e3e;color:#fff}.btn-danger:hover{background:#c53030}.btn-success{background:#667eea;color:#fff}.btn-success:hover{background:#5a67d8}.btn-outline{background:0 0;border:2px solid #667eea;color:#667eea}.btn-outline:hover{background:#667eea;color:#fff;transform:translateY(-2px)}.btn-warning{background:#ed8936;color:#fff}.btn-warning:hover{background:#dd6b20}.entries-list{margin-top:30px}.entry-item{background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:flex-start}.entry-content{flex:1}.entry-time{font-weight:600;color:#667eea;margin-bottom:5px}.entry-activity{font-size:18px;margin-bottom:5px}.entry-description{color:#718096;font-size:14px}.entry-description .md-paragraph{margin:5px 0}.entry-description .md-list{margin:5px 0;padding-left:20px}.entry-description .md-blockquote{margin:8px 0;padding:5px 10px;font-size:13px}.entry-description .md-code{font-size:12px}.entry-actions{display:flex;gap:10px}.entry-item.entry-todo{border:1px solid #9b2c2c!important}.entry-item.entry-overdue{background:#fef5f5;border-color:#7b2d2d!important}.entry-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px}.entry-tag{background:#38a169;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;cursor:pointer;transition:.2s}.entry-tag:hover{background:#2f855a;transform:scale(1.05)}.hashtag-link{color:#38a169;text-decoration:none;font-weight:500;transition:color .2s}.hashtag-link:hover{color:#2f855a;text-decoration:underline}.external-link{color:#3182ce;text-decoration:none;font-weight:500;transition:color .2s}.external-link:hover{color:#2b6cb0;text-decoration:underline}.entry-due-date{font-size:12px;color:#a0aec0;margin-top:5px}.entry-todo-indicator{font-size:12px;color:#f56565;margin-left:10px}.entry-note-indicator{font-size:12px;color:#3182ce;margin-left:10px}.settings-buttons-section{margin-bottom:30px}.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:25px;margin-bottom:30px}.data-management-section{margin-bottom:30px}.data-management-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}.settings-section{background:#f7fafc;padding:20px;border-radius:8px;border:1px solid #e2e8f0}.settings-section h3{margin-bottom:8px;color:#2d3748}.settings-description{font-size:14px;color:#718096;margin-bottom:20px;margin-top:0}.settings-toggles{margin-top:20px;padding-top:15px;border-top:1px solid #e2e8f0}.time-inputs{display:grid;grid-template-columns:1fr 1fr;gap:15px}.activity-days-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}.settings-card{background:#fff;border:2px solid #e2e8f0;border-radius:12px;padding:24px;transition:.3s;position:relative;overflow:hidden}.settings-card:hover{border-color:#667eea;box-shadow:0 8px 25px rgba(102,126,234,.15);transform:translateY(-2px)}.settings-card h3{margin-bottom:8px;color:#2d3748;font-size:18px}.card-description{font-size:14px;color:#718096;margin-bottom:20px;line-height:1.5}.card-actions{display:flex;gap:12px;flex-wrap:wrap}.about-section .debug-info{margin-top:0}.checkbox-group{display:flex;align-items:center;margin-bottom:10px}.checkbox-group input[type=checkbox]{width:auto;margin-right:10px}.notification-status{padding:10px;border-radius:8px;margin-bottom:20px;text-align:center;font-weight:600}.notification-enabled{background:#c6f6d5;color:#22543d}.notification-disabled{background:#fed7d7;color:#742a2a}.notification-warning{background:#fef5e7;color:#744210}.report-filters{background:#f7fafc;padding:20px;border-radius:8px;margin-bottom:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;align-items:end}.report-summary{background:#e6fffa;padding:20px;border-radius:8px;margin-bottom:20px;border-left:4px solid #38b2ac}.report-navigation{display:flex;gap:10px;align-items:center;margin-bottom:20px}.week-display{background:#f7fafc;padding:10px 15px;border-radius:8px;min-width:200px}.download-section{background:#f0fff4;padding:20px;border-radius:8px;margin-top:20px;border-left:4px solid #38a169}.status-indicator{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:8px}.status-active{background:#48bb78}.status-inactive{background:#f56565}.backup-buttons,.reminder-buttons{display:flex;gap:10px;flex-wrap:wrap}.debug-info{background:#f7fafc;padding:20px 24px;border-radius:8px;margin-top:15px;font-family:monospace;font-size:14px;border-left:4px solid #667eea;line-height:1.6}.pause-context-menu{position:fixed;z-index:10000;background:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15);padding:8px 0;min-width:150px;font-size:14px;color:#4a5568}.pause-context-menu-item{padding:8px 16px;cursor:pointer;transition:background-color .2s}.pause-context-menu-item:hover{background-color:#f7fafc}.markdown-preview{background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin:15px 0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;line-height:1.6}.markdown-preview .md-h1{color:#2d3748;border-bottom:2px solid #667eea;padding-bottom:10px;margin:20px 0 15px}.markdown-preview .md-h2{color:#2d3748;border-bottom:1px solid #e2e8f0;padding-bottom:5px;margin:18px 0 12px}.markdown-preview .md-h3{color:#4a5568;margin:15px 0 10px}.markdown-preview .md-blockquote{border-left:4px solid #667eea;margin:15px 0;color:#718096;font-style:italic;background:rgba(102,126,234,.05);padding:10px 15px;border-radius:0 4px 4px 0}.markdown-preview .md-code{background:#edf2f7;padding:2px 6px;border-radius:4px;font-family:Monaco,Consolas,monospace;font-size:14px}.markdown-preview .md-list{margin:10px 0;padding-left:30px}.markdown-preview .md-paragraph{margin:10px 0}.markdown-preview .md-hr{border:none;border-top:1px solid #e2e8f0;margin:20px 0}.markdown-preview .md-preview-more{color:#718096;font-style:italic;text-align:center;margin:15px 0 5px}.md-paragraph{margin:8px 0}.md-paragraph:first-child{margin-top:0}.md-paragraph:last-child{margin-bottom:0}.md-list{margin:8px 0}.md-list li{margin:3px 0}.md-blockquote{margin:8px 0}.report-format-tabs{display:flex;margin-bottom:15px;border-bottom:1px solid #e2e8f0}.format-tab{padding:10px 20px;border:none;background:0 0;cursor:pointer;font-weight:600;color:#718096;border-bottom:2px solid transparent;transition:.3s}.format-tab:hover{color:#4a5568}.format-tab.active{color:#667eea;border-bottom-color:#667eea}.report-preview-container{margin-top:20px;background:#f7fafc;border-radius:8px;padding:20px;border:1px solid #e2e8f0}.report-preview-content{margin-top:10px;background:#fff;padding:15px;border-radius:5px;border:1px solid #e2e8f0;max-height:500px;overflow-y:auto;white-space:pre-wrap;font-family:monospace}.dark-mode .report-preview-container{background:#2d3748;border-color:#4a5568}.dark-mode .report-preview-content{background:#1a202c;border-color:#4a5568;color:#e2e8f0}.nav-btn{transition:.3s,background 1s ease-out}#pauseButton{min-width:180px;text-align:center}.pomodoro-btn{background:#f56565!important;min-width:160px;text-align:center}.pomodoro-btn:hover{background:#e53e3e!important}.pomodoro-btn.active{background:#c53030!important;animation:2s infinite pulse}.pomodoro-btn.breaking{background:#0891b2!important}.pomodoro-btn.breaking:hover{background:#0e7490!important}@media (max-width:640px){.container{padding:10px}.nav{justify-content:space-around;gap:8px}.nav-left,.nav-right{flex-wrap:wrap;gap:8px}.nav-btn{padding:8px 12px;font-size:13px;min-width:auto;max-width:150px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#pauseButton{min-width:90px;max-width:140px}.pomodoro-btn{min-width:80px;max-width:120px}.entry-item{flex-direction:column;gap:15px;padding:15px}.entry-actions{align-self:flex-end;flex-wrap:wrap;gap:6px}.entry-actions .btn{padding:6px 10px;font-size:12px;text-align:center;justify-content:center;display:inline-flex;align-items:center}.report-navigation{flex-wrap:wrap;gap:10px;padding:15px}.week-display{min-width:120px;font-size:14px;padding:8px 12px}.data-management-grid,.settings-grid{grid-template-columns:1fr;gap:15px}.time-inputs{grid-template-columns:1fr;gap:10px}.activity-days-grid{grid-template-columns:1fr;gap:6px}.reminder-buttons{justify-content:center;gap:8px}.card-actions{justify-content:center;gap:8px;flex-wrap:wrap}.card-actions .btn{font-size:13px;padding:8px 12px}.form-group-row{flex-direction:column;gap:10px}.form-group input,.form-group select,.form-group textarea{font-size:16px}.due-date-quick-sets,.todo-quick-set{justify-content:center}.search-container{gap:8px;justify-content:center}#globalSearch{min-width:200px;max-width:300px;font-size:16px}.hashtag-browser-btn{padding:12px 14px;flex-shrink:0}.filter-row{flex-direction:column;gap:10px;align-items:stretch}.filter-group{justify-content:space-between}.filter-group select{min-width:120px}.entry-tags,.todo-tags{justify-content:flex-start}.entries-pagination,.search-pagination,.todo-pagination{flex-wrap:wrap;gap:10px;padding:15px 0}.settings-card{padding:20px 15px}.settings-card h3{font-size:1rem}.status-banner{margin:0 auto 15px;padding:15px}.status-section{flex-direction:column;gap:10px;align-items:stretch;padding:12px}.status-info{flex-direction:column;gap:10px;align-items:stretch}.status-controls{justify-content:center}}@media (max-width:900px) and (min-width:641px){.nav-btn{padding:9px 18px;font-size:14px}#pauseButton{min-width:120px}.search-container{gap:8px}#globalSearch{min-width:180px}.hashtag-browser-btn{padding:12px 14px}}@media (max-width:480px){.container{padding:8px}.search-container{justify-content:center;gap:8px}#globalSearch{min-width:120px;max-width:180px}#pauseButton{max-width:100px;min-width:100px}.hashtag-browser-btn{padding:10px 12px}.header,.section{border-radius:10px;margin-bottom:15px}.nav-btn{max-width:120px;padding:6px 10px;font-size:13px}.pomodoro-btn{min-width:90px}.modal-content{width:95%;max-width:none;margin:10px}.edit-modal-content{width:95%;max-width:none}.modal-header{padding:15px 20px}.modal-header h3{font-size:1.1rem}.modal-body{padding:20px}.entry-item{padding:12px}.entry-activity{font-size:16px}.entry-description{font-size:13px}.todo-item{padding:15px}.todo-activity{font-size:15px}.todo-description{font-size:13px}.btn{padding:10px 16px;font-size:14px;margin-right:8px;margin-bottom:8px}.btn-small{padding:6px 10px;font-size:12px;margin-right:4px;margin-bottom:4px;text-align:center;justify-content:center;display:inline-flex;align-items:center}.btn-quick-set{padding:8px 12px;font-size:12px}.form-group{margin-bottom:15px}.form-group label{margin-bottom:6px;font-size:14px}.form-group input,.form-group select,.form-group textarea{padding:10px}.settings-card{padding:15px 12px}.settings-card h3{font-size:.95rem;margin-bottom:6px}.card-description{font-size:13px;margin-bottom:15px}.debug-info{padding:12px;font-size:12px}.hashtag-cloud-item{margin:3px 4px;padding:3px 8px;font-size:12px}.notification-stack{right:10px;top:10px}.notification-toast{max-width:calc(100vw - 40px);padding:10px 15px;font-size:14px}.report-preview-content{font-size:11px;padding:12px}.week-display{min-width:100px;font-size:13px;padding:6px 10px}}.btn,.btn-quick-set,.entry-tag,.hashtag-cloud-item,.nav-btn,.todo-tag{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media (max-width:768px){.btn,.nav-btn,button{min-height:44px;min-width:44px}.btn-quick-set{min-height:36px;min-width:36px}.checkbox-group{margin:10px 0}.checkbox-group input[type=checkbox]{width:18px;height:18px;margin-right:12px}.checkbox-group label{padding:8px 0;cursor:pointer}.entry-tag,.hashtag-cloud-item,.search-result-tag,.todo-tag{min-height:32px;padding:6px 12px;margin:4px;display:inline-flex;align-items:center;justify-content:center}.entry-actions .btn,.todo-actions .btn{margin:4px;min-height:36px;min-width:60px;text-align:center;justify-content:center;display:inline-flex;align-items:center}.btn-close{width:44px;height:44px;font-size:20px;top:10px;right:10px}.entries-pagination .btn,.search-pagination .btn,.todo-pagination .btn{min-height:44px;min-width:44px;margin:4px}.btn:focus,.nav-btn:focus,input:focus,select:focus,textarea:focus{outline:#667eea solid 2px;outline-offset:2px}.btn,.btn-quick-set,.entry-tag,.nav-btn,.todo-tag{-webkit-tap-highlight-color:transparent}}body.dark-mode{background:url('data:image/svg+xml,<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><radialGradient id="bg" cx="35%" cy="30%" r="70%"><stop offset="0%" stop-color="%23b6a9ff"/><stop offset="100%" stop-color="%235a4fcf"/></radialGradient></defs><circle cx="32" cy="32" r="22" fill="url(%23bg)" stroke="%23b5adff" stroke-width="2" opacity="0.3"/><rect x="20" y="28" width="24" height="16" rx="3.5" fill="none" stroke="%23f0f4ff" stroke-width="2" opacity="0.6"/><path d="M20 36h24M32 28v16" stroke="%23f0f4ff" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.6"/><circle cx="32" cy="26.5" r="8.0" fill="none" stroke="%23ffffff" stroke-width="1.5" opacity="0.5"/><path d="M32 26.5 L39.31 24.12" stroke="%23ffffff" stroke-width="1.2" stroke-linecap="round" fill="none" opacity="0.5"/><path d="M32 26.5 L31.45 20.9" stroke="%23ffffff" stroke-width="1.3" stroke-linecap="round" fill="none" opacity="0.5"/><circle cx="32" cy="26.5" r="1.15" fill="%23ffffff" opacity="0.5"/></svg>') center -50px/100vw auto no-repeat fixed,linear-gradient(135deg,#1a1f3a 0,#2d1b4e 50%,#1a0b2e 100%) 0 0/cover fixed;color:#e2e8f0}.dark-mode .container{background:rgba(45,55,72,.15);backdrop-filter:blur(1px);-webkit-backdrop-filter:blur(1px)}.dark-mode .header{background:rgba(45,55,72,.75);backdrop-filter:blur(10px);color:#e2e8f0}.dark-mode .section{background:rgba(45,55,72,.95);backdrop-filter:blur(10px);color:#e2e8f0}.dark-mode .header .header-icon-overlay{opacity:.25}.dark-mode .form-group label{color:#a0aec0}.dark-mode .form-group input,.dark-mode .form-group select,.dark-mode .form-group textarea{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode .form-group input:focus,.dark-mode .form-group select:focus,.dark-mode .form-group textarea:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.2)}.dark-mode .entry-item{background:#2d3748;border-color:#4a5568}.dark-mode .entry-description{color:#a0aec0}.dark-mode .entry-item.entry-overdue{background:#2d1b1e}.dark-mode .entry-due-date{color:#718096}.dark-mode .entry-todo-indicator{color:#fc8181}.dark-mode .entry-note-indicator{color:#63b3ed}.dark-mode .pause-context-menu{background:#2d3748;border-color:#4a5568;color:#e2e8f0;box-shadow:0 4px 12px rgba(0,0,0,.3)}.dark-mode .pause-context-menu-item:hover{background-color:#1a202c}.dark-mode .hashtag-link{color:#68d391}.dark-mode .hashtag-link:hover{color:#9ae6b4}.dark-mode .external-link{color:#63b3ed}.dark-mode .external-link:hover{color:#90cdf4}.dark-mode .notes-filters,.dark-mode .todo-filters{background:#1a202c;border-color:#4a5568}.dark-mode .filter-group label{color:#a0aec0}.dark-mode .filter-group input,.dark-mode .filter-group select{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode .filter-group input:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.2)}.dark-mode .todo-stats{color:#a0aec0}.dark-mode .todo-item{background:#2d3748;border-color:#4a5568}.dark-mode .todo-item.todo-incomplete{border-color:#e53e3e}.dark-mode .todo-item.todo-overdue{background:#2d1b1e;border-color:#c53030}.dark-mode .todo-activity{color:#e2e8f0}.dark-mode .todo-description{color:#a0aec0}.dark-mode .empty-state,.dark-mode .todo-meta{color:#718096}.dark-mode #globalSearch{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode #globalSearch:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.2),0 4px 20px rgba(0,0,0,.3)}.dark-mode .search-results{background:#2d3748;border-color:#4a5568}.dark-mode .search-suggestion{border-bottom-color:#1a202c}.dark-mode .search-suggestion:hover{background:#1a202c}.dark-mode .search-suggestion-meta{color:#718096}.dark-mode .search-controls{background:#1a202c;border-color:#4a5568}.dark-mode .search-info{color:#a0aec0}.dark-mode .search-result-item{background:#2d3748;border-color:#4a5568}.dark-mode .search-result-activity{color:#e2e8f0}.dark-mode .search-result-description{color:#a0aec0}.dark-mode .search-result-meta{color:#718096}.dark-mode .btn-quick-set{background:#4a5568;color:#a0aec0;border-color:#2d3748}.dark-mode .btn-quick-set:hover{background:#2d3748;border-color:#1a202c}.dark-mode .btn-quick-set.active{background:#38a169;color:#fff;border-color:#2f855a}.dark-mode .btn-quick-set.active:hover{background:#2f855a;border-color:#276749}.dark-mode .settings-section{background:#1a202c;border-color:#4a5568}.dark-mode .settings-section h3{color:#e2e8f0}.dark-mode .settings-description{color:#a0aec0}.dark-mode .settings-toggles{border-top-color:#4a5568}.dark-mode .settings-card{background:#2d3748;border-color:#4a5568}.dark-mode .settings-card:hover{border-color:#667eea;box-shadow:0 8px 25px rgba(102,126,234,.25)}.dark-mode .settings-card h3{color:#e2e8f0}.dark-mode .card-description{color:#a0aec0}.dark-mode .report-filters{background:#2d3748}.dark-mode .week-display{background:#2d3748}.dark-mode .report-summary{background:#2c5282;color:#bee3f8;border-left-color:#63b3ed}.dark-mode .download-section{background:#22543d;color:#f0fff4;border-left-color:#68d391}.dark-mode .download-section label{color:#c6f6d5}.dark-mode .debug-info{background:#1a202c;border-left-color:#667eea}.dark-mode .markdown-preview{background:#1a202c;border-color:#4a5568}.dark-mode .markdown-preview .md-h1,.dark-mode .markdown-preview .md-h2,.dark-mode .markdown-preview .md-h3{color:#e2e8f0}.dark-mode .markdown-preview .md-blockquote{color:#a0aec0;background:rgba(102,126,234,.1);border-left-color:#667eea}.dark-mode .markdown-preview .md-code{background:#2d3748;color:#e2e8f0}.dark-mode .format-tab{color:#a0aec0}.dark-mode .format-tab:hover{color:#e2e8f0}.dark-mode .format-tab.active{color:#667eea;border-bottom-color:#667eea}.dark-mode .preview-format-tabs{border-color:#4a5568}.dark-mode .preview-tab{background:#2d3748;color:#a0aec0}.dark-mode .preview-tab:hover{background:#1a202c;color:#e2e8f0}.dark-mode .preview-tab.active{background:#667eea;color:#fff}.dark-mode .template-editor-tabs{border-bottom-color:#4a5568}.dark-mode .template-tab{color:#a0aec0}.dark-mode .template-tab:hover{color:#e2e8f0;background:#1a202c}.dark-mode .template-tab.active{color:#667eea;border-bottom-color:#667eea;background:#3d4852}.template-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:2000;backdrop-filter:blur(5px)}.template-overlay.active{display:flex;align-items:center;justify-content:center}.template-overlay-content{background:#fff;border-radius:15px;width:95%;max-width:1400px;height:90%;max-height:900px;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.3)}.template-manager-header{padding:15px 20px;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;border-radius:15px 15px 0 0;flex-shrink:0;background:#f8f9fa}.template-manager-header h2{margin:0;color:#2d3748;font-size:1.25rem;flex:1}.template-manager-actions{display:flex;gap:10px;align-items:center}.template-manager-actions .btn{font-size:.875rem;padding:8px 16px}.template-manager-body{flex:1;display:grid;grid-template-columns:300px 1fr;min-height:0;overflow:hidden}.template-list-panel{border-right:1px solid #e2e8f0;padding:20px;display:flex;flex-direction:column;background:#f7fafc;overflow-y:auto}.template-list-panel h3{margin:0 0 15px;color:#2d3748}.template-list{flex:1;overflow-y:auto;margin-bottom:15px}.template-list-item{padding:12px 15px;border:1px solid #e2e8f0;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:.2s;background:#fff}.template-list-item:hover{border-color:#667eea;box-shadow:0 2px 8px rgba(102,126,234,.1)}.template-list-item.active{border-color:#667eea;background:#f0f2ff;box-shadow:0 2px 8px rgba(102,126,234,.2)}.template-list-item.default::after{content:" (Default)";color:#38a169;font-weight:600;font-size:12px}.template-list-item-name{font-weight:600;color:#2d3748;margin-bottom:2px}.template-list-item-desc{font-size:12px;color:#718096}.template-list-item-type{font-size:11px;color:#667eea;text-transform:uppercase;font-weight:600;margin-top:4px}.template-list-actions{display:flex;gap:10px}.template-editor-panel{padding:20px;display:flex;flex-direction:column;min-height:0;overflow:hidden}.template-editor-tabs{display:flex;border-bottom:1px solid #e2e8f0;margin-bottom:20px;margin-top:15px}.template-tab{padding:10px 20px;border:none;background:0 0;cursor:pointer;font-weight:600;color:#718096;border-bottom:2px solid transparent;transition:.3s}.template-tab:hover{color:#4a5568;background:#f7fafc}.template-tab.active{color:#667eea;border-bottom-color:#667eea;background:#f0f2ff}.template-editor-content{flex:1;display:flex;flex-direction:column;min-height:0}.template-editor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.template-editor-header h3{margin:0;color:#2d3748}.template-editor-actions{display:flex;gap:10px}.template-editor-form{flex:1;overflow-y:auto;display:flex;flex-direction:column}.template-editor-form #templateContent{font-family:Monaco,Consolas,monospace;font-size:13px;resize:vertical;min-height:200px}.template-preview-panel{flex:1;display:flex;flex-direction:column;min-height:0}.template-preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.template-preview-controls{display:flex;align-items:center;gap:15px}.preview-format-tabs{display:flex;border:1px solid #e2e8f0;border-radius:6px;overflow:hidden}.preview-tab{padding:6px 12px;border:none;background:#fff;cursor:pointer;font-size:12px;font-weight:600;color:#718096;transition:.2s}.preview-tab:hover{background:#f7fafc;color:#4a5568}.preview-tab.active{background:#667eea;color:#fff}.report-preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.report-preview-header h3{margin:0}.template-preview-header h4{margin:0;color:#2d3748}.template-preview-content{flex:1;background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:15px;overflow-y:auto;font-family:monospace;font-size:12px;white-space:pre-wrap}.template-preview-placeholder{color:#718096;font-style:italic;text-align:center;margin-top:50px}.template-manager-footer{padding:20px 30px;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:15px;border-radius:0 0 15px 15px}.template-management-preview{margin-top:15px}.template-preview-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin-bottom:20px}.template-preview-card{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:15px;transition:.2s}.template-preview-card:hover{border-color:#667eea;box-shadow:0 4px 12px rgba(102,126,234,.1)}.template-preview-card.default{border-color:#38a169;background:#f0fff4}.template-preview-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}.template-preview-card-name{font-weight:600;color:#2d3748;margin-bottom:2px}.template-preview-card-type{font-size:11px;color:#667eea;text-transform:uppercase;font-weight:600;background:#e6f3ff;padding:2px 6px;border-radius:3px}.template-preview-card-desc{font-size:13px;color:#718096;margin-bottom:10px}.template-preview-card-sample{background:#f7fafc;border:1px solid #e2e8f0;border-radius:4px;padding:8px;font-family:monospace;font-size:11px;max-height:60px;overflow:hidden;position:relative}.template-preview-card-sample::after{content:"";position:absolute;bottom:0;left:0;right:0;height:20px;background:linear-gradient(transparent,#f7fafc)}.template-actions{display:flex;gap:10px;flex-wrap:wrap}.dark-mode .template-overlay-content{background:#2d3748}.dark-mode .template-manager-header{border-bottom-color:#4a5568;background:#1a202c}.dark-mode .template-manager-header h2{color:#e2e8f0}.dark-mode .template-list-panel{background:#1a202c;border-right-color:#4a5568}.dark-mode .template-list-panel h3{color:#e2e8f0}.dark-mode .template-list-item{background:#2d3748;border-color:#4a5568}.dark-mode .template-list-item:hover{border-color:#667eea;box-shadow:0 2px 8px rgba(102,126,234,.2)}.dark-mode .template-list-item.active{background:#3d4852}.dark-mode .template-list-item-name{color:#e2e8f0}.dark-mode .template-list-item-desc{color:#a0aec0}.dark-mode .template-editor-header h3,.dark-mode .template-preview-header h4{color:#e2e8f0}.dark-mode .template-preview-content{background:#1a202c;border-color:#4a5568;color:#e2e8f0}.dark-mode .template-manager-footer{border-top-color:#4a5568}.dark-mode .template-preview-card{background:#2d3748;border-color:#4a5568}.dark-mode .template-preview-card-name{color:#e2e8f0}.dark-mode .template-preview-card-desc{color:#a0aec0}.dark-mode .template-preview-card-sample{background:#1a202c;border-color:#4a5568;color:#e2e8f0}.dark-mode .template-preview-card-sample::after{background:linear-gradient(transparent,#1a202c)}@keyframes slideInToastDown{0%{transform:translateX(400px) translateY(-100%);opacity:0}50%{transform:translateX(400px) translateY(0);opacity:.7}100%{transform:translateX(0) translateY(0);opacity:1}}@keyframes slideOutToast{0%{transform:translateX(0) translateY(0);opacity:1}100%{transform:translateX(400px) translateY(0);opacity:0}}.btn-info{background:#3182ce;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;transition:.3s;font-weight:500}.btn-info:hover{background:#2c5282;transform:translateY(-1px)}.reports-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}.reports-section{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:12px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,.08);border:1px solid rgba(255,255,255,.2)}.reports-section h3{margin:0 0 16px;padding-bottom:6px;color:#4a5568;font-size:1.1rem;font-weight:600}.report-navigation-section{margin-bottom:20px}.report-templates-section{margin-top:30px;padding-top:20px;border-top:1px solid #e2e8f0}.report-templates-section .settings-card{max-width:none}.report-navigation-section .report-navigation{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:12px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,.08);border:1px solid rgba(255,255,255,.2);display:flex;justify-content:space-between;align-items:center;gap:20px}.week-display{font-weight:600;color:#4a5568;text-align:center;flex:1}.dark-mode .report-navigation-section .report-navigation{background:#2d3748;color:#e2e8f0;border-color:#4a5568}.dark-mode .week-display{color:#cbd5e0}.download-actions,.report-actions{margin-top:15px;display:flex;gap:10px;flex-wrap:wrap}.preview-controls{display:flex;align-items:center;gap:15px}.btn-copy-report{background:#38a169;color:#fff;border:2px solid transparent;padding:6px 12px;font-size:.875rem;border-radius:6px;cursor:pointer;transition:.3s;font-weight:500}.btn-copy-report:hover{background:#2f855a;transform:translateY(-1px)}.dark-mode .reports-section{background:#2d3748;color:#e2e8f0;border-color:#4a5568}.dark-mode .reports-section h3{color:#cbd5e0}.dark-mode .report-templates-section{border-top-color:#4a5568}.workspace-manager-content{max-width:600px;width:90vw}.current-workspace{margin-bottom:24px;padding:16px;background:#f7fafc;border-radius:8px;border-left:4px solid #667eea}.workspace-description{color:#718096;font-size:.9rem;margin:8px 0 0}.workspace-list-section{margin-bottom:24px}.workspace-list{border:1px solid #e2e8f0;border-radius:8px;overflow:hidden}.workspace-item{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #e2e8f0;transition:background-color .2s}.workspace-item:last-child{border-bottom:none}.workspace-item:hover{background:#f7fafc}.workspace-item.current{background:#e6fffa;border-left:4px solid #38b2ac}.workspace-item .workspace-info{display:flex;align-items:center;gap:12px}.workspace-name{font-weight:600;color:#2d3748}.current-badge{background:#38b2ac;color:#fff;padding:2px 8px;border-radius:12px;font-size:.75rem;font-weight:500}.workspace-actions{border-top:1px solid #e2e8f0;padding-top:20px;margin-top:8px}.workspace-item .workspace-actions{display:flex;gap:8px;align-items:center;border-top:none;padding-top:0;margin-top:0}.create-workspace{display:flex;gap:12px;align-items:center;margin-bottom:16px}.create-workspace input{flex:1;min-width:200px;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;transition:border-color .2s,box-shadow .2s;background:#fff}.create-workspace input:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.create-workspace input::placeholder{color:#9ca3af}.empty-state{text-align:center;color:#718096;padding:32px 16px;font-style:italic}.dark-mode .current-workspace{background:#2d3748;border-left-color:#667eea}.dark-mode .workspace-list{border-color:#4a5568}.dark-mode .workspace-item{border-bottom-color:#4a5568}.dark-mode .workspace-item:hover{background:#2d3748}.dark-mode .workspace-item.current{background:#234e52;border-left-color:#38b2ac}.dark-mode .workspace-name{color:#e2e8f0}.dark-mode .empty-state,.dark-mode .workspace-description{color:#a0aec0}.dark-mode .create-workspace input{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode .create-workspace input:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.2)}.dark-mode .create-workspace input::placeholder{color:#718096}.dark-mode .workspace-actions{border-top-color:#4a5568}@media (max-width:768px){.reports-grid{grid-template-columns:1fr}.settings-grid-four-col,.settings-grid-three-col{grid-template-columns:1fr!important;gap:15px}input[type=date],input[type=datetime-local],input[type=time]{max-width:calc(100% - 20px);width:100%;box-sizing:border-box}.btn,body,button{font-size:16px}.nav-btn{font-size:15px}input,select,textarea{font-size:16px}.activity-list-item{font-size:15px}.activity-list-item .timestamp{font-size:14px}.settings-section h3{font-size:20px}.settings-section p,label{font-size:15px}}.settings-grid-two-col{grid-template-columns:1fr 1fr!important}.settings-grid-three-col{grid-template-columns:1fr 1fr 1fr!important;gap:20px}.settings-grid-four-col{grid-template-columns:1fr 1fr!important;gap:20px}.general-settings{background:rgba(59,130,246,.05);border:1px solid rgba(59,130,246,.2);border-radius:12px;padding:20px;margin-bottom:30px}.general-settings h3{color:#2563eb;margin-bottom:8px}.dark-mode .general-settings{background:rgba(59,130,246,.1);border-color:rgba(59,130,246,.3)}.dark-mode .general-settings h3{color:#60a5fa}.schedule-section{margin-bottom:20px}.schedule-section h4{margin:0 0 12px;padding-bottom:4px;color:#4a5568;font-size:1rem;font-weight:600}.dark-mode .schedule-section h4{color:#cbd5e0}.pomodoro-section{margin-bottom:20px}.pomodoro-settings{margin-top:15px}.pomodoro-config{margin-top:15px;padding:15px;background:rgba(255,255,255,.5);border-radius:8px;border-left:4px solid #667eea}.dark-mode .pomodoro-config{background:rgba(0,0,0,.2);border-left-color:#764ba2}.pomodoro-timers{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px}.pomodoro-options{display:flex;flex-direction:column;gap:10px}.pomodoro-status-section{margin-bottom:20px;padding:15px;background:rgba(0,0,0,.05);border-radius:8px;text-align:center}.dark-mode .pomodoro-status-section{background:rgba(255,255,255,.05)}.pomodoro-status{font-size:16px;font-weight:600;margin-bottom:10px;padding:8px 12px;border-radius:6px;transition:.3s}.pomodoro-status.disabled{color:#6b7280;background:rgba(107,114,128,.1)}.pomodoro-status.ready{color:#059669;background:rgba(5,150,105,.1)}.pomodoro-status.working{color:#dc2626;background:rgba(220,38,38,.1);animation:2s infinite pulse}.pomodoro-status.breaking{color:#0891b2;background:rgba(8,145,178,.1)}.pomodoro-status.paused{color:#f59e0b;background:rgba(245,158,11,.1)}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}.pomodoro-banner{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:15px 20px;margin:0 -20px 20px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}.pomodoro-banner-content{max-width:1200px;margin:0 auto;display:flex;justify-content:center;align-items:center;gap:20px}.pomodoro-banner-controls{display:flex;align-items:center;gap:10px}.pomodoro-pause-btn{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3);padding:8px 16px;border-radius:6px;font-size:14px;cursor:pointer;transition:.2s}.pomodoro-pause-btn:hover{background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.5)}.pomodoro-pause-btn:active{background:rgba(255,255,255,.1)}.pomodoro-timer{display:flex;align-items:center;gap:15px;font-size:18px;font-weight:600}#pomodoroTimeRemaining{font-family:'Courier New',monospace;font-size:24px;font-weight:700;background:rgba(255,255,255,.2);padding:8px 16px;border-radius:8px;min-width:80px}.dark-mode .session-number{color:#a5b4fc}.dark-mode .countdown-timer{background:#374151!important;border-color:#4b5563}.dark-mode .work-title{color:#f3f4f6}.dark-mode .work-desc{color:#9ca3af}.reminder-banner{background:linear-gradient(135deg,#059669 0,#047857 100%);color:#fff;padding:15px 20px;margin:0 -20px 20px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}.reminder-banner-content{max-width:1200px;margin:0 auto;display:flex;justify-content:center;align-items:center;gap:20px}.reminder-timer{display:flex;align-items:center;gap:10px}#reminderTimeRemaining{font-size:20px;font-weight:700;background:rgba(255,255,255,.2);padding:8px 12px;border-radius:8px;min-width:80px}.reminder-status{font-size:16px;opacity:.9}.dark-mode .reminder-banner{background:linear-gradient(135deg,#10b981 0,#059669 100%)}.status-banner{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:15px;padding:20px;margin:0 auto 20px;max-width:1200px;box-shadow:0 2px 10px rgba(0,0,0,.05);border:1px solid rgba(0,0,0,.08)}.status-banner-content{display:flex;flex-direction:column;gap:15px}.status-section{display:flex;justify-content:space-between;align-items:flex-start;padding:16px;border-radius:12px;transition:.2s;gap:16px}.status-section:first-child:last-child{border-radius:10px}#pomodoroStatusSection{background:linear-gradient(135deg,rgba(102,126,234,.1) 0,rgba(118,75,162,.1) 100%);border:1px solid rgba(102,126,234,.2)}.pomodoro-bar{flex:1}.pomodoro-active-bar{display:flex;align-items:center;gap:16px;height:48px;padding:8px 0}.pomodoro-tomato{font-size:32px;line-height:1;flex-shrink:0}.session-number{font-size:32px;font-weight:700;color:#667eea;flex-shrink:0;min-width:48px}.countdown-timer{background:#1f2937!important;color:#fff!important;padding:8px 16px;border-radius:8px;font-family:'SF Mono',Monaco,'Cascadia Code','Roboto Mono',Consolas,'Courier New',monospace;font-size:18px;font-weight:600;flex-shrink:0;min-width:80px;text-align:center;border:1px solid #374151}.work-item{flex:1;min-width:0;margin-left:8px}.work-title{font-size:16px;font-weight:500;color:#374151;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.work-desc{font-size:14px;color:#6b7280;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px}#reminderStatusSection{background:linear-gradient(135deg,rgba(5,150,105,.1) 0,rgba(4,120,87,.1) 100%);border:1px solid rgba(5,150,105,.2)}.status-info{display:flex;align-items:flex-start;gap:20px;flex:1;min-width:0}.status-label{font-size:16px;font-weight:500;color:#374151}.status-timer{display:flex;flex-direction:column;gap:8px;min-width:0}@media (max-width:768px){.pomodoro-active-bar{gap:12px;height:44px}.pomodoro-tomato{font-size:24px}.session-number{font-size:24px;min-width:36px}.countdown-timer{font-size:16px;padding:6px 12px;min-width:70px}.work-title{font-size:15px}.work-desc{font-size:13px}.settings-grid-two-col{grid-template-columns:1fr!important}.pomodoro-timers{grid-template-columns:1fr}}@media (max-width:480px){.pomodoro-active-bar{gap:8px;flex-wrap:wrap;height:auto;padding:8px 0}.work-item{flex-basis:100%;margin-left:0;margin-top:8px}}.status-controls{display:flex;align-items:center;gap:10px}.status-button{background:rgba(102,126,234,.1);color:#667eea;border:1px solid rgba(102,126,234,.3);padding:8px 16px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:.2s}.status-button:hover{background:rgba(102,126,234,.2);border-color:rgba(102,126,234,.4)}.status-button:active{background:rgba(102,126,234,.3)}.dark-mode .status-banner{background:rgba(31,41,55,.95);border-color:rgba(255,255,255,.1)}.dark-mode .status-label{color:#e5e7eb}.dark-mode #pomodoroStatusSection{background:linear-gradient(135deg,rgba(79,70,229,.2) 0,rgba(124,58,237,.2) 100%);border-color:rgba(79,70,229,.3)}.dark-mode #reminderStatusSection{background:linear-gradient(135deg,rgba(16,185,129,.2) 0,rgba(5,150,105,.2) 100%);border-color:rgba(16,185,129,.3)}.dark-mode .status-button{background:rgba(79,70,229,.2);color:#a78bfa;border-color:rgba(79,70,229,.4)}.dark-mode .status-button:hover{background:rgba(79,70,229,.3);border-color:rgba(79,70,229,.5)}.pomodoro-controls{display:flex;justify-content:center;gap:10px}.pomodoro-hint{font-size:12px;color:#6b7280;margin:8px 0 0;font-style:italic}.dark-mode .pomodoro-hint{color:#9ca3af}.pomodoro-config h4{color:#374151;font-size:14px;font-weight:600;margin:20px 0 10px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid rgba(0,0,0,.1);padding-bottom:5px}.dark-mode .pomodoro-config h4{color:#d1d5db;border-bottom-color:rgba(255,255,255,.1)}.pomodoro-sounds{margin-bottom:15px}.pomodoro-sounds .form-group{margin-bottom:10px}.pomodoro-announce-sounds{margin-bottom:15px}.pomodoro-announce-sounds .form-group{margin-bottom:10px}.pomodoro-session-management{margin-top:20px;padding:15px;background:rgba(255,255,255,.3);border-radius:8px;border-left:4px solid #ed8936}.dark-mode .pomodoro-session-management{background:rgba(0,0,0,.1);border-left-color:#f56565}.pomodoro-session-management h5{color:#374151;font-size:14px;font-weight:600;margin:0 0 15px;text-transform:uppercase;letter-spacing:.5px}.dark-mode .pomodoro-session-management h5{color:#d1d5db}.session-actions{display:flex;gap:10px;flex-wrap:wrap}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:1000;align-items:center;justify-content:center}.modal[style*=block]{display:flex!important}.modal-content{background:#fff;padding:0;border-radius:15px;max-width:500px;width:90%;max-height:90vh;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.3);position:relative}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 30px;border-bottom:1px solid #e2e8f0;background:#f8f9fa}.modal-header h3{margin:0;color:#2d3748;font-size:1.25rem}.modal-body{padding:30px;overflow-y:auto;max-height:calc(90vh - 140px)}.btn-close{background:0 0;border:none;font-size:24px;cursor:pointer;color:#718096;padding:5px 10px;border-radius:5px;transition:.2s;position:absolute;top:15px;right:15px;width:35px;height:35px;display:flex;align-items:center;justify-content:center}.btn-close:hover{background:#f7fafc;color:#2d3748}.template-guide-content{max-width:800px;max-height:90vh;display:flex;flex-direction:column}.template-guide-content .modal-body{overflow-y:auto;flex:1}.edit-modal-content{max-width:650px;width:95%}@media (max-width:768px){.edit-modal-content{max-width:500px;width:90%}}#userGuideModal .modal-content,.about-modal-content{max-width:800px}.about-section{margin-bottom:25px}.version-current{background:#f7fafc;padding:12px 16px;border-radius:8px;margin-bottom:16px;border-left:4px solid #667eea}.version-history-list{max-height:300px;overflow-y:auto}.version-entry{padding:12px 0;border-bottom:1px solid #e2e8f0}.version-entry:last-child{border-bottom:none}.version-entry.current{background:#f0fff4;border-radius:6px;padding:12px;margin-bottom:8px}.version-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.version-number{font-family:Monaco,Menlo,monospace;font-weight:600;color:#4c51bf;font-size:.9em}.version-date{color:#718096;font-size:.85em}.version-summary{color:#4a5568;line-height:1.4;font-size:.9em}.dark-mode .version-current{background:#2d3748;border-left-color:#667eea;color:#e2e8f0}.dark-mode .version-entry{border-bottom-color:#4a5568}.dark-mode .version-entry.current{background:#1a202c;color:#e2e8f0}.dark-mode .version-number{color:#a78bfa}.dark-mode .version-date{color:#a0aec0}.dark-mode .version-summary{color:#cbd5e0}.dark-mode .version-history-list h5{color:#e2e8f0!important}.about-section h4{color:#4a5568;margin:0 0 15px;font-size:1.1rem;font-weight:600}.diagnostic-buttons{display:flex;flex-wrap:wrap}.diagnostic-buttons .btn{font-size:.875rem}.about-section p{margin-bottom:10px;line-height:1.6}.user-guide-content{max-width:700px}.guide-section{margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid rgba(0,0,0,.08)}.guide-section:last-child{border-bottom:none;margin-bottom:0}.guide-section h4{color:#2d3748;margin:0 0 12px;font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:8px}.guide-section p{margin-bottom:15px;line-height:1.6;color:#4a5568}.guide-section ul{margin:0;padding-left:20px;line-height:1.7}.guide-section li{margin-bottom:8px;color:#4a5568}.guide-section kbd{background:#f7fafc;border:1px solid #e2e8f0;border-radius:4px;padding:2px 6px;font-family:monospace;font-size:.875rem;color:#2d3748;box-shadow:0 1px 2px rgba(0,0,0,.1)}.dark-mode .guide-section{border-bottom-color:rgba(255,255,255,.1)}.dark-mode .guide-section h4{color:#e2e8f0}.dark-mode .guide-section li,.dark-mode .guide-section p{color:#a0aec0}.dark-mode .guide-section kbd{background:#4a5568;border-color:#718096;color:#e2e8f0}.about-section ul{margin:10px 0;padding-left:20px}.about-section li{margin-bottom:5px;line-height:1.5}.template-guide-content h4{color:#4a5568;margin:20px 0 10px;font-size:1.1rem}.template-guide-content pre{background:#f7fafc;padding:15px;border-radius:6px;overflow-x:auto;margin:10px 0}.template-guide-content code{background:#edf2f7;padding:2px 6px;border-radius:3px;font-family:Monaco,Menlo,monospace;font-size:.875rem}.template-guide-content pre code{background:0 0;padding:0}.dark-mode .modal-content{background:#2d3748}.dark-mode .modal-header{background:#1a202c;border-bottom-color:#4a5568}.dark-mode .modal-header h3{color:#e2e8f0}.dark-mode .btn-close{color:#a0aec0}.dark-mode .btn-close:hover{background:#1a202c;color:#e2e8f0}.dark-mode .about-section h4,.dark-mode .template-guide-content h4{color:#cbd5e0}.dark-mode .template-guide-content pre{background:#1a202c;color:#e2e8f0}.dark-mode .template-guide-content code{background:#2d3748;color:#e2e8f0}.dark-mode input[type=date],.dark-mode input[type=datetime-local],.dark-mode input[type=time]{color-scheme:dark;background-color:#2d3748;border-color:#4a5568;color:#e2e8f0;color-scheme:dark}input[type=date],input[type=datetime-local],input[type=time]{color-scheme:light}input[type=date]::-webkit-calendar-picker-indicator,input[type=datetime-local]::-webkit-calendar-picker-indicator,input[type=time]::-webkit-calendar-picker-indicator{cursor:pointer;opacity:.7;transition:opacity .2s;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='%23333' d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z'/%3e%3c/svg%3e");background-size:16px 16px;background-repeat:no-repeat;background-position:center;width:20px;height:20px}input[type=time]::-webkit-calendar-picker-indicator{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='%23333' d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/%3e%3cpath fill='%23333' d='M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868L7.5 9.5a.5.5 0 0 1-.5-.5V3.5a.5.5 0 0 1 .5-.5z'/%3e%3c/svg%3e")}input[type=date]::-webkit-calendar-picker-indicator:hover,input[type=datetime-local]::-webkit-calendar-picker-indicator:hover,input[type=time]::-webkit-calendar-picker-indicator:hover{opacity:1}.dark-mode input[type=date]::-webkit-calendar-picker-indicator,.dark-mode input[type=datetime-local]::-webkit-calendar-picker-indicator{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='%23ffffff' d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z'/%3e%3c/svg%3e");opacity:.8}.dark-mode input[type=time]::-webkit-calendar-picker-indicator{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='%23ffffff' d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'/%3e%3cpath fill='%23ffffff' d='M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868L7.5 9.5a.5.5 0 0 1-.5-.5V3.5a.5.5 0 0 1 .5-.5z'/%3e%3c/svg%3e");opacity:.8}.dark-mode input[type=date]::-webkit-calendar-picker-indicator:hover,.dark-mode input[type=datetime-local]::-webkit-calendar-picker-indicator:hover,.dark-mode input[type=time]::-webkit-calendar-picker-indicator:hover{opacity:1}input[type=date]::-moz-calendar-picker-indicator,input[type=datetime-local]::-moz-calendar-picker-indicator,input[type=time]::-moz-calendar-picker-indicator{cursor:pointer;opacity:.7;width:20px;height:20px}.dark-mode input[type=date]::-moz-calendar-picker-indicator,.dark-mode input[type=datetime-local]::-moz-calendar-picker-indicator,.dark-mode input[type=time]::-moz-calendar-picker-indicator{opacity:.8}body.debug-palette-override{--primary-color:#e40303;--secondary-color:#ff8c00;--accent-color:#ffed00;--success-color:#008018;--info-color:#0078d4;--warning-color:#732982;--bg-color:#f8f9fa;--text-color:#2d3748;--border-color:#e2e8f0}body.debug-palette-override.dark-mode{--primary-color:#e40303;--secondary-color:#ff8c00;--accent-color:#ffed00;--success-color:#008018;--info-color:#0078d4;--warning-color:#732982;--bg-color:#1a202c;--text-color:#e2e8f0;--border-color:#4a5568}body.debug-palette-override .btn{background:linear-gradient(45deg,var(--primary-color),var(--secondary-color),var(--accent-color),var(--success-color),var(--info-color),var(--warning-color));background-size:300% 300%;animation:3s infinite rainbow-shift;color:#fff;border:none}body.debug-palette-override .header{background:linear-gradient(90deg,var(--primary-color),var(--secondary-color),var(--accent-color),var(--success-color),var(--info-color),var(--warning-color));animation:4s infinite rainbow-shift}body.debug-palette-override .hashtag-link{color:var(--accent-color)}body.debug-palette-override .entry-item{border-left:4px solid var(--primary-color)}@keyframes rainbow-shift{0%,100%{background-position:0 50%}50%{background-position:100% 50%}}.notification-stack{position:fixed;top:20px;right:20px;z-index:9999;pointer-events:none;display:flex;flex-direction:column;gap:10px}.notification-toast{background:rgba(45,55,72,.95);backdrop-filter:blur(10px);color:#fff;padding:12px 20px;border-radius:8px;max-width:350px;box-shadow:0 8px 32px rgba(0,0,0,.3);pointer-events:auto;cursor:pointer;transition:.3s;transform:translateX(400px) translateY(-100%);opacity:0;animation:.4s ease-out forwards slideInToastDown}.notification-toast.notification-success{background:rgba(56,161,105,.95);border-left:4px solid #38a169}.notification-toast.notification-error{background:rgba(229,62,62,.95);border-left:4px solid #e53e3e}.notification-toast.notification-warning{background:rgba(237,137,54,.95);border-left:4px solid #ed8936}.notification-toast.notification-info{background:rgba(49,130,206,.95);border-left:4px solid #3182ce}.notification-toast.removing{animation:.3s forwards slideOut}.notification-toast:hover{transform:translateX(-5px);box-shadow:0 12px 40px rgba(0,0,0,.4)}.notification-toast .refresh-btn,.notification-toast .undo-btn,div[style*="position: fixed"][style*="top: 20px"][style*="right: 20px"] .refresh-btn,div[style*="position: fixed"][style*="top: 20px"][style*="right: 20px"] .undo-btn{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3);padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500;cursor:pointer;margin-left:8px;transition:.2s}.notification-toast .refresh-btn:hover,.notification-toast .undo-btn:hover,div[style*="position: fixed"][style*="top: 20px"][style*="right: 20px"] .refresh-btn:hover,div[style*="position: fixed"][style*="top: 20px"][style*="right: 20px"] .undo-btn:hover{background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.5);transform:translateY(-1px)}.notification-toast.notification-info .refresh-btn{background:rgba(255,255,255,.25);border-color:rgba(255,255,255,.4)}.notification-toast.notification-info .refresh-btn:hover{background:rgba(255,255,255,.4);border-color:rgba(255,255,255,.6)}@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(400px);opacity:0}}@media (max-width:1200px){.template-manager-body{grid-template-columns:250px 1fr}}@media (max-width:768px){.template-overlay-content{width:98%;height:95%}.template-manager-body{grid-template-columns:1fr;grid-template-rows:auto 1fr}.template-list-panel{border-right:none;border-bottom:1px solid #e2e8f0;max-height:200px}.template-preview-panel{height:150px}}.confirmation-content{margin-bottom:20px}.confirmation-content p{margin:0;font-size:16px;line-height:1.5;color:#2d3748}.confirmation-options{background:#f8f9fa;border:1px solid #e2e8f0;border-radius:8px;padding:15px;margin:25px 0}.confirmation-options .checkbox-group{margin:0;display:flex;align-items:flex-start;gap:10px}.confirmation-options .checkbox-group input[type=checkbox]{margin:3px 0 0;width:auto;flex-shrink:0}.confirmation-options .checkbox-group label{margin:0;font-size:14px;color:#4a5568;line-height:1.4;cursor:pointer}.dark-mode .confirmation-content p{color:#e2e8f0}.dark-mode .confirmation-options{background:#1a202c;border-color:#4a5568}.dark-mode .confirmation-options .checkbox-group label{color:#a0aec0}.copyright-section{margin-top:30px;margin-bottom:0}.copyright-card{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);border-radius:16px;padding:24px;color:#fff;text-align:center;box-shadow:0 8px 32px rgba(0,0,0,.1);border:1px solid rgba(255,255,255,.1)}.copyright-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px}.copyright-header h4{margin:0;font-size:20px;font-weight:600;color:#fff}.copyright-badge{background:rgba(255,255,255,.2);padding:6px 12px;border-radius:20px;font-size:13px;font-weight:500;backdrop-filter:blur(10px)}.copyright-author{margin-bottom:16px}.copyright-author p{margin:0;font-size:15px;opacity:.9}.author-link{color:#fbbf24;text-decoration:none;font-weight:600;transition:.2s;border-bottom:1px solid rgba(251,191,36,.4)}.author-link:hover{color:#fcd34d;border-bottom-color:#fcd34d;text-shadow:0 0 8px rgba(251,191,36,.3)}.copyright-description{margin-bottom:20px}.copyright-description p{margin:0;font-size:14px;line-height:1.6;opacity:.85}.copyright-actions{margin-bottom:16px}.github-button{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.15);color:#fff;text-decoration:none;padding:12px 20px;border-radius:25px;font-weight:500;font-size:14px;transition:.3s;border:1px solid rgba(255,255,255,.2);backdrop-filter:blur(10px)}.github-button:hover{background:rgba(255,255,255,.25);transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2);text-decoration:none;color:#fff}.github-icon{font-size:16px}.copyright-footer{border-top:1px solid rgba(255,255,255,.2);padding-top:16px}.privacy-note{margin:0;font-size:12px;opacity:.7;font-style:italic}.dark-mode .copyright-card{background:linear-gradient(135deg,#1e293b 0,#334155 100%);border-color:rgba(255,255,255,.1)}.dark-mode .copyright-badge{background:rgba(255,255,255,.1)}.dark-mode .author-link{color:#fbbf24;border-bottom-color:rgba(251,191,36,.4)}.dark-mode .author-link:hover{color:#fcd34d;border-bottom-color:#fcd34d}.dark-mode .github-button{background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2)}.dark-mode .github-button:hover{background:rgba(255,255,255,.2)}.dark-mode .copyright-footer{border-top-color:rgba(255,255,255,.1)}.notification-permission-content{max-width:600px;margin:5vh auto}.notification-permission-info p{font-size:16px;line-height:1.6;color:#374151;margin-bottom:20px}.permission-options{display:grid;gap:20px;margin:30px 0}.permission-option{padding:20px;border:2px solid #e5e7eb;border-radius:12px;background:#f9fafb}.permission-option h4{font-size:18px;margin:0 0 10px;color:#111827}.permission-option p{font-size:14px;color:#6b7280;margin:0;line-height:1.5}.permission-clickable{cursor:pointer;transition:.2s}.permission-clickable:hover{border-color:#3b82f6;background:#eff6ff;transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.1)}.permission-note{font-size:14px!important;color:#6b7280!important;text-align:center;margin-top:25px!important}.dark-mode .notification-permission-info p{color:#d1d5db}.dark-mode .permission-option{background:#374151;border-color:#4b5563}.dark-mode .permission-option h4{color:#f3f4f6}.dark-mode .permission-option p{color:#9ca3af}.dark-mode .permission-note{color:#9ca3af!important}.dark-mode .permission-clickable:hover{border-color:#60a5fa;background:#1e3a8a;box-shadow:0 4px 8px rgba(0,0,0,.3)}.diagnostics-container{margin-top:20px}.diagnostic-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:25px;margin-top:20px}.diagnostic-card{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:20px;transition:.3s}.diagnostic-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.1);transform:translateY(-2px)}.diagnostic-card.dangerous{border-color:#fed7d7;background:#fffaf0}.diagnostic-card h4{margin:0 0 12px;color:#2d3748;font-size:16px;font-weight:600}.diagnostic-warning{color:#d69e2e;font-size:13px;margin:0 0 15px;font-weight:500}.diagnostic-buttons{display:flex;flex-direction:column;gap:10px}.diagnostic-btn{display:flex;align-items:center;gap:8px;padding:10px 16px;border-radius:8px;font-size:14px;font-weight:500;transition:.2s;text-align:left;justify-content:flex-start}.diagnostic-btn .btn-icon{font-size:16px;line-height:1}.diagnostic-btn:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.15)}.dark-mode .diagnostic-card{background:#2d3748;border-color:#4a5568}.dark-mode .diagnostic-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.3)}.dark-mode .diagnostic-card.dangerous{border-color:#c53030;background:#3c2415}.dark-mode .diagnostic-card h4{color:#e2e8f0}.dark-mode .diagnostic-warning{color:#ed8936}.activity-hours-info{margin-bottom:25px}.activity-hours-info p{margin:0 0 16px;line-height:1.6;color:#4a5568}.activity-hours-info p:last-child{margin-bottom:0}.activity-hours-info ul{margin:16px 0;padding-left:24px}.activity-hours-info li{margin:8px 0;line-height:1.5;color:#4a5568}.activity-hours-info strong{color:#2d3748;font-weight:600}.dark-mode .activity-hours-info li,.dark-mode .activity-hours-info p{color:#cbd5e0}.dark-mode .activity-hours-info strong{color:#e2e8f0}.alert-btn{background:#e53e3e!important;color:#fff!important;animation:2s ease-in-out infinite alertPulse;border:1px solid #c53030!important}.alert-btn:hover{background:#c53030!important;border-color:#9c2626!important}@keyframes alertPulse{0%,100%{box-shadow:0 0 8px rgba(229,62,62,.6);transform:scale(1)}50%{box-shadow:0 0 16px rgba(229,62,62,.8);transform:scale(1.02)}}.overdue-items-list{margin:20px 0;max-height:400px;overflow-y:auto}.overdue-item{background:#fef5e7;border:1px solid #f6ad55;border-radius:8px;padding:0;margin:12px 0;position:relative;display:flex;flex-direction:column}.overdue-item.critical{background:#fed7d7;border-color:#fc8181}.overdue-item-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}.overdue-item-title{font-weight:600;color:#d69e2e;margin:0;flex:1}.overdue-item.critical .overdue-item-title{color:#c53030}.overdue-time{font-size:12px;color:#d69e2e;font-weight:500;background:rgba(214,158,46,.1);padding:4px 8px;border-radius:4px;margin-left:12px}.overdue-item.critical .overdue-time{color:#c53030;background:rgba(197,48,48,.1)}.overdue-item-description{color:#744210;font-size:14px;margin:8px 0 0;line-height:1.4}.overdue-item.critical .overdue-item-description{color:#742a2a}.overdue-item-due-date{font-size:12px;color:#a0aec0;margin-top:8px}.overdue-item-content{padding:16px;flex:1;cursor:pointer;transition:background-color .2s}.overdue-item-content:hover,.overdue-item.critical .overdue-item-content:hover{background:rgba(0,0,0,.05)}.overdue-item-actions{padding:12px 16px;border-top:1px solid rgba(0,0,0,.1);background:rgba(0,0,0,.05);display:flex;gap:8px;align-items:center;justify-content:flex-start}.overdue-item.critical .overdue-item-actions{border-top-color:rgba(197,48,48,.2);background:rgba(197,48,48,.05)}.reschedule-dropdown{position:relative}.reschedule-options{position:fixed;background:#fff;border:1px solid #e2e8f0;border-radius:6px;box-shadow:0 4px 6px rgba(0,0,0,.1);z-index:10001;min-width:140px}.reschedule-options button{display:block;width:100%;padding:8px 12px;border:none;background:0 0;text-align:left;cursor:pointer;font-size:13px;color:#4a5568;transition:background-color .2s}.reschedule-options button:hover{background:#f7fafc;color:#2d3748}.reschedule-options button:first-child{border-radius:6px 6px 0 0}.reschedule-options button:last-child{border-radius:0 0 6px 6px}.entry-due-countdown{font-size:11px;padding:2px 6px;border-radius:4px;margin-left:8px;font-weight:500}.entry-due-countdown.upcoming{background:#e6fffa;color:#038770;border:1px solid #81e6d9}.entry-due-countdown.soon{background:#fefcbf;color:#d69e2e;border:1px solid #f6e05e}.entry-due-countdown.overdue{background:#fed7d7;color:#c53030;border:1px solid #fc8181;animation:2s ease-in-out infinite overdueGlow}@keyframes overdueGlow{0%,100%{box-shadow:0 0 4px rgba(197,48,48,.3)}50%{box-shadow:0 0 8px rgba(197,48,48,.6)}}.dark-mode .overdue-item{background:#2d3748;border-color:#ed8936}.dark-mode .overdue-item.critical{background:#3c2415;border-color:#e53e3e}.dark-mode .overdue-item-title{color:#ed8936}.dark-mode .overdue-item.critical .overdue-item-title{color:#fc8181}.dark-mode .overdue-item-description{color:#cbd5e0}.dark-mode .overdue-time{color:#ed8936;background:rgba(237,137,54,.1)}.dark-mode .overdue-item.critical .overdue-time{color:#fc8181;background:rgba(252,129,129,.1)}.dark-mode .overdue-item-content:hover,.dark-mode .overdue-item.critical .overdue-item-content:hover{background:rgba(255,255,255,.1)}.dark-mode .overdue-item-actions{border-top-color:rgba(255,255,255,.1);background:rgba(255,255,255,.05)}.dark-mode .overdue-item.critical .overdue-item-actions{border-top-color:rgba(252,129,129,.2);background:rgba(252,129,129,.05)}.dark-mode .reschedule-options{background:#2d3748;border-color:#4a5568;z-index:10001}.dark-mode .reschedule-options button{color:#cbd5e0}.dark-mode .reschedule-options button:hover{background:#4a5568;color:#f7fafc}.hashtag-suggestions{background:#fff;border:1px solid #e2e8f0;border-radius:6px;box-shadow:0 4px 6px rgba(0,0,0,.1);max-height:200px;overflow-y:auto}.hashtag-suggestion{padding:8px 12px;cursor:pointer;border-bottom:1px solid #f7fafc;font-size:14px;color:#4a5568;transition:background-color .2s}.hashtag-suggestion:last-child{border-bottom:none}.hashtag-suggestion.selected,.hashtag-suggestion:hover{background:#f7fafc;color:#2d3748}.hashtag-suggestion.selected{background:#ebf4ff;color:#2b6cb0}.dark-mode .hashtag-suggestions{background:#2d3748;border-color:#4a5568}.dark-mode .hashtag-suggestion{color:#cbd5e0;border-bottom-color:#4a5568}.dark-mode .hashtag-suggestion.selected,.dark-mode .hashtag-suggestion:hover{background:#4a5568;color:#f7fafc}.dark-mode .hashtag-suggestion.selected{background:#3182ce;color:#e2e8f0}.dark-mode .entry-due-countdown.upcoming{background:#1a202c;color:#68d391;border-color:#38a169}.dark-mode .entry-due-countdown.soon{background:#2d3748;color:#ed8936;border-color:#dd6b20}.dark-mode .entry-due-countdown.overdue{background:#3c2415;color:#fc8181;border-color:#e53e3e}.entry-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.entry-toggle-btn{background:rgba(255,255,255,.8);border:1px solid #e2e8f0;border-radius:8px;padding:8px 12px;cursor:pointer;transition:.3s;font-size:18px;display:flex;align-items:center;justify-content:center;min-width:44px;height:44px}.entry-toggle-btn:hover{background:#fff;border-color:#cbd5e0;transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.1)}.entry-toggle-btn.hidden-form{background:#667eea;color:#fff;border-color:#667eea}.entry-toggle-btn.hidden-form:hover{background:#5a67d8;border-color:#5a67d8}.entry-toggle-btn.glow-hint{animation:2s ease-in-out infinite glowPulse;box-shadow:0 0 12px rgba(102,126,234,.6)}@keyframes glowPulse{0%,100%{box-shadow:0 0 12px rgba(102,126,234,.6)}50%{box-shadow:0 0 20px rgba(102,126,234,.8)}}.toggle-icon{transition:transform .3s}.entry-toggle-btn.hidden-form .toggle-icon{transform:rotate(180deg)}.dark-mode .entry-toggle-btn{background:rgba(45,55,72,.8);border-color:#4a5568;color:#e2e8f0}.dark-mode .entry-toggle-btn:hover{background:#2d3748;border-color:#718096}.dark-mode .entry-toggle-btn.hidden-form{background:#667eea;border-color:#667eea;color:#fff}.section-separator{height:1px;background:linear-gradient(90deg,transparent,#e2e8f0,transparent);margin:30px 0}.dark-mode .section-separator{background:linear-gradient(90deg,transparent,#4a5568,transparent)}.activity-entry-component{transition:max-height .6s cubic-bezier(.4, 0, .2, 1);overflow:hidden;max-height:500px}#todoEntryComponent{max-height:650px}#notesEntryComponent{max-height:550px}.activity-entry-component.collapsed{max-height:64px}.activity-entry-component .section-separator,.activity-entry-component form{opacity:1;transform:translateY(0)}.activity-entry-component.collapsed .section-separator,.activity-entry-component.collapsed form{opacity:1;transform:translateY(0);pointer-events:none}.schedule-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.schedule-mode-toggle .checkbox-group.inline{margin:0}.schedule-mode{margin-bottom:16px}.complex-schedule-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:16px}.day-schedule{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:16px}.day-schedule h5{margin:0 0 12px;color:#2d3748;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:.5px}.time-ranges{min-height:40px;margin-bottom:12px}.time-range{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:8px;background:#fff;border:1px solid #e2e8f0;border-radius:6px}.time-range input[type=time]{font-size:12px;padding:4px 8px;border:1px solid #cbd5e0;border-radius:4px;background:#fff}.time-range .range-separator{color:#718096;font-weight:500;font-size:12px}.time-range .remove-range{background:#fed7d7;color:#c53030;border:none;width:24px;height:24px;border-radius:4px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.time-range .remove-range:hover{background:#feb2b2}.btn-small{font-size:12px;padding:6px 12px;height:auto;background:#667eea;color:#fff;border:none;border-radius:4px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:4px}.btn-small:hover{background:#5a67d8}.empty-schedule{color:#718096;font-style:italic;font-size:13px;padding:16px 0;text-align:center}.dark-mode .day-schedule{background:#2d3748;border-color:#4a5568}.dark-mode .day-schedule h5{color:#e2e8f0}.dark-mode .time-range{background:#1a202c;border-color:#4a5568}.dark-mode .time-range input[type=time]{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode .time-range .range-separator{color:#a0aec0}.dark-mode .time-range .remove-range{background:#742a2a;color:#feb2b2}.dark-mode .time-range .remove-range:hover{background:#9c4221}.dark-mode .empty-schedule{color:#a0aec0}.diagnostics-modal-content{max-width:800px;max-height:90vh;width:90vw}.diagnostics-container{position:relative;min-height:200px}.diagnostics-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:#718096}.loading-spinner{width:32px;height:32px;border:3px solid #e2e8f0;border-top:3px solid #667eea;border-radius:50%;animation:1s linear infinite spin;margin-bottom:16px}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.diagnostics-content{font-family:'SF Mono',Monaco,Inconsolata,'Roboto Mono',monospace;font-size:.875rem;line-height:1.5;max-height:60vh;overflow-y:auto;background:#f8f9fa;border-radius:8px;padding:20px;border:1px solid #e2e8f0}.diagnostics-section{margin-bottom:20px}.diagnostics-section:last-child{margin-bottom:0}.diagnostics-header{font-weight:600;font-size:.9rem;color:#2d3748;margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid #e2e8f0;text-transform:uppercase;letter-spacing:.5px}.diagnostics-item{display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid #f1f5f9}.diagnostics-item:last-child{border-bottom:none}.diagnostics-label{color:#4a5568;font-weight:500}.diagnostics-value{color:#2d3748;font-family:inherit;text-align:right;max-width:60%;word-break:break-word}.diagnostics-value.success{color:#38a169}.diagnostics-value.warning{color:#d69e2e}.diagnostics-value.error{color:#e53e3e}.diagnostics-subitem{padding-left:16px;font-size:.8rem;color:#718096}.diagnostics-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:16px}.diagnostics-card{background:#fff;border-radius:6px;padding:16px;border:1px solid #e2e8f0;box-shadow:0 1px 3px rgba(0,0,0,.1)}.diagnostics-card h4{margin:0 0 12px;font-size:.875rem;font-weight:600;color:#2d3748;text-transform:uppercase;letter-spacing:.5px}.dark-mode .diagnostics-content{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode .diagnostics-header{color:#e2e8f0;border-color:#4a5568}.dark-mode .diagnostics-item{border-color:#4a5568}.dark-mode .diagnostics-label{color:#a0aec0}.dark-mode .diagnostics-value{color:#e2e8f0}.dark-mode .diagnostics-card{background:#374151;border-color:#4a5568}.dark-mode .diagnostics-card h4{color:#e2e8f0}.dark-mode .loading-spinner{border-color:#667eea #4a5568 #4a5568}</style></head><body><div class="container"><div class="header"><div class="header-content"><div class="header-text"><h1><span class="header-text">Activity Tracker</span></h1><p>Task diary, organiser and knowledge base</p></div></div><div class="global-search"><div class="search-container"><input id="globalSearch" placeholder="Search activities, todos, and hashtags..." autocomplete="off"> <button class="hashtag-browser-btn" onclick="showHashtagBrowser()" title="Browse hashtags"></button><div class="search-results" id="searchResults" style="display:none"></div></div></div><div class="nav"><div class="nav-left"><button class="nav-btn active" onclick="showSection('tracker', event)"> Tracker</button> <button class="nav-btn" onclick="showSection('todo', event)"> To Do</button> <button class="nav-btn" onclick="showSection('notes', event)"> Notes</button></div><div class="nav-right"><button id="overdueAlertButton" class="nav-btn alert-btn" onclick="showOverdueAlert()" style="display:none" title="View overdue items"> Alert</button> <button id="pauseButton" class="nav-btn" onclick="togglePause()">Start Reminders</button> <button id="pomodoroButton" class="nav-btn pomodoro-btn" onclick="togglePomodoro()" style="display:none"> Start Pomodoro</button><div id="burgerAnchor" class="burger-anchor"></div></div></div></div><div class="burger-menu"><button class="burger-btn" onclick="toggleBurgerMenu()" title="Settings menu"><span class="burger-line"></span> <span class="burger-line"></span> <span class="burger-line"></span></button><div class="burger-dropdown" id="burgerDropdown" style="display:none"><button class="burger-item" onclick="showSection('tracker', event); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">Tracker</span></button> <button class="burger-item" onclick="showSection('notes', event); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">Notes</span></button> <button class="burger-item" onclick="showSection('todo', event); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">To Do</span></button><div class="burger-separator"></div><button class="burger-item" onclick="showSection('reports', event); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">Reports</span></button><div class="burger-separator"></div><button class="burger-item" onclick="openWorkspaceManager(); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">Workspaces</span></button><div class="burger-separator"></div><button class="burger-item" onclick="showSection('settings', event); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">Settings...</span></button> <button class="burger-item" onclick="showSection('diagnostics', event); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">Diagnostics</span></button> <button class="burger-item" onclick="showUserGuide(); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">User Guide</span></button> <button class="burger-item" onclick="showAbout(); closeBurgerMenu()"><span class="burger-emoji"></span><span class="burger-text">About</span></button></div></div><div id="statusBanner" class="status-banner" style="display:none"><div class="status-banner-content"><div id="pomodoroStatusSection" class="status-section" style="display:none"><div class="pomodoro-bar"><div id="pomodoroStatus" class="status-label">Pomodoro mode disabled</div><div id="pomodoroTimer" class="pomodoro-active-bar" style="display:none"><div class="pomodoro-tomato"></div><div id="pomodoroPhase" class="session-number">#1</div><div id="pomodoroTimeRemaining" class="countdown-timer">25:00</div><div id="pomodoroActivityDisplay" class="work-item" style="display:none"><div id="pomodoroActivityText" class="work-title"></div><div id="pomodoroActivityDesc" class="work-desc"></div></div></div></div><div id="pomodoroBannerControls" class="status-controls" style="display:none"><button id="pomodoroPauseBtn" class="status-button" onclick="togglePomodoroPause()">Pause</button></div></div><div id="reminderStatusSection" class="status-section" style="display:none"><div class="status-info"><div id="reminderStatus" class="status-label">Next activity logging reminder in:</div><div id="reminderTimer" class="status-timer"><span id="reminderTimeRemaining">--:--</span></div></div></div></div></div><div id="tracker" class="section active"><div class="activity-entry-component" id="trackerEntryComponent"><div class="entry-header"><h2 id="entryTitle">Activity Entry</h2><button class="entry-toggle-btn" id="trackerToggleBtn" onclick="toggleEntryForm('tracker')" title="Hide/Show entry form"><span class="toggle-icon"></span></button></div><form id="activityForm"><div class="form-group"><label for="activity" id="activityLabel">What are you doing?</label> <input id="activity" required placeholder="e.g., Writing report, Meeting with team #work" autocomplete="off"></div><div class="form-group"><label for="description" id="descriptionLabel">Description (optional)</label> <textarea id="description" rows="3" placeholder="Additional details about this activity"></textarea></div><div class="form-group form-group-row"><div class="form-group"><label for="timestamp">Time</label> <input type="datetime-local" id="timestamp" required><div class="todo-quick-set"><button type="button" class="btn-quick-set" id="todoToggleBtn" onclick="toggleTodoMode()" title="Mark this as a todo item (Ctrl+T to toggle)">Mark as Todo</button> <button type="button" class="btn-quick-set" id="noteToggleBtn" onclick="toggleNoteMode()" title="Mark this as a note (Ctrl+N to toggle)">Mark as Note</button></div></div><div class="form-group" id="dueDateSection"><label for="dueDate">Due Date (optional)</label> <input type="datetime-local" id="dueDate"><div class="due-date-quick-sets"><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('dueDate', -1, 'day')">-1d</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('dueDate', 1, 'day')">+1d</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('dueDate', -1, 'week')">-1w</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('dueDate', 1, 'week')">+1w</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('dueDate', -1, 'month')">-1m</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('dueDate', 1, 'month')">+1m</button></div></div></div></div><div class="form-actions-split"><button type="submit" class="btn btn-primary" id="addEntryBtn">Add Entry</button> <button type="button" class="btn btn-secondary" onclick="resetActivityForm()">Reset</button></div></form><div class="section-separator"></div></div><div class="entries-list"><h3>Recent Entries</h3><div id="entriesList"></div><div class="entries-pagination" id="entriesPagination" style="display:none"><button class="nav-btn" id="entriesPrevBtn" onclick="tracker.previousEntriesPage()"> Previous</button> <span id="entriesPageInfo"></span> <button class="nav-btn" id="entriesNextBtn" onclick="tracker.nextEntriesPage()">Next </button></div></div></div><div id="todo" class="section"><div class="activity-entry-component" id="todoEntryComponent"><div class="entry-header"><h2 id="todoEntryTitle">New Todo Item</h2><button class="entry-toggle-btn" id="todoToggleBtn2" onclick="toggleEntryForm('todo')" title="Hide/Show entry form"><span class="toggle-icon"></span></button></div><form id="todoActivityForm"><div class="form-group"><label for="todoActivity" id="todoActivityLabel">What do you need to do?</label> <input id="todoActivity" required placeholder="e.g., Call client about project, Review budget #work" autocomplete="off"></div><div class="form-group"><label for="todoDescription" id="todoDescriptionLabel">Description (optional)</label> <textarea id="todoDescription" rows="3" placeholder="Additional details about this todo item"></textarea></div><div class="form-group form-group-row"><div class="form-group"><label for="todoTimestamp">Time</label> <input type="datetime-local" id="todoTimestamp" required><div class="todo-quick-set"><button type="button" class="btn-quick-set active" id="todoTodoToggleBtn" onclick="toggleTodoModeForTodo()" title="Mark this as a todo item">Mark as Todo</button> <button type="button" class="btn-quick-set" id="todoNoteToggleBtn" onclick="toggleNoteModeForTodo()" title="Mark this as a note">Mark as Note</button></div></div><div class="form-group" id="todoDueDateSection"><label for="todoDueDate">Due Date (optional)</label> <input type="datetime-local" id="todoDueDate"><div class="due-date-quick-sets"><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('todoDueDate', -1, 'day')">-1d</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('todoDueDate', 1, 'day')">+1d</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('todoDueDate', -1, 'week')">-1w</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('todoDueDate', 1, 'week')">+1w</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('todoDueDate', -1, 'month')">-1m</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('todoDueDate', 1, 'month')">+1m</button></div></div></div></div><div class="form-actions-split"><button type="submit" class="btn btn-primary" id="todoAddEntryBtn">Add Todo</button> <button type="button" class="btn btn-secondary" onclick="resetTodoForm()">Reset</button></div></form><div class="section-separator"></div></div><h3>To Do List</h3><div class="todo-filters"><div class="filter-row"><div class="filter-group"><label for="todoFilter">Filter:</label> <select id="todoFilter" onchange="tracker.filterTodos()"><option value="all">All Todos</option><option value="due-today">Due Today</option><option value="overdue">Overdue</option><option value="no-due-date">No Due Date</option></select></div><div class="filter-group"><label for="todoSort">Sort by:</label> <select id="todoSort" onchange="tracker.sortTodos()"><option value="created-desc">Newest First</option><option value="created-asc">Oldest First</option><option value="due-asc">Due Date (Earliest)</option><option value="due-desc">Due Date (Latest)</option><option value="activity-asc">Activity A-Z</option><option value="activity-desc">Activity Z-A</option></select></div></div></div><div class="todo-stats" id="todoStats"><span id="todoCount">0 todos</span></div><div class="todo-list" id="todoList"><p class="empty-state">No todos found. Add activities as todos to see them here!</p></div><div class="todo-pagination" id="todoPagination" style="display:none"><button class="nav-btn" id="todoPrevBtn" onclick="tracker.previousTodoPage()"> Previous</button> <span id="todoPageInfo">Page 1 of 1</span> <button class="nav-btn" id="todoNextBtn" onclick="tracker.nextTodoPage()">Next </button></div></div><div id="notes" class="section"><div class="activity-entry-component" id="notesEntryComponent"><div class="entry-header"><h2 id="notesEntryTitle">New Note</h2><button class="entry-toggle-btn" id="notesToggleBtn2" onclick="toggleEntryForm('notes')" title="Hide/Show entry form"><span class="toggle-icon"></span></button></div><form id="notesActivityForm"><div class="form-group"><label for="notesActivity" id="notesActivityLabel">Note title or topic</label> <input id="notesActivity" required placeholder="e.g., Meeting notes, Ideas for project #brainstorm" autocomplete="off"></div><div class="form-group"><label for="notesDescription" id="notesDescriptionLabel">Note content</label> <textarea id="notesDescription" rows="3" placeholder="Write your note content here..."></textarea></div><div class="form-group form-group-row"><div class="form-group"><label for="notesTimestamp">Time</label> <input type="datetime-local" id="notesTimestamp" required><div class="todo-quick-set"><button type="button" class="btn-quick-set" id="notesTodToggleBtn" onclick="toggleTodoModeForNotes()" title="Mark this as a todo item">Mark as Todo</button> <button type="button" class="btn-quick-set active" id="notesNoteToggleBtn" onclick="toggleNoteModeForNotes()" title="Mark this as a note">Mark as Note</button></div></div><div class="form-group" id="notesDueDateSection" style="display:none"><label for="notesDueDate">Due Date (optional)</label> <input type="datetime-local" id="notesDueDate"><div class="due-date-quick-sets"><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('notesDueDate', -1, 'day')">-1d</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('notesDueDate', 1, 'day')">+1d</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('notesDueDate', -1, 'week')">-1w</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('notesDueDate', 1, 'week')">+1w</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('notesDueDate', -1, 'month')">-1m</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('notesDueDate', 1, 'month')">+1m</button></div></div></div></div><div class="form-actions-split"><button type="submit" class="btn btn-primary" id="notesAddEntryBtn">Add Note</button> <button type="button" class="btn btn-secondary" onclick="resetNotesForm()">Reset</button></div></form><div class="section-separator"></div></div><h3>Notes</h3><div class="notes-filters"><div class="filter-row"><div class="filter-group"><label for="noteFilter">Filter:</label> <select id="noteFilter" onchange="tracker.filterNotes()"><option value="all">All Notes</option><option value="today">Today</option><option value="week">This Week</option><option value="month">This Month</option></select></div><div class="filter-group"><label for="noteSort">Sort:</label> <select id="noteSort" onchange="tracker.sortNotes()"><option value="newest">Newest First</option><option value="oldest">Oldest First</option><option value="activity">Activity Name</option></select></div><div class="filter-group"><input id="noteSearchInput" placeholder="Search through notes..." onkeyup="tracker.searchNotes()" oninput="tracker.toggleNoteClearButton()" autocomplete="off"> <button class="btn btn-secondary btn-small" id="noteClearBtn" onclick="tracker.clearNoteSearch()" style="display:none">Clear</button></div></div></div><div id="noteList" class="entry-list"><p class="no-entries">No notes found.</p></div><div class="notes-pagination" id="notesPagination" style="display:none"><button class="nav-btn" id="notesPrevBtn" onclick="tracker.previousNotePage()"> Previous</button> <span id="notesPageInfo">Page 1 of 1</span> <button class="nav-btn" id="notesNextBtn" onclick="tracker.nextNotePage()">Next </button></div></div><div id="reports" class="section"><h2>Activity Reports</h2><div class="reports-grid"><div class="reports-section"><h3>Date Range</h3><p class="settings-description">Select the time period for your report</p><div class="form-group"><label for="reportStartDate" title="Choose the start date for your report">Start Date</label> <input type="date" id="reportStartDate"></div><div class="form-group"><label for="reportEndDate" title="Choose the end date for your report">End Date</label> <input type="date" id="reportEndDate"></div><div class="report-actions"><button class="btn btn-primary" onclick="generateReport()" title="Generate report for the selected date range">Generate Report</button> <button class="btn btn-secondary" onclick="setWeeklyReport()" title="Set date range to current week">This Week</button></div></div><div class="reports-section"><h3>Template & Options</h3><p class="settings-description">Choose format, options and download your report</p><div class="form-group"><label for="reportTemplate" title="Select the format for your report">Report Template</label> <select id="reportTemplate" onchange="tracker.previewReport()"></select></div><div class="form-group"><label for="includeTodos">Todo Items:</label> <select id="includeTodos" onchange="tracker.generateReport()"><option value="exclude">Exclude all todos</option><option value="incomplete">Include incomplete todos only</option><option value="all">Include all todos</option></select></div><div class="form-group"><label for="includeNotes">Notes:</label> <select id="includeNotes" onchange="tracker.generateReport()"><option value="exclude">Exclude notes</option><option value="include">Include notes</option></select></div><div class="download-actions"><button class="btn btn-success" onclick="downloadReport()" title="Download the generated report">Download Report</button> <button class="btn btn-primary" onclick="openReportInNewTab()" title="Open the generated report in a new tab">Open in New Tab</button></div></div></div><div class="report-navigation-section"><div class="report-navigation"><button class="nav-btn" onclick="previousWeek()"> Previous Week</button><div class="week-display" id="weekDisplay">Week of ...</div><button class="nav-btn" onclick="nextWeek()">Next Week </button></div></div><div id="reportPreviewContainer" class="report-preview-container"><div class="report-preview-header"><h3>Report Preview</h3><div class="preview-controls"><div class="preview-format-tabs"><button class="preview-tab active" id="reportPreviewTabRendered" onclick="switchReportPreviewTab('rendered')" title="View the formatted report output">Rendered</button> <button class="preview-tab" id="reportPreviewTabSource" onclick="switchReportPreviewTab('source')" title="View the raw source code of the report">Source</button></div><button class="btn-copy-report" id="copyReportBtn" onclick="copyReportToClipboard()" title="Copy report content to clipboard" style="display:none">Copy Report</button></div></div><div id="reportPreview" class="report-preview-content">Select a date range and generate a report to see a preview.</div></div><div class="report-templates-section"><div class="settings-card"><h3>Report Templates</h3><p class="card-description">Manage templates for report generation</p><div class="card-actions"><button class="btn btn-primary" onclick="openTemplateManager()" title="Open the template editor to create and modify report templates">Manage Templates</button> <button class="btn btn-secondary" onclick="resetReportTemplates()" title="Restore all templates to their original default versions">Reset to Default</button> <button class="btn btn-info" onclick="showTemplateGuide()" title="View help documentation for template syntax and available data"> Template Guide</button></div></div></div></div><div id="settings" class="section"><h2>Settings</h2><div class="notification-status" id="notificationStatus"><span class="status-indicator" id="statusIndicator"></span> <span id="statusText">Checking notification status...</span></div><div class="settings-buttons-section"><div class="reminder-buttons"><button class="btn btn-primary" onclick="enableNotifications()">Enable Reminders</button></div></div><div class="settings-section general-settings"><h3>General Settings</h3><p class="settings-description">Settings that apply to all modes of operation</p><div class="settings-grid settings-grid-four-col"><div class="form-group"><label for="darkModePreference" title="Choose your colour theme preference">Colour Theme</label> <select id="darkModePreference" onchange="saveSettings()"><option value="system">Follow system settings</option><option value="light">Light mode</option><option value="dark">Dark mode</option></select></div><div class="form-group"><label for="soundMuteMode" title="Choose which sounds to mute">Sound Settings</label> <select id="soundMuteMode" onchange="saveSettings()"><option value="none">All sounds enabled</option><option value="all">Mute all sounds</option><option value="pomodoro">Mute Pomodoro sounds only</option><option value="notifications">Mute notification sounds only</option></select></div><div class="form-group"><label for="paginationSize" title="Number of items to show per page in lists">Items per page</label> <select id="paginationSize" onchange="saveSettings()"><option value="10">10 items</option><option value="20" selected="selected">20 items</option><option value="30">30 items</option><option value="50">50 items</option><option value="100">100 items</option></select></div><div class="form-group"><label for="hashtagCloudLimit" title="Maximum number of hashtags to display in the hashtag cloud browser">Hashtag cloud limit</label> <select id="hashtagCloudLimit" onchange="saveSettings()"><option value="25">25 hashtags</option><option value="50" selected="selected">50 hashtags</option><option value="75">75 hashtags</option><option value="100">100 hashtags</option><option value="200">200 hashtags</option></select></div><div class="form-group" id="systemNotificationsGroup" style="display:none"><label for="sendSystemNotifications" title="Send system notifications to your operating system">System Notifications</label> <select id="sendSystemNotifications" onchange="saveSettings()"><option value="true" selected="selected">Yes</option><option value="false">No</option></select></div></div></div><div class="settings-grid settings-grid-two-col"><div class="settings-section"><h3>Reminder Settings</h3><div class="form-group"><label for="notificationInterval" title="How often you'll receive activity reminder notifications">Reminder Interval</label> <select id="notificationInterval" onchange="saveSettings()"><option value="1">1 minute</option><option value="2">2 minutes</option><option value="5">5 minutes</option><option value="15">15 minutes</option><option value="30">30 minutes</option><option value="60" selected="selected">1 hour</option><option value="90">1.5 hours</option><option value="120">2 hours</option><option value="180">3 hours</option><option value="240">4 hours</option></select></div><div class="form-group"><label for="pauseDuration" title="How long alerts remain paused before automatically resuming">When pausing, resume after</label> <select id="pauseDuration" onchange="saveSettings()"><option value="1">1 minute</option><option value="2">2 minutes</option><option value="5">5 minutes</option><option value="15">15 minutes</option><option value="30">30 minutes</option><option value="60">1 hour</option><option value="90">1.5 hours</option><option value="120">2 hours</option><option value="180">3 hours</option><option value="240">4 hours</option><option value="480">8 hours</option><option value="1440">24 hours</option><option value="-1">Never</option></select></div><div class="form-group"><label for="autoStartAlerts" title="Automatically start reminders when the app opens">Auto start reminders upon opening app</label> <select id="autoStartAlerts" onchange="saveSettings()"><option value="false" selected="selected">No</option><option value="true">Yes</option></select></div><div class="form-group"><label for="notificationSoundType" title="Choose the sound that plays with reminders">Reminder Sound</label> <select id="notificationSoundType" onchange="previewNotificationSound()"></select></div><div class="form-group"><label for="reminderTimerReset" title="Choose when the reminder timer should be reset">Reset reminder timer</label> <select id="reminderTimerReset" onchange="saveSettings()"><option value="on_add" selected="selected">Reset timer on add entry</option><option value="on_add_edit">Reset timer on add/edit entry</option><option value="never">Do not reset timer</option></select></div></div><div class="settings-section"><h3>Activity Schedule</h3><p class="settings-description">Set your active activity hours and days for notifications</p><div class="schedule-section"><div class="schedule-header"><h4>Activity Hours</h4><div class="schedule-mode-toggle"><div class="checkbox-group inline"><input type="checkbox" id="useComplexSchedule" onchange="toggleScheduleMode()"> <label for="useComplexSchedule" title="Enable complex scheduling with multiple time ranges per day">Complex Schedule</label></div></div></div><div id="simpleSchedule" class="schedule-mode"><div class="time-inputs"><div class="form-group"><label for="startTime" title="When your activity period starts">Start Time</label> <input type="time" id="startTime" value="08:00" onchange="saveSettings()"></div><div class="form-group"><label for="endTime" title="When your activity period ends">End Time</label> <input type="time" id="endTime" value="18:00" onchange="saveSettings()"></div></div></div><div id="complexSchedule" class="schedule-mode" style="display:none"><p class="settings-description">Set multiple time ranges for each day to accommodate complex schedules.</p><div class="complex-schedule-container"><div class="day-schedule" data-day="monday"><h5>Monday</h5><div class="time-ranges" id="monday-ranges"></div><button type="button" class="btn btn-small" onclick="addTimeRange('monday')">+ Add Range</button></div><div class="day-schedule" data-day="tuesday"><h5>Tuesday</h5><div class="time-ranges" id="tuesday-ranges"></div><button type="button" class="btn btn-small" onclick="addTimeRange('tuesday')">+ Add Range</button></div><div class="day-schedule" data-day="wednesday"><h5>Wednesday</h5><div class="time-ranges" id="wednesday-ranges"></div><button type="button" class="btn btn-small" onclick="addTimeRange('wednesday')">+ Add Range</button></div><div class="day-schedule" data-day="thursday"><h5>Thursday</h5><div class="time-ranges" id="thursday-ranges"></div><button type="button" class="btn btn-small" onclick="addTimeRange('thursday')">+ Add Range</button></div><div class="day-schedule" data-day="friday"><h5>Friday</h5><div class="time-ranges" id="friday-ranges"></div><button type="button" class="btn btn-small" onclick="addTimeRange('friday')">+ Add Range</button></div><div class="day-schedule" data-day="saturday"><h5>Saturday</h5><div class="time-ranges" id="saturday-ranges"></div><button type="button" class="btn btn-small" onclick="addTimeRange('saturday')">+ Add Range</button></div><div class="day-schedule" data-day="sunday"><h5>Sunday</h5><div class="time-ranges" id="sunday-ranges"></div><button type="button" class="btn btn-small" onclick="addTimeRange('sunday')">+ Add Range</button></div></div></div></div><div class="schedule-section"><h4>Activity Days</h4><div class="activity-days-grid"><div class="checkbox-group"><input type="checkbox" id="monday" checked="checked" onchange="saveSettings()"> <label for="monday">Monday</label></div><div class="checkbox-group"><input type="checkbox" id="tuesday" checked="checked" onchange="saveSettings()"> <label for="tuesday">Tuesday</label></div><div class="checkbox-group"><input type="checkbox" id="wednesday" checked="checked" onchange="saveSettings()"> <label for="wednesday">Wednesday</label></div><div class="checkbox-group"><input type="checkbox" id="thursday" checked="checked" onchange="saveSettings()"> <label for="thursday">Thursday</label></div><div class="checkbox-group"><input type="checkbox" id="friday" checked="checked" onchange="saveSettings()"> <label for="friday">Friday</label></div><div class="checkbox-group"><input type="checkbox" id="saturday" onchange="saveSettings()"> <label for="saturday">Saturday</label></div><div class="checkbox-group"><input type="checkbox" id="sunday" onchange="saveSettings()"> <label for="sunday">Sunday</label></div></div></div></div></div><div class="pomodoro-section"><div class="settings-card"><h3>Pomodoro Mode</h3><p class="card-description">Structured work/break intervals with automatic notifications</p><div class="pomodoro-settings"><div class="checkbox-group"><input type="checkbox" id="pomodoroEnabled" onchange="saveSettings()"> <label for="pomodoroEnabled" title="Enable Pomodoro timing mode with work and break alerts">Enable Pomodoro Mode</label></div><div class="pomodoro-config" id="pomodoroConfig" style="display:none"><div class="pomodoro-timers"><div class="form-group"><label for="pomodoroWorkDuration" title="Length of work periods in minutes">Work Duration (minutes)</label> <select id="pomodoroWorkDuration" onchange="saveSettings()"><option value="15">15 minutes</option><option value="20">20 minutes</option><option value="25" selected="selected">25 minutes</option><option value="30">30 minutes</option><option value="45">45 minutes</option><option value="60">60 minutes</option></select></div><div class="form-group"><label for="pomodoroBreakDuration" title="Length of short break periods in minutes">Short Break Duration (minutes)</label> <select id="pomodoroBreakDuration" onchange="saveSettings()"><option value="3">3 minutes</option><option value="5" selected="selected">5 minutes</option><option value="10">10 minutes</option><option value="15">15 minutes</option></select></div><div class="form-group"><label for="pomodoroLongBreakDuration" title="Length of long break periods in minutes">Long Break Duration (minutes)</label> <select id="pomodoroLongBreakDuration" onchange="saveSettings()"><option value="15" selected="selected">15 minutes</option><option value="20">20 minutes</option><option value="30">30 minutes</option><option value="45">45 minutes</option><option value="60">60 minutes</option></select></div><div class="form-group"><label for="pomodoroLongBreakInterval" title="Number of work sessions before taking a long break">Sessions before long break</label> <select id="pomodoroLongBreakInterval" onchange="saveSettings()"><option value="2">Every 2 sessions</option><option value="3">Every 3 sessions</option><option value="4" selected="selected">Every 4 sessions</option><option value="5">Every 5 sessions</option><option value="6">Every 6 sessions</option></select></div></div><div class="pomodoro-sounds"><h4>Tick Sounds</h4><div class="form-group"><label for="pomodoroTickSound" title="Optional tick sound to remind you're in a work session">Tick Sound Type</label> <select id="pomodoroTickSound" onchange="saveSettings()"><option value="none" selected="selected">No ticking</option><option value="soft">Soft tick</option><option value="classic">Classic tick</option><option value="digital">Digital tick</option></select></div><div class="form-group"><label for="pomodoroTickInterval" title="How often to play the tick sound in seconds">Tick Interval (seconds)</label> <select id="pomodoroTickInterval" onchange="saveSettings()"><option value="0" selected="selected">Off (no ticking)</option><option value="1">Every 1 second</option><option value="2">Every 2 seconds</option><option value="3">Every 3 seconds</option><option value="4">Every 4 seconds</option><option value="5">Every 5 seconds</option><option value="10">Every 10 seconds</option><option value="15">Every 15 seconds</option><option value="30">Every 30 seconds</option><option value="60">Every minute</option></select></div></div><div class="pomodoro-announce-sounds"><h4>Announce Sounds</h4><div class="form-group"><label for="pomodoroShortBreakSound" title="Sound to play when short break starts">Short Break Announce</label> <select id="pomodoroShortBreakSound" onchange="saveSettings()"></select></div><div class="form-group"><label for="pomodoroLongBreakSound" title="Sound to play when long break starts">Long Break Announce</label> <select id="pomodoroLongBreakSound" onchange="saveSettings()"></select></div><div class="form-group"><label for="pomodoroResumeSound" title="Sound to play when resuming work after break">Resume Work Announce</label> <select id="pomodoroResumeSound" onchange="saveSettings()"></select></div></div><div class="pomodoro-options"><h4>Options</h4><div class="checkbox-group"><input type="checkbox" id="pomodoroAutoStart" onchange="saveSettings()"> <label for="pomodoroAutoStart" title="Automatically start the next session without requiring manual intervention">Automatically start next session</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroAutoLog" checked="checked" onchange="saveSettings()"> <label for="pomodoroAutoLog" title="Prompt for activity description and create log entries for work sessions">Prompt for work session descriptions</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroLogBreaks" onchange="saveSettings()"> <label for="pomodoroLogBreaks" title="Also log break sessions in the activity tracker">Log break sessions too</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroLongBreak" checked="checked" onchange="saveSettings()"> <label for="pomodoroLongBreak" title="Enable long breaks after completing multiple sessions">Enable long breaks</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroPauseAllowed" checked="checked" onchange="saveSettings()"> <label for="pomodoroPauseAllowed" title="Allow pausing Pomodoro sessions from the banner">Allow session pausing</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroAutoResetDaily" onchange="saveSettings()"> <label for="pomodoroAutoResetDaily" title="Automatically reset session counter to 1 when the day changes">Auto-reset sessions daily</label></div></div><div class="pomodoro-session-management"><h5>Session Management</h5><div class="session-actions"><button type="button" class="btn btn-outline btn-warning" onclick="resetPomodoroSessions()" title="Reset session counter back to 1">Reset Session Counter</button></div></div></div></div></div></div><div class="data-management-section"><div class="data-management-grid"><div class="settings-card"><h3>Database Backup</h3><p class="card-description">Export or import your activity data</p><div class="card-actions"><button class="btn btn-primary" onclick="exportDatabase()">Export Database</button> <button class="btn btn-secondary" onclick="importDatabase()">Import Database</button> <input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImportFile(event)"></div></div><div class="settings-card"><h3>Warning Settings</h3><p class="card-description">Configure confirmation dialogs for destructive actions</p><div class="warning-settings"><div class="form-group"><label for="warnOnActivityDelete" title="Show confirmation dialog when deleting activities">Warn on activity delete</label> <select id="warnOnActivityDelete" onchange="saveSettings()"><option value="true" selected="selected">Yes</option><option value="false">No</option></select></div><div class="form-group"><label for="warnOnSessionReset" title="Show confirmation dialog when resetting Pomodoro session counter">Warn on session reset</label> <select id="warnOnSessionReset" onchange="saveSettings()"><option value="true" selected="selected">Yes</option><option value="false">No</option></select></div></div></div></div></div><button class="btn btn-primary" onclick="saveSettings()">Force Manual Save</button></div><div id="diagnostics" class="section"><h2> Diagnostics</h2><div class="diagnostics-container"><div class="settings-section"><h3>System Tests</h3><p class="settings-description">Test various system components and functionality</p><div class="diagnostic-grid"><div class="diagnostic-card"><h4> Notifications</h4><div class="diagnostic-buttons"><button class="btn btn-secondary diagnostic-btn" onclick="testNotification()" title="Send a test reminder"><span class="btn-icon"></span>Test Reminder</button> <button class="btn btn-primary diagnostic-btn" onclick="testNotificationSound()" title="Play a test reminder sound"><span class="btn-icon"></span>Test Sound</button> <button class="btn btn-secondary diagnostic-btn" onclick="refreshNotificationStatus()" title="Refresh the reminder permission status display"><span class="btn-icon"></span>Refresh Status</button> <button class="btn btn-warning diagnostic-btn" onclick="forceEnableNotifications()" title="Force show notification permission dialog"><span class="btn-icon"></span>Force Enable</button></div></div><div class="diagnostic-card"><h4> Service Worker</h4><div class="diagnostic-buttons"><button class="btn btn-secondary diagnostic-btn" onclick="runServiceWorkerTest()" title="Run comprehensive service worker diagnostics"><span class="btn-icon"></span>Run Diagnostics</button></div></div><div class="diagnostic-card"><h4> Version Management</h4><div class="diagnostic-buttons"><button class="btn btn-primary diagnostic-btn" onclick="checkForUpdatesManually()" title="Check for app updates immediately"><span class="btn-icon"></span>Check for Updates</button></div></div><div class="diagnostic-card dangerous"><h4> Data Management</h4><p class="diagnostic-warning">These actions cannot be undone</p><div class="diagnostic-buttons"><button class="btn btn-danger diagnostic-btn" onclick="clearAllData()"><span class="btn-icon"></span>Clear All Data</button></div></div></div></div></div></div><div id="search" class="section"><h2>Search Results</h2><div class="search-controls"><div class="search-info" id="searchInfo"><span id="searchQuery"></span> <span id="searchCount">0 results</span></div><div class="search-options"><div class="filter-group"><label for="searchSort">Sort by:</label> <select id="searchSort" onchange="tracker.sortSearchResults()"><option value="relevance">Relevance</option><option value="date-desc">Newest First</option><option value="date-asc">Oldest First</option><option value="activity-asc">Activity A-Z</option><option value="activity-desc">Activity Z-A</option></select></div><div class="filter-group"><label for="searchFilter">Show:</label> <select id="searchFilter" onchange="tracker.filterSearchResults()"><option value="all">All Items</option><option value="activities">Activities Only</option><option value="todos">Todos Only</option><option value="completed">Completed Only</option></select></div></div></div><div class="search-results-list" id="searchResultsList"><p class="empty-state">Use the search box above to find activities, todos, and hashtags.</p></div><div class="search-pagination" id="searchPagination" style="display:none"><button class="nav-btn" id="searchPrevBtn" onclick="tracker.previousSearchPage()"> Previous</button> <span id="searchPageInfo">Page 1 of 1</span> <button class="nav-btn" id="searchNextBtn" onclick="tracker.nextSearchPage()">Next </button></div></div></div><div id="notificationStack" class="notification-stack"></div><div id="editModal" class="modal"><div class="modal-content edit-modal-content"><div class="modal-header"><h3>Edit Entry</h3><button class="btn-close" onclick="closeEditModal()">&times;</button></div><div class="modal-body"><form id="editForm"><input type="hidden" id="editId"><div class="form-group"><label for="editActivity">Activity</label> <input id="editActivity" required></div><div class="form-group"><label for="editDescription">Description</label> <textarea id="editDescription" rows="3"></textarea></div><div class="form-group form-group-row"><div class="form-group"><label for="editTimestamp">Time</label> <input type="datetime-local" id="editTimestamp" required><div class="todo-quick-set"><button type="button" id="editTodoButton" class="btn-quick-set" onclick="toggleEditTodo()"><span id="editTodoButtonText">Mark as Todo</span></button> <button type="button" id="editNoteButton" class="btn-quick-set" onclick="toggleEditNote()"><span id="editNoteButtonText">Mark as Note</span></button></div></div><div class="form-group" id="editDueDateSection"><label for="editDueDate">Due Date (optional)</label> <input type="datetime-local" id="editDueDate"><div class="due-date-quick-sets"><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('editDueDate', -1, 'day')">-1d</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('editDueDate', 1, 'day')">+1d</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('editDueDate', -1, 'week')">-1w</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('editDueDate', 1, 'week')">+1w</button></div><div class="due-date-group"><button type="button" class="btn-quick-set" onclick="adjustDueDate('editDueDate', -1, 'month')">-1m</button> <button type="button" class="btn-quick-set" onclick="adjustDueDate('editDueDate', 1, 'month')">+1m</button></div></div></div></div><div class="modal-actions"><button type="submit" class="btn btn-primary">Update Entry</button> <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button></div></form></div></div></div><div id="templateManagerOverlay" class="template-overlay"><div class="template-overlay-content"><div class="template-manager-header"><h2>Template Manager</h2><div class="template-manager-actions"><button class="btn btn-primary" onclick="saveAllTemplates()">Save All Changes</button> <button class="btn btn-secondary" onclick="closeTemplateManager()">Close</button></div></div><div class="template-manager-body"><div class="template-list-panel"><h3>Templates</h3><div class="template-list" id="templateList"></div><div class="template-list-actions"><button class="btn btn-primary" onclick="addNewTemplate()">Add Template</button> <button class="btn btn-secondary" onclick="resetToDefaults()">Reset All</button></div></div><div class="template-editor-panel"><div class="template-editor-header"><h3 id="templateEditorTitle">Select a template to edit</h3><div class="template-editor-actions" id="templateEditorActions" style="display:none"><button class="btn btn-success" onclick="saveCurrentTemplate()">Save</button> <button class="btn btn-danger" onclick="deleteCurrentTemplate()">Delete</button> <button class="btn btn-secondary" onclick="duplicateCurrentTemplate()">Duplicate</button></div></div><div class="template-editor-tabs" id="templateEditorTabs" style="display:none"><button class="template-tab active" id="tabEditor" onclick="switchTemplateTab('editor')">Editor</button> <button class="template-tab" id="tabPreview" onclick="switchTemplateTab('preview')">Preview</button></div><div class="template-editor-content"><div class="template-editor-form" id="templateEditorForm" style="display:none"><div class="form-group"><label for="templateName">Template Name</label> <input id="templateName" placeholder="e.g., My Custom Template"></div><div class="form-group"><label for="templateDescription">Description</label> <input id="templateDescription" placeholder="Brief description of the template"></div><div class="form-group"><label for="templateType">Output Type</label> <select id="templateType"><option value="html">HTML</option><option value="markdown">Markdown</option><option value="csv">CSV</option><option value="text">Plain Text</option></select></div><div class="form-group"><label for="templateContent">Template Content</label> <textarea id="templateContent" rows="20" placeholder="Enter your template content here..."></textarea></div><div class="checkbox-group"><input type="checkbox" id="templateIsDefault"> <label for="templateIsDefault">Set as default template</label></div></div><div class="template-preview-panel" id="templatePreviewPanel" style="display:none"><div class="template-preview-header"><h4>Preview</h4><div class="template-preview-controls"><div class="preview-format-tabs"><button class="preview-tab active" id="previewTabRendered" onclick="switchPreviewTab('rendered')">Rendered</button> <button class="preview-tab" id="previewTabSource" onclick="switchPreviewTab('source')">Source</button></div><button class="btn btn-secondary btn-small" onclick="refreshTemplatePreview()">Refresh</button></div></div><div class="template-preview-content" id="templatePreviewContent"><p class="template-preview-placeholder">Select a template to see preview</p></div></div></div></div></div></div></div><div id="templateGuideModal" class="modal"><div class="modal-content template-guide-content"><div class="modal-header"><h3>Template Guide</h3><button class="btn-close" onclick="closeTemplateGuide()">&times;</button></div><div class="modal-body"><div class="template-guide-content"><div class="guide-section"><h4>Getting Started</h4><p>Templates use a simple variable substitution syntax with double curly braces to create dynamic reports.</p></div><div class="guide-section"><h4>Basic Syntax</h4><ul><li><code>{{variable}}</code> - Simple variable substitution</li><li><code>{{#each array}}</code> ... <code>{{/each}}</code> - Loop through arrays</li><li><code>{{#if condition}}</code> ... <code>{{/if}}</code> - Conditional content</li></ul></div><div class="guide-section"><h4>Pipe Syntax & Function Chaining</h4><p>Transform data using the pipe (<code>|</code>) syntax to chain multiple functions together:</p><h5>Basic Pipe Syntax</h5><ul><li><code>{{ variable | function }}</code> - Apply a single transformation</li><li><code>{{ variable | function1 | function2 }}</code> - Chain multiple transformations</li><li><code>{{ variable | function('parameter') }}</code> - Pass parameters to functions</li></ul><h5>Available Transformation Functions</h5><ul><li><code>date('format')</code> - Format timestamps as dates<ul><li><code>{{ timestamp | date('yyyy-mm-dd') }}</code>  "2025-08-02"</li><li><code>{{ timestamp | date('mm/dd/yyyy') }}</code>  "08/02/2025"</li><li><code>{{ timestamp | date('dd mmm yyyy') }}</code>  "02 Aug 2025"</li></ul></li><li><code>time</code> - Extract time from timestamps<ul><li><code>{{ timestamp | time }}</code>  "14:30:25"</li></ul></li><li><code>escapeCsv</code> - Escape CSV special characters<ul><li>Wraps text in quotes if it contains commas, quotes, or newlines</li><li><code>{{ "Hello, World" | escapeCsv }}</code>  "\"Hello, World\""</li></ul></li><li><code>stripLinebreaks</code> - Remove line breaks from text<ul><li><code>{{ "Line 1\nLine 2" | stripLinebreaks }}</code>  "Line 1 Line 2"</li></ul></li></ul><h5>CSV Template Example with Chaining</h5><p>Here's how the CSV template uses chaining to create clean, properly escaped output:</p><pre><code>{{#each entry = entries}}{{ entry.timestamp | date('yyyy-mm-dd') }},{{ entry.timestamp | time }},{{ entry.activity | escapeCsv | stripLinebreaks }},{{ entry.description | escapeCsv | stripLinebreaks }}
{{/each}}</code></pre><p><strong>How this works:</strong></p><ul><li><code>entry.timestamp | date('yyyy-mm-dd')</code> - Converts timestamp to YYYY-MM-DD format</li><li><code>entry.timestamp | time</code> - Extracts time portion</li><li><code>entry.activity | escapeCsv | stripLinebreaks</code> - First removes line breaks, then escapes for CSV</li><li><code>entry.description | escapeCsv | stripLinebreaks</code> - Same process for descriptions</li></ul><h5>Order Matters in Chaining!</h5><p>Functions are applied left to right, so order is important:</p><ul><li> <code>{{ text | stripLinebreaks | escapeCsv }}</code> - Remove breaks first, then escape</li><li> <code>{{ text | escapeCsv | stripLinebreaks }}</code> - Escaping first may interfere with break removal</li></ul></div><div class="guide-section"><h4>Available Data</h4><p>The following data is available in your templates:</p><ul><li><code>{{reportTitle}}</code> - The report title</li><li><code>{{startDate}}</code> - Report start date (formatted)</li><li><code>{{endDate}}</code> - Report end date (formatted)</li><li><code>{{totalEntries}}</code> - Total number of activity entries</li><li><code>{{entries}}</code> - Array of all activity entries</li></ul></div><div class="guide-section"><h4>Entry Properties</h4><p>Each entry in the <code>{{#each entries}}</code> loop has:</p><ul><li><code>{{activity}}</code> - The activity name</li><li><code>{{description}}</code> - Activity description</li><li><code>{{timestamp}}</code> - Raw ISO timestamp</li><li><code>{{formattedTime}}</code> - Nicely formatted time (e.g., "2:30 PM")</li><li><code>{{formattedDate}}</code> - Nicely formatted date (e.g., "Jan 15, 2025")</li><li><code>{{isTodo}}</code> - Boolean: true if this is a todo item</li><li><code>{{tags}}</code> - Array of hashtags for this entry</li></ul></div><div class="guide-section"><h4>Common Transformations</h4><p>Transform timestamps and format data:</p><ul><li><strong>Date formats</strong>: Use <code>{{formattedDate}}</code> and <code>{{formattedTime}}</code> for human-readable formats</li><li><strong>Conditional content</strong>: <code>{{#if description}}{{description}}{{/if}}</code> - only show if description exists</li><li><strong>Loop through tags</strong>: <code>{{#each tags}}#{{this}} {{/each}}</code> - display all hashtags</li><li><strong>Todo filtering</strong>: <code>{{#if isTodo}}TODO: {{/if}}</code> - mark todo items</li></ul></div><div class="guide-section"><h4>Markdown Formatting</h4><p>Use Markdown syntax for readable formatting:</p><ul><li><code># {{reportTitle}}</code> - Large heading</li><li><code>## {{activity}}</code> - Medium heading</li><li><code>**{{activity}}**</code> - Bold text</li><li><code>*{{description}}*</code> - Italic text</li><li><code>- {{activity}}</code> - Bullet point</li><li><code>`{{formattedTime}}`</code> - Code formatting</li></ul></div><div class="guide-section"><h4>Example Template</h4><pre><code># {{reportTitle}}
From {{startDate}} to {{endDate}}

Total activities: {{totalEntries}}

{{#each entries}}
## {{formattedTime}} - {{activity}}
{{#if description}}
*{{description}}*
{{/if}}
{{#if tags}}
Tags: {{#each tags}}#{{this}} {{/each}}
{{/if}}
{{#if isTodo}}
**TODO ITEM**
{{/if}}

{{/each}}</code></pre></div><div class="guide-section"><h4>Pro Tips</h4><ul><li><strong>HTML templates</strong>: Use for rich formatting with CSS styles and complex layouts</li><li><strong>Markdown templates</strong>: Perfect for simple, readable documentation</li><li><strong>CSV templates</strong>: Ideal for data analysis in spreadsheets</li><li><strong>Preview feature</strong>: Always test your templates before saving</li><li><strong>Custom formats</strong>: Combine multiple variables for unique layouts</li></ul></div></div></div></div></div><div id="pomodoroActivityModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Work Session Activity</h3><button class="btn-close" onclick="closePomodoroActivityModal()">&times;</button></div><div class="modal-body"><form id="pomodoroActivityForm"><div class="form-group"><label for="pomodoroActivityName">What will you be working on?</label> <input id="pomodoroActivityName" required placeholder="e.g., Writing report, Meeting preparation"><div class="quick-actions" style="margin-top:8px"><button type="button" id="usePreviousActivityBtn" class="btn btn-small btn-outline" onclick="usePreviousActivity()">Use Previous Activity</button></div></div><div class="form-group"><label for="pomodoroActivityDescription">Description (optional)</label> <textarea id="pomodoroActivityDescription" rows="3" placeholder="Additional details about this work session"></textarea></div><div class="modal-actions"><button type="submit" class="btn btn-primary">Start Work Session</button> <button type="button" class="btn btn-secondary" onclick="closePomodoroActivityModal()">Cancel</button></div></form></div></div></div><div id="pomodoroAbandonModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 id="pomodoroAbandonTitle">Session Abandonment</h3><button class="btn-close" onclick="closePomodoroAbandonDialog()">&times;</button></div><div class="modal-body"><div class="abandon-info"><p id="pomodoroAbandonTimeSpent">You worked for X minutes</p><p>Would you like to save what you accomplished during this partial session?</p></div><form id="pomodoroAbandonForm"><div class="form-group"><label for="pomodoroAbandonActivityName">Activity accomplished</label> <input id="pomodoroAbandonActivityName" placeholder="What did you work on during this time?"></div><div class="form-group"><label for="pomodoroAbandonActivityDescription">Description (optional)</label> <textarea id="pomodoroAbandonActivityDescription" rows="2" placeholder="Additional details about what you accomplished"></textarea></div><div class="modal-actions"><button type="button" class="btn btn-primary" onclick="handlePomodoroAbandonmentSave(true)">Save Work & Abandon</button> <button type="button" class="btn btn-secondary" onclick="handlePomodoroAbandonmentSave(false)">Just Abandon</button></div></form></div></div></div><div id="confirmationModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 id="confirmationTitle">Confirm Action</h3><button class="btn-close" onclick="closeConfirmationDialog()">&times;</button></div><div class="modal-body"><div class="confirmation-content"><p id="confirmationMessage">Are you sure you want to perform this action?</p></div><div class="confirmation-options" id="confirmationSkipSection" style="display:none"><div class="checkbox-group"><input type="checkbox" id="confirmationSkipFuture"> <label for="confirmationSkipFuture">Don't ask again for this type of action</label></div></div><div class="modal-actions"><button type="button" id="confirmationConfirmBtn" class="btn btn-danger">Confirm</button> <button type="button" class="btn btn-secondary" onclick="closeConfirmationDialog()">Cancel</button></div></div></div></div><div id="activityHoursInfoModal" class="modal"><div class="modal-content"><div class="modal-header"><h3> Activity Hours Information</h3><button class="btn-close" onclick="closeActivityHoursInfo()">&times;</button></div><div class="modal-body"><div class="activity-hours-info"><p><strong>Reminder alerts are switched off outside of activity hours.</strong></p><p>To receive activity reminders, please update your activity schedule in the settings section. You can customize:</p><ul><li>Activity days (Monday through Sunday)</li><li>Start and end times for each day</li><li>Different schedules for different days</li></ul><p>When you're outside your configured activity hours, reminders are automatically paused to avoid disrupting your personal time.</p></div><div class="modal-actions"><button type="button" class="btn btn-primary" onclick="goToActivityHoursSettings()"> Configure Activity Hours</button> <button type="button" class="btn btn-secondary" onclick="closeActivityHoursInfo()">Got It</button></div></div></div></div><div id="overdueAlertModal" class="modal"><div class="modal-content"><div class="modal-header"><h3> Overdue Items</h3><button class="btn-close" onclick="closeOverdueAlert()">&times;</button></div><div class="modal-body"><div class="overdue-info"><p>The following items are past their due date:</p></div><div class="overdue-items-list" id="overdueItemsList"></div><div class="modal-actions"><button type="button" class="btn btn-secondary" onclick="closeOverdueAlert()">Got It</button></div></div></div></div><div id="hashtagBrowserModal" class="modal"><div class="modal-content hashtag-browser-content"><div class="modal-header"><h3>Hashtag Browser</h3><button class="btn-close" onclick="closeHashtagBrowser()">&times;</button></div><div class="modal-body"><div class="hashtag-stats" id="hashtagStats"><span id="hashtagCount">0 hashtags found</span></div><div class="hashtag-cloud" id="hashtagCloud"><p class="empty-state">No hashtags found. Add activities with #hashtags to see them here!</p></div></div></div></div><div id="userGuideModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>User Guide</h3><button class="btn-close" onclick="closeUserGuide()">&times;</button></div><div class="modal-body"><div class="user-guide-content"><div class="guide-section"><h4>Getting Started</h4><p>Activity Tracker is a personal activity tracking application with smart notifications, comprehensive reporting, and Pomodoro timer functionality.</p><p><strong>Key Features:</strong></p><ul><li>Pomodoro Timer with configurable work/break cycles</li><li>Smart notification system with customizable sounds</li><li>Comprehensive activity reporting with custom templates</li><li>Dark mode support</li><li>Offline functionality with service worker</li><li>Progressive Web App (PWA) support</li></ul></div><div class="guide-section"><h4>Keyboard Shortcuts</h4><ul><li><kbd>Shift</kbd> + <kbd>Space</kbd> - Focus activity input field</li><li><kbd>Shift</kbd> + <kbd>Enter</kbd> - Submit activity form</li><li><kbd>Ctrl</kbd> + <kbd>T</kbd> - Toggle todo/not todo status</li><li><kbd>Ctrl</kbd> + <kbd>N</kbd> - Toggle note status</li><li><kbd>Esc</kbd> - Close modals</li></ul></div><div class="guide-section"><h4>Adding Activities</h4><ul><li>Enter what you're doing in the activity field</li><li>Add #hashtags for easy categorization</li><li>Use the "Mark as Todo" button for tasks that need completion</li><li>Use the "Mark as Note" button for reference items (excluded from reports)</li><li>Set due dates for todos using quick-set buttons</li></ul></div><div class="guide-section"><h4>Search & Navigation</h4><ul><li>Use the global search to find activities, todos, and hashtags</li><li>Click the  button to browse hashtags in a visual cloud</li><li>Click any hashtag to search for related items</li><li>Use pagination controls to navigate through large lists</li></ul></div><div class="guide-section"><h4>Managing Todos</h4><ul><li>View all todos in the dedicated "To Do" section</li><li>Filter by status, due date, or category</li><li>Click "Mark Complete" to finish todos</li><li>Overdue items are highlighted in red</li></ul></div><div class="guide-section"><h4>Reports</h4><ul><li>Generate weekly, custom date range, or template-based reports</li><li>Export reports in HTML, Markdown, or CSV formats</li><li>Create custom report templates with variables</li><li>Include/exclude completed todos from reports</li></ul></div><div class="guide-section"><h4>Pomodoro Mode (Optional)</h4><ul><li>Enable Pomodoro technique with customizable work/break intervals</li><li>Automatic activity logging during Pomodoro sessions</li><li>Audio notifications for work/break transitions</li><li>Focus timer to help maintain productivity</li></ul></div><div class="guide-section"><h4>Settings & Customization</h4><ul><li>Customize notification intervals and activity hours</li><li>Choose from multiple notification sounds</li><li>Switch between light/dark themes</li><li>Set pagination size for better navigation</li><li>All settings auto-save as you change them</li></ul></div><div class="guide-section"><h4>Data Management</h4><ul><li>Export your data as JSON backup</li><li>Import previously exported data</li><li>Data is stored locally in your browser</li><li>Works offline after initial load</li></ul></div></div></div></div></div><div id="notificationPermissionModal" class="modal"><div class="modal-content notification-permission-content"><div class="modal-header"><h3>Enable System Notifications?</h3></div><div class="modal-body"><div class="notification-permission-info"><p><strong>Activity Tracker</strong> can send reminder notifications directly to your operating system.</p><p>This allows you to receive activity reminders even when the app is minimized or you're using other applications.</p><div class="permission-options"><div class="permission-option permission-clickable" onclick="requestNotificationPermission()"><h4> Enable System Notifications</h4><p>Get reminder alerts through your operating system's notification center, plus sound alerts in the app.</p></div><div class="permission-option permission-clickable" onclick="declineNotificationPermission()"><h4> Sound Only</h4><p>Use only sound alerts within the app (no system notifications).</p></div></div><p class="permission-note"><em>You can change this setting later in the General Settings section.</em></p></div><div class="modal-actions"><button type="button" class="btn btn-primary" onclick="requestNotificationPermission()">Enable System Notifications</button> <button type="button" class="btn btn-secondary" onclick="declineNotificationPermission()">Sound Only</button></div></div></div></div><div id="aboutModal" class="modal"><div class="modal-content about-modal-content"><div class="modal-header"><h3>About Activity Tracker</h3><button class="btn-close" onclick="closeAbout()">&times;</button></div><div class="modal-body"><div class="about-section"><h4>Application Info</h4><div class="debug-info" id="aboutDebugInfo">Loading...</div><div style="margin-top:15px"><button class="btn btn-primary" onclick="checkForUpdatesManually()" style="margin-right:8px">Check for Updates</button> <small style="color:#666">Automatic checks run every 12 hours</small></div></div><div class="about-section"><h4>Version History</h4><div id="versionHistoryContainer">Loading version history...</div></div><div class="about-section copyright-section"><div class="copyright-card"><div class="copyright-header"><h4>Activity Tracker</h4><div class="copyright-badge">&copy; <span id="copyrightYear">2025</span></div></div><div class="copyright-author"><p>&copy; <span id="copyrightYearRange">2025</span> <a href="https://github.com/seesee" target="_blank" rel="noopener noreferrer" class="author-link">Chris Carline</a></p></div><div class="copyright-description"><p>Personal activity tracking application built as a Progressive Web App. All data is stored locally on your device and remains completely private. No cookies, analytics, or tracking technologies used.</p></div><div class="copyright-actions"><a href="https://github.com/seesee/activity-tracker" target="_blank" rel="noopener noreferrer" class="github-button"><span class="github-icon"></span> <span>View on GitHub</span></a></div></div></div></div></div></div><div id="swDiagnosticsModal" class="modal"><div class="modal-content diagnostics-modal-content"><div class="modal-header"><h3> Service Worker Diagnostics</h3><button class="btn-close" onclick="closeDiagnosticsModal()">&times;</button></div><div class="modal-body"><div class="diagnostics-container"><div class="diagnostics-loading" id="diagnosticsLoading"><div class="loading-spinner"></div><p>Gathering diagnostics data...</p></div><div class="diagnostics-content" id="diagnosticsContent" style="display:none"></div></div></div><div class="modal-footer"><button class="btn btn-primary" onclick="refreshDiagnostics()"> Refresh</button> <button class="btn btn-secondary" onclick="copyDiagnosticsToClipboard()"> Copy to Clipboard</button> <button class="btn btn-secondary" onclick="closeDiagnosticsModal()">Close</button></div></div></div><div id="workspaceManagerModal" class="modal"><div class="modal-content workspace-manager-content"><div class="modal-header"><h3> Workspace Manager</h3><button class="btn-close" onclick="closeWorkspaceManager()">&times;</button></div><div class="modal-body"><div class="workspace-info"><div class="current-workspace"><h4>Current Workspace: <span id="currentWorkspaceName">Default</span></h4><p class="workspace-description">Each workspace maintains separate activities, settings, and state. Switch between workspaces to organize different projects or contexts.</p></div></div><div class="workspace-list-section"><h4>Available Workspaces</h4><div class="workspace-list" id="workspaceList"></div></div><div class="workspace-actions"><div class="create-workspace"><input id="newWorkspaceName" placeholder="Enter workspace name..." maxlength="50"> <button class="btn btn-primary" onclick="createNewWorkspace()">Create Workspace</button></div></div><div class="modal-actions"><button type="button" class="btn btn-secondary" onclick="closeWorkspaceManager()">Close</button></div></div></div></div><script>const APP_VERSION="2025.08.12.50";function formatDateTime(t){return new Date(t).toLocaleString("en-GB",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function formatDate(t){return t.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function formatTime(t){return new Date(t).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}function escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}const ToastManager={notifications:[],container:null,init(){if(!this.container&&(this.container=document.createElement("div"),this.container.id="toast-container",this.container.style.cssText="\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                z-index: 10000;\n                pointer-events: none;\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                max-width: 400px;\n            ",document.body.appendChild(this.container),!document.getElementById("toast-styles"))){const t=document.createElement("style");t.id="toast-styles",t.textContent="\n                    @keyframes slideDownIn {\n                        from {\n                            transform: translateY(-100%);\n                            opacity: 0;\n                        }\n                        to {\n                            transform: translateY(0);\n                            opacity: 1;\n                        }\n                    }\n                    @keyframes slideRightOut {\n                        from {\n                            transform: translateX(0);\n                            opacity: 1;\n                        }\n                        to {\n                            transform: translateX(120%);\n                            opacity: 0;\n                        }\n                    }\n                    @keyframes pushDown {\n                        from {\n                            transform: translateY(0);\n                        }\n                        to {\n                            transform: translateY(10px);\n                        }\n                    }\n                ",document.head.appendChild(t)}},show(t,e="info",n=3e3){this.init();const i=document.createElement("div");return i.className="toast-notification",i.style.cssText=`\n            padding: 15px 20px;\n            border-radius: 8px;\n            color: white;\n            font-weight: 600;\n            background: ${"success"===e?"#48bb78":"error"===e?"#f56565":"#667eea"};\n            box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n            animation: slideDownIn 0.3s ease-out;\n            pointer-events: auto;\n            max-width: 100%;\n            word-wrap: break-word;\n        `,i.innerHTML=t,this.container.appendChild(i),this.notifications.push(i),this.notifications.slice(0,-1).forEach(t=>{t.parentNode&&(t.style.animation="pushDown 0.2s ease-out")}),setTimeout(()=>{this.remove(i)},n),i},remove(t){if(!t||!t.parentNode)return;const e=this.notifications.indexOf(t);e>-1&&this.notifications.splice(e,1),t.style.animation="none",t.offsetHeight,t.style.animation="slideRightOut 0.3s ease-in forwards",setTimeout(()=>{t.parentNode&&t.remove()},300)}};function showNotification(t,e="info",n=3e3){return ToastManager.show(t,e,n)}function downloadFile(t,e,n){const i=new Blob([t],{type:n}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}function getCurrentTimeForInput(){const t=new Date;return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}function escapeCsv(t){return t?t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t:""}function generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}function isValidDate(t){const e=new Date(t);return e instanceof Date&&!isNaN(e)}function getWeekStart(t){const e=new Date(t),n=t.getDay(),i=0===n?-6:1-n;return e.setDate(t.getDate()+i),e.setHours(0,0,0,0),e}function getWeekEnd(t){const e=new Date(getWeekStart(t));return e.setDate(e.getDate()+6),e.setHours(23,59,59,999),e}function deepClone(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>deepClone(t));if("object"==typeof t){const e={};return Object.keys(t).forEach(n=>{e[n]=deepClone(t[n])}),e}}class SoundManager{constructor(){this.audioContext=null,this.soundTypes={classic:"Classic Bloop",gentle:"Gentle Chime",urgent:"Urgent Ping",digital:"Digital Beep",nature:"Nature Drop",mechanical:"Mechanical Click",spacey:"Spacey Wobble",corporate:"Corporate Ding",retro:"Retro Arcade",piano:"Piano Note",bell:"Temple Bell",whistle:"Train Whistle",bubble:"Bubble Pop",glass:"Glass Tap",wood:"Wood Block",metal:"Metal Ting",ethereal:"Ethereal Hum",cosmic:"Cosmic Blip",ocean:"Ocean Wave",forest:"Forest Chirp",failsafe:"Failsafe","soft-tick":"Soft Tick","classic-tick":"Classic Tick","digital-tick":"Digital Tick"},this.initAudioContext()}initAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),/iPhone|iPad|iPod/i.test(navigator.userAgent)&&this.unlockAudioContextForIOS()}catch(t){console.warn("Web Audio API not supported:",t),this.audioContext=null}}unlockAudioContextForIOS(){if(!this.audioContext||"suspended"!==this.audioContext.state)return;const t=()=>{if("suspended"===this.audioContext.state){const t=this.audioContext.createBuffer(1,1,22050),e=this.audioContext.createBufferSource();e.buffer=t,e.connect(this.audioContext.destination),e.start(0),this.audioContext.resume().then(()=>{}).catch(t=>{console.warn("Failed to unlock iOS AudioContext:",t)})}},e=["touchstart","touchend","mousedown","keydown"],n=()=>{t(),e.forEach(t=>document.removeEventListener(t,n,!0))};e.forEach(t=>document.addEventListener(t,n,!0))}getSoundTypes(){return this.soundTypes}playSound(t="classic",e=!1){if(this.audioContext&&!e)try{if("suspended"===this.audioContext.state){const e=this.audioContext.resume();if(e&&e.then)return void e.then(()=>{this.playSoundInternal(t)}).catch(e=>{console.warn("Failed to resume AudioContext:",e),/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(this.initAudioContext(),this.audioContext&&"suspended"!==this.audioContext.state&&this.playSoundInternal(t))});this.audioContext.resume()}this.playSoundInternal(t)}catch(t){console.warn("Error playing notification sound:",t)}}playSoundInternal(t){try{const e=this.audioContext.currentTime;switch(t){case"classic":default:this.playClassicBloop(e);break;case"gentle":this.playGentleChime(e);break;case"urgent":this.playUrgentPing(e);break;case"digital":this.playDigitalBeep(e);break;case"nature":this.playNatureDrop(e);break;case"mechanical":this.playMechanicalClick(e);break;case"spacey":this.playSpaceyWobble(e);break;case"corporate":this.playCorporateDing(e);break;case"retro":this.playRetroArcade(e);break;case"piano":this.playPianoNote(e);break;case"bell":this.playTempleBell(e);break;case"whistle":this.playTrainWhistle(e);break;case"bubble":this.playBubblePop(e);break;case"glass":this.playGlassTap(e);break;case"wood":this.playWoodBlock(e);break;case"metal":this.playMetalTing(e);break;case"ethereal":this.playEtherealHum(e);break;case"cosmic":this.playCosmicBlip(e);break;case"ocean":this.playOceanWave(e);break;case"forest":this.playForestChirp(e);break;case"failsafe":this.playFailsafe(e);break;case"soft-tick":this.playSoftTick(e);break;case"classic-tick":this.playClassicTick(e);break;case"digital-tick":this.playDigitalTick(e)}}catch(t){console.warn("Error in playSoundInternal:",t)}}playClassicBloop(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(400,t),e.frequency.exponentialRampToValueAtTime(600,t+.1),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.05),n.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playGentleChime(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",n.type="sine",e.frequency.setValueAtTime(523.25,t),n.frequency.setValueAtTime(659.25,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.2,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+1),e.start(t),n.start(t),e.stop(t+1),n.stop(t+1)}playUrgentPing(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="triangle",e.frequency.setValueAtTime(800,t),e.frequency.exponentialRampToValueAtTime(1200,t+.05),e.frequency.exponentialRampToValueAtTime(800,t+.1),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.4,t+.02),n.gain.exponentialRampToValueAtTime(.01,t+.15),e.start(t),e.stop(t+.15)}playDigitalBeep(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="square",e.frequency.setValueAtTime(1e3,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.01),n.gain.linearRampToValueAtTime(.3,t+.05),n.gain.linearRampToValueAtTime(0,t+.06),e.start(t),e.stop(t+.06)}playNatureDrop(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(1200,t),e.frequency.exponentialRampToValueAtTime(200,t+.8),i.type="lowpass",i.frequency.setValueAtTime(2e3,t),i.frequency.exponentialRampToValueAtTime(300,t+.8),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.25,t+.05),n.gain.exponentialRampToValueAtTime(.01,t+.8),e.start(t),e.stop(t+.8)}playMechanicalClick(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(150,t),i.type="highpass",i.frequency.setValueAtTime(100,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.5,t+.005),n.gain.linearRampToValueAtTime(0,t+.05),e.start(t),e.stop(t+.05)}playSpaceyWobble(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain(),o=this.audioContext.createGain();n.connect(i),i.connect(e.frequency),e.connect(o),o.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(300,t),n.type="sine",n.frequency.setValueAtTime(6,t),i.gain.setValueAtTime(50,t),o.gain.setValueAtTime(0,t),o.gain.linearRampToValueAtTime(.3,t+.1),o.gain.exponentialRampToValueAtTime(.01,t+1.2),n.start(t),e.start(t),n.stop(t+1.2),e.stop(t+1.2)}playCorporateDing(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",n.type="sine",e.frequency.setValueAtTime(880,t),n.frequency.setValueAtTime(1108.73,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.25,t+.02),i.gain.exponentialRampToValueAtTime(.01,t+.5),e.start(t),n.start(t),e.stop(t+.5),n.stop(t+.5)}playRetroArcade(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="square",e.frequency.setValueAtTime(220,t),e.frequency.setValueAtTime(330,t+.1),e.frequency.setValueAtTime(440,t+.2),e.frequency.setValueAtTime(550,t+.3),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.02),n.gain.exponentialRampToValueAtTime(.01,t+.4),e.start(t),e.stop(t+.4)}playPianoNote(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",n.type="triangle",e.frequency.setValueAtTime(523.25,t),n.frequency.setValueAtTime(523.25,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.4,t+.01),i.gain.exponentialRampToValueAtTime(.01,t+1.5),e.start(t),n.start(t),e.stop(t+1.5),n.stop(t+1.5)}playTempleBell(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(800,t),e.frequency.exponentialRampToValueAtTime(400,t+2),i.type="lowpass",i.frequency.setValueAtTime(1200,t),i.Q.setValueAtTime(5,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.05),n.gain.exponentialRampToValueAtTime(.01,t+2),e.start(t),e.stop(t+2)}playTrainWhistle(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(880,t),e.frequency.setValueAtTime(660,t+.5),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.4,t+.1),n.gain.linearRampToValueAtTime(.4,t+.4),n.gain.exponentialRampToValueAtTime(.01,t+.8),e.start(t),e.stop(t+.8)}playBubblePop(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(800,t),e.frequency.exponentialRampToValueAtTime(400,t+.1),i.type="bandpass",i.frequency.setValueAtTime(600,t),i.Q.setValueAtTime(3,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.01),n.gain.exponentialRampToValueAtTime(.01,t+.1),e.start(t),e.stop(t+.1)}playGlassTap(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="triangle",e.frequency.setValueAtTime(2e3,t),i.type="highpass",i.frequency.setValueAtTime(1e3,t),i.Q.setValueAtTime(2,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.5,t+.005),n.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playWoodBlock(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(400,t),i.type="bandpass",i.frequency.setValueAtTime(800,t),i.Q.setValueAtTime(5,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.6,t+.01),n.gain.exponentialRampToValueAtTime(.01,t+.08),e.start(t),e.stop(t+.08)}playMetalTing(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="triangle",e.frequency.setValueAtTime(1500,t),i.type="highpass",i.frequency.setValueAtTime(800,t),i.Q.setValueAtTime(3,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.4,t+.01),n.gain.exponentialRampToValueAtTime(.01,t+.6),e.start(t),e.stop(t+.6)}playEtherealHum(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),o=this.audioContext.createGain(),s=this.audioContext.createGain(),a=this.audioContext.createBiquadFilter();i.connect(o),o.connect(e.frequency),e.connect(a),n.connect(a),a.connect(s),s.connect(this.audioContext.destination),e.type="sine",n.type="sine",e.frequency.setValueAtTime(220,t),n.frequency.setValueAtTime(330,t),i.type="sine",i.frequency.setValueAtTime(.5,t),o.gain.setValueAtTime(10,t),a.type="lowpass",a.frequency.setValueAtTime(800,t),a.Q.setValueAtTime(1,t),s.gain.setValueAtTime(0,t),s.gain.linearRampToValueAtTime(.2,t+.3),s.gain.exponentialRampToValueAtTime(.01,t+2),i.start(t),e.start(t),n.start(t),i.stop(t+2),e.stop(t+2),n.stop(t+2)}playCosmicBlip(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain(),o=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();n.connect(i),i.connect(e.frequency),e.connect(s),s.connect(o),o.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(600,t),n.type="sine",n.frequency.setValueAtTime(20,t),i.gain.setValueAtTime(200,t),s.type="bandpass",s.frequency.setValueAtTime(800,t),s.Q.setValueAtTime(2,t),o.gain.setValueAtTime(0,t),o.gain.linearRampToValueAtTime(.3,t+.05),o.gain.exponentialRampToValueAtTime(.01,t+.4),n.start(t),e.start(t),n.stop(t+.4),e.stop(t+.4)}playOceanWave(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(80,t),e.frequency.exponentialRampToValueAtTime(40,t+1.5),i.type="lowpass",i.frequency.setValueAtTime(200,t),i.frequency.exponentialRampToValueAtTime(80,t+1.5),i.Q.setValueAtTime(2,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.2),n.gain.linearRampToValueAtTime(.2,t+1),n.gain.exponentialRampToValueAtTime(.01,t+1.5),e.start(t),e.stop(t+1.5)}playForestChirp(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(1200,t),e.frequency.exponentialRampToValueAtTime(1800,t+.1),e.frequency.exponentialRampToValueAtTime(1e3,t+.3),i.type="bandpass",i.frequency.setValueAtTime(1400,t),i.Q.setValueAtTime(3,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.25,t+.05),n.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playFailsafe(t){const e=[],n=[],i=[],o=130.81;[o,163.5125,196.215,261.62,327.025,392.43,523.24,659.2824].forEach((o,s)=>{const a=this.audioContext.createOscillator(),r=this.audioContext.createGain(),c=this.audioContext.createBiquadFilter();e.push(a),n.push(r),i.push(c),a.connect(c),c.connect(r),r.connect(this.audioContext.destination),a.type=s%2==0?"sine":"triangle",a.frequency.setValueAtTime(o,t),a.frequency.exponentialRampToValueAtTime(1.618*o,t+.8),a.frequency.exponentialRampToValueAtTime(2*o,t+1.6),a.frequency.exponentialRampToValueAtTime(.5*o,t+2.4),c.type="bandpass",c.frequency.setValueAtTime(2*o,t),c.frequency.exponentialRampToValueAtTime(8*o,t+1.2),c.Q.setValueAtTime(3+.5*s,t);const d=.1*s,l=.08/(s+1);r.gain.setValueAtTime(0,t+d),r.gain.linearRampToValueAtTime(l,t+d+.2),r.gain.exponentialRampToValueAtTime(.7*l,t+d+1),r.gain.linearRampToValueAtTime(.3*l,t+d+2),r.gain.exponentialRampToValueAtTime(.001,t+d+3),a.start(t+d),a.stop(t+d+3)}),[32.7025,65.405,98.1075].forEach((e,n)=>{const i=this.audioContext.createOscillator(),o=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();i.connect(s),s.connect(o),o.connect(this.audioContext.destination),i.type=["sawtooth","square","triangle"][n],i.frequency.setValueAtTime(e,t),i.frequency.exponentialRampToValueAtTime(1.05*e,t+1),i.frequency.exponentialRampToValueAtTime(.95*e,t+1.5),i.frequency.linearRampToValueAtTime(.8*e,t+2),i.frequency.linearRampToValueAtTime(.6*e,t+2.8),i.frequency.linearRampToValueAtTime(.4*e,t+3.2),s.type="lowpass",s.frequency.setValueAtTime(200+100*n,t),s.frequency.exponentialRampToValueAtTime(300+150*n,t+.5),s.frequency.exponentialRampToValueAtTime(150+75*n,t+2.5),s.Q.setValueAtTime(2,t);const a=.05*n,r=0===n?.15:.08;o.gain.setValueAtTime(0,t+a),o.gain.linearRampToValueAtTime(r,t+a+.1),o.gain.exponentialRampToValueAtTime(.8*r,t+a+.8),o.gain.linearRampToValueAtTime(.4*r,t+a+2.2),o.gain.exponentialRampToValueAtTime(.001,t+a+3.2),i.start(t+a),i.stop(t+a+3.2)});const s=this.audioContext.createOscillator(),a=this.audioContext.createGain(),r=this.audioContext.createBiquadFilter();s.connect(r),r.connect(a),a.connect(this.audioContext.destination),s.type="sine",s.frequency.setValueAtTime(32.7025,t),s.frequency.exponentialRampToValueAtTime(o/3,t+1.5),s.frequency.linearRampToValueAtTime(32.7025,t+2),s.frequency.linearRampToValueAtTime(16.35125,t+2.5),s.frequency.linearRampToValueAtTime(o/12,t+3.2),s.frequency.linearRampToValueAtTime(8.175625,t+3.5),r.type="lowpass",r.frequency.setValueAtTime(60,t),r.frequency.exponentialRampToValueAtTime(80,t+1),r.frequency.exponentialRampToValueAtTime(40,t+2.5),r.Q.setValueAtTime(1.5,t),a.gain.setValueAtTime(0,t),a.gain.linearRampToValueAtTime(.18,t+.3),a.gain.exponentialRampToValueAtTime(.12,t+1.5),a.gain.linearRampToValueAtTime(.1,t+2),a.gain.linearRampToValueAtTime(.15,t+2.5),a.gain.exponentialRampToValueAtTime(.001,t+3.5),s.start(t),s.stop(t+3.5);for(let e=0;e<5;e++){const n=this.audioContext.createOscillator(),i=this.audioContext.createGain(),o=this.audioContext.createBiquadFilter();n.connect(o),o.connect(i),i.connect(this.audioContext.destination);const s=800+1200*Math.random();n.type="sine",n.frequency.setValueAtTime(s,t),n.frequency.exponentialRampToValueAtTime(2*s,t+.3),o.type="highpass",o.frequency.setValueAtTime(1500,t),o.Q.setValueAtTime(10,t);const a=.4*e;i.gain.setValueAtTime(0,t+a),i.gain.linearRampToValueAtTime(.03,t+a+.05),i.gain.exponentialRampToValueAtTime(.001,t+a+.3),n.start(t+a),n.stop(t+a+.3)}const c=this.audioContext.createDelay(.3),d=this.audioContext.createGain(),l=this.audioContext.createBiquadFilter();c.delayTime.setValueAtTime(.15,t),d.gain.setValueAtTime(.2,t),l.type="lowpass",l.frequency.setValueAtTime(8e3,t),c.connect(l),l.connect(d),d.connect(c),d.connect(this.audioContext.destination),n.length>0&&(n[0].connect(c),n.length>2&&n[2].connect(c)),a.connect(c)}playSoftTick(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.type="triangle",e.frequency.setValueAtTime(1800,t),e.frequency.exponentialRampToValueAtTime(900,t+.005),i.type="bandpass",i.frequency.setValueAtTime(1200,t),i.Q.setValueAtTime(4,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.035,t+5e-4),n.gain.exponentialRampToValueAtTime(.001,t+.02),e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.start(t),e.stop(t+.02)}playClassicTick(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.type="triangle",e.frequency.setValueAtTime(2e3,t),e.frequency.exponentialRampToValueAtTime(1e3,t+.005),i.type="bandpass",i.frequency.setValueAtTime(1350,t),i.Q.setValueAtTime(5,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.045,t+5e-4),n.gain.exponentialRampToValueAtTime(.001,t+.02),e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.start(t),e.stop(t+.02)}playDigitalTick(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.type="triangle",e.frequency.setValueAtTime(2200,t),e.frequency.exponentialRampToValueAtTime(1100,t+.005),i.type="bandpass",i.frequency.setValueAtTime(1500,t),i.Q.setValueAtTime(6,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.05,t+5e-4),n.gain.exponentialRampToValueAtTime(.001,t+.02),e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.start(t),e.stop(t+.02)}testSound(t,e=!1){this.playSound(t,e)}}"undefined"!=typeof window&&(window.SoundManager=SoundManager);class PauseManager{constructor(t){this.tracker=t,this.countdownInterval=null,this.pauseButton=null,this.originalButtonText="Pause Reminders",this.init()}init(){this.pauseButton=document.getElementById("pauseButton"),this.pauseButton&&(this.updatePauseButtonDisplay(),this.setupPauseButtonHandlers())}setupPauseButtonHandlers(){let t;this.pauseButton.addEventListener("contextmenu",t=>{t.preventDefault(),this.showPauseMenu(t)}),this.pauseButton.addEventListener("touchstart",e=>{t=setTimeout(()=>{e.preventDefault(),this.showPauseMenu(e)},500)}),this.pauseButton.addEventListener("touchend",()=>{clearTimeout(t)})}showPauseMenu(t){if(this.isPaused())return void this.resume();const e=document.createElement("div");e.className="pause-context-menu",e.style.cssText="\n            position: fixed;\n            z-index: 10000;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n            padding: 8px 0;\n            min-width: 150px;\n            font-size: 14px;\n        ",[{label:"5 minutes",duration:5},{label:"15 minutes",duration:15},{label:"30 minutes",duration:30},{label:"1 hour",duration:60},{label:"2 hours",duration:120},{label:"Until manually resumed",duration:-1}].forEach(t=>{const n=document.createElement("div");n.className="pause-context-menu-item",n.textContent=t.label,n.addEventListener("click",()=>{this.startPause(t.duration),e.remove()}),e.appendChild(n)});const n=this.pauseButton.getBoundingClientRect();e.style.left=`${n.left}px`,e.style.top=`${n.bottom+5}px`,document.body.appendChild(e);const i=t=>{e.contains(t.target)||(e.remove(),document.removeEventListener("click",i))};setTimeout(()=>{document.addEventListener("click",i)},0)}startPause(t){this.stopCountdown(),-1===t?(this.tracker.settings.notificationsPausedUntil=1/0,this.updatePauseButtonForever(),showNotification("Reminders paused indefinitely","info")):(this.tracker.settings.notificationsPausedUntil=(new Date).getTime()+60*t*1e3,this.startCountdown(),showNotification(`Reminders paused for ${t} ${1===t?"minute":"minutes"}`,"info")),this.tracker.saveSettings()}resume(){this.stopCountdown(),this.tracker.settings.notificationsPausedUntil=null,this.updatePauseButtonNormal(),this.tracker.saveSettings(),showNotification("Reminders resumed","success")}startCountdown(){this.countdownInterval&&clearInterval(this.countdownInterval),this.updateCountdownDisplay(),this.countdownInterval=setInterval(()=>{this.updateCountdownDisplay()},1e3)}stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}updateCountdownDisplay(){if(!this.pauseButton||!this.tracker.settings.notificationsPausedUntil)return void this.updatePauseButtonNormal();const t=(new Date).getTime(),e=this.tracker.settings.notificationsPausedUntil;if(e===1/0)return void this.updatePauseButtonForever();const n=e-t;if(n<=0)return this.resume(),void showNotification("Notifications automatically resumed","success");const i=Math.floor(n/1e3),o=Math.floor(i/3600),s=Math.floor(i%3600/60),a=i%60;let r;r=o>0?`${o}h ${s}m ${a}s`:s>0?`${s}m ${a}s`:`${a}s`,this.pauseButton.textContent=`Resume (${r})`,this.pauseButton.title="Click to resume reminders now. Right-click for pause duration options.";const c=60*this.tracker.settings.pauseDuration*1e3,d=c-n,l=Math.max(0,Math.min(100,d/c*100));this.applyDrainingEffect(l)}applyDrainingEffect(t){const e="rgba(229, 62, 62, 0.3)",n="#e53e3e";this.pauseButton.style.background=`linear-gradient(to left, ${e} 0%, ${e} ${t}%, ${n} ${t}%, ${n} 100%)`,this.pauseButton.style.transition="background 1s ease-out",this.pauseButton.style.animation=t>90?"pulse 1s infinite":"none"}updatePauseButtonForever(){this.pauseButton.textContent="Resume (Paused Forever)",this.pauseButton.title="Click to resume reminders. Right-click for pause duration options.",this.pauseButton.style.background="#e53e3e",this.pauseButton.style.animation="none",this.pauseButton.style.transition=""}isWithinWorkingSchedule(){const t=new Date,e=(t.getHours(),t.getMinutes(),["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()]);return!!this.tracker.settings.workingDays[e]&&this.tracker.isWithinWorkingHours(t)}updatePauseButtonNormal(){const t=this.isWithinWorkingSchedule();this.tracker.settings.notificationsEnabled?t?(this.pauseButton.textContent="Pause Reminders",this.pauseButton.title="Click to pause reminders. Right-click for pause duration options.",this.pauseButton.disabled=!1,this.pauseButton.style.background="",this.pauseButton.style.opacity="",this.pauseButton.style.cursor=""):(this.pauseButton.textContent="Outside activity hours",this.pauseButton.title="Click to learn about activity hours settings. Reminders are only available during your configured activity schedule.",this.pauseButton.disabled=!1,this.pauseButton.style.background="#9ca3af",this.pauseButton.style.opacity="0.6",this.pauseButton.style.cursor="not-allowed"):(this.pauseButton.textContent="All reminders disabled",this.pauseButton.title='Activity reminders are turned off. Click "Turn on activity reminders" in the notification status to enable.',this.pauseButton.disabled=!1,this.pauseButton.style.background="#9ca3af",this.pauseButton.style.opacity="0.6",this.pauseButton.style.cursor="not-allowed"),this.pauseButton.style.animation="none",this.pauseButton.style.transition=""}updatePauseButtonDisplay(){this.pauseButton&&(this.tracker.pomodoroManager&&this.tracker.pomodoroManager.isActive?this.pauseButton.style.display="none":(this.pauseButton.style.display="",this.tracker.settings.notificationsPausedUntil?this.tracker.settings.notificationsPausedUntil===1/0?this.updatePauseButtonForever():this.startCountdown():this.updatePauseButtonNormal()))}isPaused(){return!!this.tracker.settings.notificationsPausedUntil&&(this.tracker.settings.notificationsPausedUntil===1/0||(new Date).getTime()<this.tracker.settings.notificationsPausedUntil)}getRemainingTime(){if(!this.tracker.settings.notificationsPausedUntil)return 0;if(this.tracker.settings.notificationsPausedUntil===1/0)return-1;const t=(new Date).getTime(),e=this.tracker.settings.notificationsPausedUntil-t;return Math.max(0,e)}destroy(){this.stopCountdown()}}"undefined"!=typeof window&&(window.PauseManager=PauseManager);class PomodoroManager{constructor(t){this.activityTracker=t,this.isActive=!1,this.isRunning=!1,this.isPaused=!1,this.pausedAt=null,this.currentPhase="work",this.cycleCount=0,this.totalSessions=0,this.timer=null,this.tickTimer=null,this.remainingTime=0,this.startTime=null,this.originalDuration=0,this.settings={enabled:!1,workDuration:25,breakDuration:5,longBreakDuration:15,longBreakInterval:4,tickSound:"none",tickInterval:0,shortBreakSound:"gentle",longBreakSound:"bell",resumeSound:"digital",autoStart:!1,autoLog:!0,logBreaks:!1,longBreak:!0,pauseAllowed:!0,autoResetDaily:!1},this.statusUpdateInterval=null,this.lastResetDate=null,this.init()}init(){const t=document.getElementById("pomodoroEnabled");t&&t.addEventListener("change",()=>{this.togglePomodoroMode(t.checked)}),this.setupAutoSaveListeners(),this.loadSettings()}setupAutoSaveListeners(){["pomodoroWorkDuration","pomodoroBreakDuration","pomodoroLongBreakDuration","pomodoroLongBreakInterval","pomodoroTickSound","pomodoroTickInterval","pomodoroShortBreakSound","pomodoroLongBreakSound","pomodoroResumeSound","pomodoroAutoStart","pomodoroAutoLog","pomodoroLogBreaks","pomodoroLongBreak","pomodoroAutoResetDaily","pomodoroLastResetDate"].forEach(t=>{const e=document.getElementById(t);if(e){const t=(e.type,"change");e.addEventListener(t,()=>{this.saveSettings(),this.loadSettings()})}})}loadSettings(){if(this.activityTracker&&this.activityTracker.settings){const t=this.activityTracker.settings;this.settings={enabled:t.pomodoroEnabled||!1,workDuration:parseInt(t.pomodoroWorkDuration)||25,breakDuration:parseInt(t.pomodoroBreakDuration)||5,longBreakDuration:parseInt(t.pomodoroLongBreakDuration)||15,longBreakInterval:parseInt(t.pomodoroLongBreakInterval)||4,tickSound:t.pomodoroTickSound||"none",tickInterval:parseInt(t.pomodoroTickInterval)||0,shortBreakSound:t.pomodoroShortBreakSound||"gentle",longBreakSound:t.pomodoroLongBreakSound||"bell",resumeSound:t.pomodoroResumeSound||"digital",autoStart:t.pomodoroAutoStart||!1,autoLog:!1!==t.pomodoroAutoLog,logBreaks:t.pomodoroLogBreaks||!1,longBreak:!1!==t.pomodoroLongBreak,pauseAllowed:!1!==t.pomodoroPauseAllowed,autoResetDaily:!1!==t.pomodoroAutoResetDaily},this.updateUI()}}updateUI(){const t=document.getElementById("pomodoroEnabled"),e=document.getElementById("pomodoroConfig"),n=document.getElementById("pomodoroWorkDuration"),i=document.getElementById("pomodoroBreakDuration"),o=document.getElementById("pomodoroLongBreakDuration"),s=document.getElementById("pomodoroLongBreakInterval"),a=document.getElementById("pomodoroTickSound"),r=document.getElementById("pomodoroTickInterval"),c=document.getElementById("pomodoroShortBreakSound"),d=document.getElementById("pomodoroLongBreakSound"),l=document.getElementById("pomodoroResumeSound"),u=document.getElementById("pomodoroAutoStart"),m=document.getElementById("pomodoroAutoLog"),p=document.getElementById("pomodoroLogBreaks"),h=document.getElementById("pomodoroLongBreak"),g=document.getElementById("pomodoroAutoResetDaily"),y=document.getElementById("pomodoroStatus");t&&(t.checked=this.settings.enabled),e&&(e.style.display=this.settings.enabled?"block":"none"),n&&(n.value=this.settings.workDuration.toString()),i&&(i.value=this.settings.breakDuration.toString()),o&&(o.value=this.settings.longBreakDuration.toString()),s&&(s.value=this.settings.longBreakInterval.toString()),a&&(a.value=this.settings.tickSound),r&&(r.value=this.settings.tickInterval.toString()),c&&(c.value=this.settings.shortBreakSound),d&&(d.value=this.settings.longBreakSound),l&&(l.value=this.settings.resumeSound),u&&(u.checked=this.settings.autoStart),m&&(m.checked=this.settings.autoLog),p&&(p.checked=this.settings.logBreaks),h&&(h.checked=this.settings.longBreak),g&&(g.checked=this.settings.autoResetDaily),this.updatePomodoroButton(),y&&this.updateStatusDisplay()}togglePomodoroMode(t){this.settings.enabled=t,this.isActive=t;const e=document.getElementById("pomodoroConfig");e&&(e.style.display=t?"block":"none"),this.updatePomodoroButton(),this.activityTracker&&this.activityTracker.pauseManager&&this.activityTracker.pauseManager.updatePauseButtonDisplay(),t?this.startPomodoroMode():this.stopPomodoroMode(),this.activityTracker&&(this.activityTracker.settings.pomodoroEnabled=t,this.activityTracker.saveSettings())}startPomodoroMode(){this.isActive&&(this.currentPhase="work",this.cycleCount=0,this.totalSessions=0,this.isRunning=!1,this.isPaused=!1,this.pausedAt=null,this.currentWorkActivity=null,this.updateState(),this.updateStatusDisplay(),showNotification("Pomodoro mode enabled! Click the button to start your first session.","success"))}stopPomodoroMode(){this.isActive=!1,this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.settings.autoLog&&"work"===this.currentPhase&&this.logActivity("Pomodoro session ended","Work session interrupted"),this.activityTracker&&this.activityTracker.settings&&(this.activityTracker.settings.pomodoroIsActive=!1,this.activityTracker.settings.pomodoroIsRunning=!1,this.activityTracker.settings.pomodoroCurrentPhase=null,this.activityTracker.settings.pomodoroStartTime=null,this.activityTracker.settings.pomodoroRemainingTime=null,this.activityTracker.settings.pomodoroOriginalDuration=null,this.activityTracker.settings.pomodoroIsPaused=!1,this.activityTracker.settings.pomodoroPausedAt=null,this.activityTracker.settings.pomodoroCurrentWorkActivity=null,this.activityTracker.saveSettings()),this.updateUI(),showNotification("Pomodoro mode stopped.","info")}startWorkPeriod(){if(this.isActive)return this.settings.autoLog?(this.pendingWorkSession=!0,void this.showWorkActivityModal()):void this.actuallyStartWorkPeriod()}actuallyStartWorkPeriod(){this.isActive&&(this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.currentPhase="work",this.isRunning=!0,this.isPaused=!1,this.pausedAt=null,this.remainingTime=60*this.settings.workDuration*1e3,this.originalDuration=this.remainingTime,this.startTime=Date.now(),this.timer=setTimeout(()=>{this.endWorkPeriod()},this.remainingTime),this.startTickSounds(),this.startStatusUpdates(),this.updateState(),this.updateUI())}endWorkPeriod(){this.isActive&&(this.cycleCount++,this.totalSessions++,this.isRunning=!1,this.stopTickSounds(),this.updateState(),this.settings.autoLog&&(this.currentWorkActivity?this.logActivity(this.currentWorkActivity.name,this.currentWorkActivity.description||`Completed ${this.settings.workDuration} minute Pomodoro work session`):this.logActivity(`Pomodoro work period #${this.cycleCount} completed`,`Completed ${this.settings.workDuration} minute focused work session`)),this.activityTracker&&this.activityTracker.playNotificationSound(),this.showWorkCompleteNotification(),this.updateUI(),setTimeout(()=>{this.startBreakPeriod()},1e3))}startBreakPeriod(){if(!this.isActive)return;this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.currentPhase="break",this.isRunning=!0,this.isPaused=!1,this.pausedAt=null;const t=this.settings.longBreak&&this.cycleCount>0&&this.cycleCount%this.settings.longBreakInterval===0,e=t?this.settings.longBreakDuration:this.settings.breakDuration;this.remainingTime=60*e*1e3,this.originalDuration=this.remainingTime,this.startTime=Date.now(),this.timer=setTimeout(()=>{this.endBreakPeriod()},this.remainingTime),this.startStatusUpdates(),this.updateState(),this.updateUI();const n=t?"long break":"break",i=t?this.settings.longBreakSound:this.settings.shortBreakSound;if(this.activityTracker&&this.activityTracker.soundManager){const t=this.activityTracker.isPomodoroSoundMuted();this.activityTracker.soundManager.playSound(i,t)}this.showBreakStartNotification(n,e)}endBreakPeriod(){if(this.isActive){if(this.isRunning=!1,this.updateState(),this.settings.logBreaks){const t=this.settings.longBreak&&this.cycleCount>0&&this.cycleCount%this.settings.longBreakInterval===0;this.logActivity("Pomodoro "+(t?"Long Break":"Short Break"),"Completed",[this.generateBreakTag(t)])}if(this.activityTracker&&this.activityTracker.playNotificationSound(),this.activityTracker&&this.activityTracker.soundManager){const t=this.activityTracker.isPomodoroSoundMuted();this.activityTracker.soundManager.playSound(this.settings.resumeSound,t)}this.showBackToWorkNotification(),this.updateUI(),this.settings.autoStart?setTimeout(()=>{this.startWorkPeriod()},1e3):showNotification("Break finished! Click the Pomodoro button to continue.","info",1e4)}}showWorkCompleteNotification(){const t={body:`Work period #${this.cycleCount} complete! Time for a break.`,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23f56565"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>',tag:"pomodoro-work-complete",requireInteraction:!0,actions:[{action:"start-break",title:"Start Break",icon:""},{action:"continue-work",title:"Continue Working",icon:""}]};this.activityTracker&&this.activityTracker.showNotificationWithServiceWorker("Pomodoro - Work Complete!",t)}showBreakStartNotification(t,e){const n={body:`Take a ${t} for ${e} minutes. You've earned it!`,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2348bb78"><path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zM20.71 4.63l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"/></svg>',tag:"pomodoro-break-start",requireInteraction:!1};this.activityTracker&&this.activityTracker.showNotificationWithServiceWorker(`${t.charAt(0).toUpperCase()+t.slice(1)} Time!`,n)}showBackToWorkNotification(){this.activityTracker&&this.activityTracker.showNotificationWithServiceWorker("Back to Work!",{body:"Break time is over. Ready to get back to focused work?",icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23667eea"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"pomodoro-back-to-work",requireInteraction:!0,actions:[{action:"reply",type:"text",title:"Log Work Activity",placeholder:"What will you work on next?"}]})}generateActivityHash(t,e,n){const i=new Date(n),o=`${t}|${e||""}|${new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes()).toISOString()}`;let s=0;for(let t=0;t<o.length;t++)s=(s<<5)-s+o.charCodeAt(t),s&=s;return s.toString()}isDuplicateActivity(t,e,n){if(!this.activityTracker||!this.activityTracker.entries)return!1;const i=this.generateActivityHash(t,e,n);return this.activityTracker.entries.slice(0,10).some(t=>"pomodoro"===t.source&&this.generateActivityHash(t.activity,t.description||"",t.timestamp)===i)}logActivity(t,e,n=[]){if(!this.activityTracker||!this.settings.autoLog)return;const i=(new Date).toISOString();if(this.isDuplicateActivity(t,e,i))return;const o={id:Date.now().toString()+Math.random().toString(36).substr(2,9),activity:t,description:e||"",timestamp:i,created:(new Date).toISOString(),source:"pomodoro",tags:n};this.activityTracker.addEntry(o)}saveSettings(){if(!this.activityTracker)return;const t=document.getElementById("pomodoroWorkDuration"),e=document.getElementById("pomodoroBreakDuration"),n=document.getElementById("pomodoroLongBreakDuration"),i=document.getElementById("pomodoroLongBreakInterval"),o=document.getElementById("pomodoroTickSound"),s=document.getElementById("pomodoroTickInterval"),a=document.getElementById("pomodoroShortBreakSound"),r=document.getElementById("pomodoroLongBreakSound"),c=document.getElementById("pomodoroResumeSound"),d=document.getElementById("pomodoroAutoStart"),l=document.getElementById("pomodoroAutoLog"),u=document.getElementById("pomodoroLogBreaks"),m=document.getElementById("pomodoroLongBreak"),p=document.getElementById("pomodoroAutoResetDaily");t&&(this.settings.workDuration=parseInt(t.value)),e&&(this.settings.breakDuration=parseInt(e.value)),n&&(this.settings.longBreakDuration=parseInt(n.value)),i&&(this.settings.longBreakInterval=parseInt(i.value)),o&&(this.settings.tickSound=o.value),s&&(this.settings.tickInterval=parseInt(s.value)),a&&(this.settings.shortBreakSound=a.value),r&&(this.settings.longBreakSound=r.value),c&&(this.settings.resumeSound=c.value),d&&(this.settings.autoStart=d.checked),l&&(this.settings.autoLog=l.checked),u&&(this.settings.logBreaks=u.checked),m&&(this.settings.longBreak=m.checked),p&&(this.settings.autoResetDaily=p.checked),this.activityTracker.settings.pomodoroWorkDuration=this.settings.workDuration,this.activityTracker.settings.pomodoroBreakDuration=this.settings.breakDuration,this.activityTracker.settings.pomodoroLongBreakDuration=this.settings.longBreakDuration,this.activityTracker.settings.pomodoroLongBreakInterval=this.settings.longBreakInterval,this.activityTracker.settings.pomodoroTickSound=this.settings.tickSound,this.activityTracker.settings.pomodoroTickInterval=this.settings.tickInterval,this.activityTracker.settings.pomodoroShortBreakSound=this.settings.shortBreakSound,this.activityTracker.settings.pomodoroLongBreakSound=this.settings.longBreakSound,this.activityTracker.settings.pomodoroResumeSound=this.settings.resumeSound,this.activityTracker.settings.pomodoroAutoStart=this.settings.autoStart,this.activityTracker.settings.pomodoroAutoLog=this.settings.autoLog,this.activityTracker.settings.pomodoroLogBreaks=this.settings.logBreaks,this.activityTracker.settings.pomodoroLongBreak=this.settings.longBreak,this.activityTracker.settings.pomodoroAutoResetDaily=this.settings.autoResetDaily}getCurrentSessionNumber(){return this.cycleCount+1}getNextSessionNumber(){return"work"===this.currentPhase?this.getCurrentSessionNumber():this.getCurrentSessionNumber()+1}getCurrentStatus(){if(!this.isActive)return"Disabled";if(!this.isRunning)return"Paused";const t=Math.ceil((this.remainingTime-(Date.now()-this.startTime))/6e4);return`${"work"===this.currentPhase?"Working":"Break"}${"work"===this.currentPhase?` (Session ${this.getCurrentSessionNumber()})`:""} - ${Math.max(0,t)}m left`}startTickSounds(){if(this.stopTickSounds(),!this.isActive||"work"!==this.currentPhase||"none"===this.settings.tickSound||this.settings.tickInterval<=0)return;const t=()=>{this.isActive&&this.isRunning&&"work"===this.currentPhase&&(this.playTickSound(),this.tickTimer=setTimeout(t,1e3*this.settings.tickInterval))};this.tickTimer=setTimeout(t,1e3*this.settings.tickInterval)}stopTickSounds(){this.tickTimer&&(clearTimeout(this.tickTimer),this.tickTimer=null)}playTickSound(){if(!this.activityTracker||!this.activityTracker.soundManager)return void console.warn("Tick sound: No sound manager available");if("none"===this.settings.tickSound)return;if(this.activityTracker.isPomodoroSoundMuted())return;let t="soft-tick";switch(this.settings.tickSound){case"soft":t="soft-tick";break;case"classic":t="classic-tick";break;case"digital":t="digital-tick"}this.activityTracker.soundManager.playSound(t,!1)}abandonCurrentSession(){if(!this.isActive||!this.isRunning)return;const t=this.originalDuration-this.remainingTime+(Date.now()-this.startTime),e=Math.round(t/6e4),n=this.getCurrentSessionNumber();this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),e>2&&"work"===this.currentPhase&&this.settings.autoLog?this.showAbandonmentSaveDialog(n,e):this.finalizeAbandonment(n,!1)}showAbandonmentSaveDialog(t,e){if("function"==typeof showPomodoroAbandonDialog){const n=document.getElementById("pomodoroAbandonTitle"),i=document.getElementById("pomodoroAbandonTimeSpent"),o=document.getElementById("pomodoroAbandonActivityName"),s=document.getElementById("pomodoroAbandonActivityDescription");n&&(n.textContent=`Session ${t} Abandonment`),i&&(i.textContent=`You worked for ${e} minutes`),o&&this.currentWorkActivity&&(o.value=this.currentWorkActivity.name||""),s&&this.currentWorkActivity&&(s.value=this.currentWorkActivity.description||`Partial work on session ${t} (${e} minutes)`),showPomodoroAbandonDialog()}else this.finalizeAbandonment(t,!1)}handleAbandonmentSave(t){const e=this.getCurrentSessionNumber();if(t&&this.settings.autoLog){const t=document.getElementById("pomodoroAbandonActivityName"),n=document.getElementById("pomodoroAbandonActivityDescription"),i=t?t.value.trim():"",o=n?n.value.trim():"";i&&(this.logActivity(i,o||`Partial Pomodoro session ${e} work`,[this.generateAbandonedTag(e)]),showNotification(`Partial work saved: "${i}"`,"success"))}"function"==typeof closePomodoroAbandonDialog&&closePomodoroAbandonDialog(),this.finalizeAbandonment(e,t)}generateAbandonedTag(t){return`pd${(new Date).toISOString().split("T")[0].replace(/-/g,"")}_${t.toString().padStart(2,"0")}_dnc`}generateBreakTag(t){return`pd${(new Date).toISOString().split("T")[0].replace(/-/g,"")}_${t?"lb":"sb"}`}finalizeAbandonment(t,e){this.settings.autoLog&&!e&&(this.currentWorkActivity&&this.currentWorkActivity.name?this.logActivity(this.currentWorkActivity.name,this.currentWorkActivity.description||`Pomodoro session ${t} abandoned`,[this.generateAbandonedTag(t)]):this.logActivity(`Pomodoro session ${t} abandoned`,`Session interrupted, restarting at session ${t}`,[this.generateAbandonedTag(t)])),this.isRunning=!1,this.isPaused=!1,this.pausedAt=null,this.currentPhase="work",this.currentWorkActivity=null,this.updateState(),showNotification(e?`Session ${t} abandoned with work saved. Click Start to begin next session.`:`Session ${t} abandoned. Click Start to begin next session.`,"warning"),this.updateUI()}restoreFromState(t){t&&(this.cycleCount=t.cycleCount||0,this.totalSessions=t.totalSessions||0,t.isRunning&&t.startTime&&t.remainingTime&&this.restoreActiveSession(t),this.updateUI())}restoreActiveSession(t){const e=Date.now();let n;if(t.isPaused&&t.pausedAt){const e=t.pausedAt-t.startTime;n=t.originalDuration-e}else{const i=e-t.startTime;n=t.remainingTime-i}n<=0?this.handleExpiredSession(t):(this.isActive=!0,this.isRunning=!0,this.currentPhase=t.currentPhase,this.originalDuration=t.originalDuration,t.isPaused?(this.isPaused=!0,this.pausedAt=t.pausedAt,this.startTime=t.startTime,this.remainingTime=t.remainingTime,this.startStatusUpdates(),showNotification(`Paused session restored! ${Math.ceil(n/6e4)} minutes remaining.`,"info")):(this.isPaused=!1,this.pausedAt=null,this.startTime=e,this.remainingTime=n,this.timer=setTimeout(()=>{"work"===this.currentPhase?this.endWorkPeriod():this.endBreakPeriod()},n),this.startTickSounds(),this.startStatusUpdates(),showNotification(`Session restored! ${Math.ceil(n/6e4)} minutes remaining.`,"success")),t.workActivity&&(this.currentWorkActivity=t.workActivity))}handleExpiredSession(t){"work"===t.currentPhase?showNotification("Work session completed while page was closed. Ready for break!","info"):showNotification("Break completed while page was closed. Ready for next session!","info"),this.isActive=!0,this.isRunning=!1,this.isPaused=!1}updateState(){if(!this.activityTracker)return;const t={isRunning:this.isRunning,isPaused:this.isPaused,currentPhase:this.currentPhase,sessionNumber:this.getCurrentSessionNumber(),startTime:this.startTime,originalDuration:this.originalDuration,remainingTime:this.remainingTime,pausedAt:this.pausedAt,workActivity:this.currentWorkActivity,cycleCount:this.cycleCount,totalSessions:this.totalSessions};this.activityTracker.updatePomodoroState(t)}updateStatusDisplay(){const t=document.getElementById("pomodoroStatus"),e=document.getElementById("statusBanner"),n=document.getElementById("pomodoroStatusSection"),i=document.getElementById("pomodoroTimer"),o=document.getElementById("pomodoroTimeRemaining"),s=document.getElementById("pomodoroPhase"),a=document.getElementById("pomodoroActivityDisplay"),r=document.getElementById("pomodoroActivityText"),c=document.getElementById("pomodoroActivityDesc");if(!this.isActive){t&&(t.textContent="Pomodoro mode disabled",t.style.display="block"),i&&(i.style.display="none"),n&&(n.style.display="none");const o=document.getElementById("reminderStatusSection");return e&&o&&n&&"none"===n.style.display&&"none"===o.style.display&&(e.style.display="none"),void(this.activityTracker&&this.activityTracker.settings.notificationsEnabled&&this.activityTracker.startNotificationTimer())}if(this.activityTracker&&this.activityTracker.stopNotificationTimer(),e&&n&&(e.style.display="block",n.style.display="flex"),!this.isRunning){if(t){const e=this.getCurrentSessionNumber();t.textContent=`Ready to start session ${e}`,t.style.display="block"}return i&&(i.style.display="none"),void this.hidePauseButton()}t&&(t.style.display="none"),i&&(i.style.display="flex");const d=Math.ceil((this.remainingTime-(Date.now()-this.startTime))/6e4);let l;if(Math.max(0,d),this.isPaused){const t=this.pausedAt-this.startTime;l=this.originalDuration-t}else l=this.remainingTime-(Date.now()-this.startTime);const u=Math.floor(l/6e4),m=Math.floor(l%6e4/1e3),p=`${Math.max(0,u)}:${Math.max(0,m).toString().padStart(2,"0")}`;if("work"===this.currentPhase){const t=this.getCurrentSessionNumber();o&&(o.textContent=p),s&&(s.textContent=this.isPaused?`#${t} (Paused)`:`#${t}`),a&&r&&this.currentWorkActivity&&this.currentWorkActivity.name?(a.style.display="block",r.textContent=this.currentWorkActivity.name,c&&this.currentWorkActivity.description?(c.textContent=this.currentWorkActivity.description,c.style.display="block"):c&&(c.style.display="none")):a&&(a.style.display="none")}else{const t=this.settings.longBreak&&this.cycleCount>0&&this.cycleCount%this.settings.longBreakInterval===0?"Long Break":"Short Break";o&&(o.textContent=p),s&&(s.textContent=this.isPaused?`${t} (Paused)`:t),a&&(a.style.display="none")}this.settings.pauseAllowed?(this.showPauseButton(),this.updatePauseButtonText()):this.hidePauseButton()}updatePomodoroButton(){const t=document.getElementById("pomodoroButton");if(t)if(this.settings.enabled)if(t.style.display="inline-block",this.isActive)if(this.isRunning)if("work"===this.currentPhase){const e=this.getCurrentSessionNumber();t.textContent=`Abandon Session ${e}`,t.className="nav-btn pomodoro-btn active",t.title="Abandon current work session and restart"}else t.textContent="On Break",t.className="nav-btn pomodoro-btn breaking",t.title="Currently on break - click to abandon and restart";else{const e=this.getCurrentSessionNumber();t.textContent=` Start Session ${e}`,t.className="nav-btn pomodoro-btn",t.title=`Start work session ${e}`}else t.textContent="Start Pomodoro",t.className="nav-btn pomodoro-btn",t.title="Start a new Pomodoro session";else t.style.display="none"}togglePomodoroFromButton(){this.isActive?this.isRunning?this.abandonCurrentSession():this.startWorkPeriod():(this.togglePomodoroMode(!0),this.startWorkPeriod())}startStatusUpdates(){this.stopStatusUpdates(),this.statusUpdateInterval=setInterval(()=>{this.isActive&&(this.isRunning||this.isPaused)&&(this.updateStatusDisplay(),this.updatePomodoroButton())},1e3)}stopStatusUpdates(){this.statusUpdateInterval&&(clearInterval(this.statusUpdateInterval),this.statusUpdateInterval=null)}checkDailyAutoReset(){if(!this.settings.autoResetDaily)return;const t=(new Date).toDateString();this.lastResetDate&&this.lastResetDate!==t?(this.cycleCount=0,this.totalSessions=0,this.lastResetDate=t,this.settings.autoLog&&this.logActivity("Daily Pomodoro reset","Session counter automatically reset for new day"),this.updateState(),this.updateUI(),showNotification("Daily session reset applied","info")):this.lastResetDate||(this.lastResetDate=t,this.updateState())}resetSessionCounter(){this.cycleCount=0,this.totalSessions=0,this.lastResetDate=(new Date).toDateString(),this.updateState(),this.updateUI(),this.settings.autoLog&&this.logActivity("Pomodoro session counter reset","Starting fresh Pomodoro cycle"),showNotification("Pomodoro session counter reset","info")}showWorkActivityModal(){if("function"==typeof showPomodoroActivityModal){showPomodoroActivityModal();const t=document.getElementById("pomodoroActivityForm");t&&!t.pomodoroHandlerAdded&&(t.addEventListener("submit",t=>{t.preventDefault(),this.handleWorkActivitySubmit()}),t.pomodoroHandlerAdded=!0)}}handleWorkActivitySubmit(){const t=document.getElementById("pomodoroActivityName"),e=document.getElementById("pomodoroActivityDescription");t&&t.value.trim()&&(this.currentWorkActivity={name:t.value.trim(),description:e?e.value.trim():""},"function"==typeof closePomodoroActivityModal&&closePomodoroActivityModal(),this.pendingWorkSession=!1,this.actuallyStartWorkPeriod(),this.updateState())}togglePause(){this.isActive&&this.isRunning&&(this.settings.pauseAllowed?this.isPaused?this.resumeSession():this.pauseSession():showNotification("Session pausing is disabled in settings","warning"))}pauseSession(){this.isActive&&this.isRunning&&!this.isPaused&&(this.isPaused=!0,this.pausedAt=Date.now(),this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.updateState(),this.updateStatusDisplay(),this.updatePomodoroButton(),showNotification("Pomodoro session paused","info"))}resumeSession(){if(!this.isActive||!this.isPaused)return;const t=this.pausedAt-this.startTime,e=this.originalDuration-t;this.startTime=Date.now(),this.remainingTime=e,this.isPaused=!1,this.pausedAt=null,this.timer=setTimeout(()=>{"work"===this.currentPhase?this.endWorkPeriod():this.endBreakPeriod()},e),"work"===this.currentPhase&&this.startTickSounds(),this.startStatusUpdates(),this.updateState(),this.updateStatusDisplay(),this.updatePomodoroButton(),showNotification("Pomodoro session resumed","success")}showPauseButton(){const t=document.getElementById("pomodoroBannerControls");t&&(t.style.display="flex")}hidePauseButton(){const t=document.getElementById("pomodoroBannerControls");t&&(t.style.display="none")}updatePauseButtonText(){const t=document.getElementById("pomodoroPauseBtn");t&&(t.textContent=this.isPaused?"Resume":"Pause")}destroy(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.isActive=!1,this.isRunning=!1}}"undefined"!=typeof window&&(window.PomodoroManager=PomodoroManager);class MarkdownRenderer{constructor(){this.rules=[{pattern:/^###### (.*$)/gim,replacement:"<h6>$1</h6>"},{pattern:/^##### (.*$)/gim,replacement:"<h5>$1</h5>"},{pattern:/^#### (.*$)/gim,replacement:"<h4>$1</h4>"},{pattern:/^### (.*$)/gim,replacement:"<h3>$1</h3>"},{pattern:/^## (.*$)/gim,replacement:"<h2>$1</h2>"},{pattern:/^# (.*$)/gim,replacement:"<h1>$1</h1>"},{pattern:/```([^`]*)```/gims,replacement:"<pre><code>$1</code></pre>"},{pattern:/(^|[\s\(\[])(\*\*\*(.*?)\*\*\*)(?=[\s\)\].,!?;:]|$)/gim,replacement:"$1<strong><em>$3</em></strong>"},{pattern:/(^|[\s\(\[])(___(.*?)___)(?=[\s\)\].,!?;:]|$)/gim,replacement:"$1<strong><em>$2</em></strong>"},{pattern:/(^|[\s\(\[])(\*\*(.*?)\*\*)(?=[\s\)\].,!?;:]|$)/gim,replacement:"$1<strong>$3</strong>"},{pattern:/(^|[\s\(\[])(__([^_]*?)__)(?=[\s\)\].,!?;:]|$)/gim,replacement:"$1<strong>$2</strong>"},{pattern:/(^|[\s\(\[])(\*([^*]*?)\*)(?=[\s\)\].,!?;:]|$)/gim,replacement:"$1<em>$3</em>"},{pattern:/(^|[\s\(\[])(_([^_]*?)_)(?=[\s\)\].,!?;:]|$)/gim,replacement:"$1<em>$2</em>"},{pattern:/~~(.*?)~~/gim,replacement:"<del>$1</del>"},{pattern:/`([^`]+?)`/gim,replacement:"<code>$1</code>"},{pattern:/\[([^\]]*)\]\(([^\s\)]+)\s+"([^"]*)"\)/gim,replacement:'<a href="$2" title="$3">$1</a>'},{pattern:/\[([^\]]*)\]\(([^\)]*)\)/gim,replacement:'<a href="$2">$1</a>'},{pattern:/!\[([^\]]*)\]\(([^\)]*)\)/gim,replacement:'<img src="$2" alt="$1">'},{pattern:/^(-{3,}|\*{3,}|_{3,})\s*$/gim,replacement:"<hr>"},{pattern:/^> (.*)$/gim,replacement:"<blockquote>$1</blockquote>"}]}render(t,e=!1){if(!t||"string"!=typeof t)return"";let n=t.trim();return n=this.renderLists(n),this.rules.forEach(t=>{n=n.replace(t.pattern,t.replacement)}),n=n.replace(/\n\s*\n/gim,"</p><p>"),n=n.replace(/\n(?![<\/]|<ul>|<ol>|<li>)/gim,"<br>"),e&&n.match(/^<(h[1-6]|ul|ol|blockquote|hr)/)||(n="<p>"+n+"</p>"),n=n.replace(/<p>\s*<\/p>/gim,""),n=n.replace(/<p><h/gim,"<h"),n=n.replace(/<\/h([1-6])><\/p>/gim,"</h$1>"),n=n.replace(/<p><hr><\/p>/gim,"<hr>"),n=n.replace(/<p><blockquote>/gim,"<blockquote>"),n=n.replace(/<\/blockquote><\/p>/gim,"</blockquote>"),n=n.replace(/<p><ul>/gim,"<ul>"),n=n.replace(/<\/ul><\/p>/gim,"</ul>"),n=n.replace(/<p><ol>/gim,"<ol>"),n=n.replace(/<\/ol><\/p>/gim,"</ol>"),n=n.replace(/<br>\s*<\/li>/gim,"</li>"),n=n.replace(/<li><br>/gim,"<li>"),n=n.replace(/<\/ul><br>/gim,"</ul>"),n=n.replace(/<br><ul>/gim,"<ul>"),n=n.replace(/<\/ol><br>/gim,"</ol>"),n=n.replace(/<br><ol>/gim,"<ol>"),n}renderLists(t){const e=t.split("\n"),n=[];for(let t=0;t<e.length;t++){const i=e[t],o=i.match(/^(\s*)-\s+(.*)$/),s=i.match(/^(\s*)\d+\.\s+(.*)$/);if(o){const t=o[1].length,e=o[2],s=Math.floor(t/2);n.push({type:"list-item",listType:"ul",level:s,content:e,original:i})}else if(s){const t=s[1].length,e=s[2],o=Math.floor(t/2);n.push({type:"list-item",listType:"ol",level:o,content:e,original:i})}else n.push({type:"text",content:i,original:i})}let i=[],o=[];for(let t=0;t<n.length;t++){const e=n[t];if("list-item"===e.type){const t=e.level,n=e.listType;for(;o.length>t+1;){const t=o.pop();i.push(`</${t.type}>`)}if(o.length===t+1&&o[o.length-1].type!==n){const t=o.pop();i.push(`</${t.type}>`)}for(;o.length<=t;)i.push(`<${n}>`),o.push({type:n,level:t});i.push(`<li>${e.content}</li>`)}else{for(;o.length>0;){const t=o.pop();i.push(`</${t.type}>`)}e.content.trim()&&i.push(e.content)}}for(;o.length>0;){const t=o.pop();i.push(`</${t.type}>`)}return i.join("\n")}renderInline(t){return this.render(t,!0)}renderWithClasses(t,e=!1){let n=this.render(t,e);return n=n.replace(/<h1>/gim,'<h1 class="md-h1">'),n=n.replace(/<h2>/gim,'<h2 class="md-h2">'),n=n.replace(/<h3>/gim,'<h3 class="md-h3">'),n=n.replace(/<h4>/gim,'<h4 class="md-h4">'),n=n.replace(/<h5>/gim,'<h5 class="md-h5">'),n=n.replace(/<h6>/gim,'<h6 class="md-h6">'),n=n.replace(/<blockquote>/gim,'<blockquote class="md-blockquote">'),n=n.replace(/<code>/gim,'<code class="md-code">'),n=n.replace(/<pre>/gim,'<pre class="md-codeblock">'),n=n.replace(/<ul>/gim,'<ul class="md-list">'),n=n.replace(/<ol>/gim,'<ol class="md-list-ordered">'),n=n.replace(/<p>/gim,'<p class="md-paragraph">'),n=n.replace(/<hr>/gim,'<hr class="md-hr">'),n=n.replace(/<strong>/gim,'<strong class="md-bold">'),n=n.replace(/<em>/gim,'<em class="md-italic">'),n=n.replace(/<del>/gim,'<del class="md-strikethrough">'),n=n.replace(/<a /gim,'<a class="md-link" '),n=n.replace(/<img /gim,'<img class="md-image" '),n}renderInlineWithClasses(t){return this.renderWithClasses(t,!0)}preview(t,e=10){if(!t)return"";const n=t.split("\n").slice(0,e),i=n.join("\n");return n.length>=e&&t.split("\n").length>e?this.renderWithClasses(i)+'<p class="md-preview-more">...</p>':this.renderWithClasses(i)}}"undefined"!=typeof window&&(window.MarkdownRenderer=MarkdownRenderer);class TemplatingEngine{constructor(){this.formatters={date:(t,e="dd/mm/yyyy")=>this.formatDate(t,e),time:t=>{if(!t)return"--:--";let e=t instanceof Date?t:new Date(t);return isNaN(e.getTime())?"--:--":e.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})},datetime:t=>new Date(t).toLocaleString("en-GB"),uppercase:t=>String(t).toUpperCase(),lowercase:t=>String(t).toLowerCase(),capitalize:t=>String(t).charAt(0).toUpperCase()+String(t).slice(1),escapeHtml:t=>this.escapeHtml(t),escapeCsv:t=>this.escapeCsv(t),nl2br:t=>String(t).replace(/\n/g,"<br>"),stripLinebreaks:t=>String(t).replace(/(\r\n|\n|\r)/gm," "),duration:t=>this.formatDuration(t),markdown:t=>window.MarkdownRenderer?(new window.MarkdownRenderer).renderInlineWithClasses(String(t)):this.escapeHtml(t),cleanHashtags:t=>this.cleanHashtags(t)}}render(t,e){try{const n=this.tokenize(t),i=this.parse(n);return this.evaluate(i,e)}catch(t){return console.error("Template render error:",t),`Template Error: ${t.message}`}}tokenize(t){const e=[];let n=0;for(;n<t.length;){const i=t.indexOf("{{",n);if(-1===i){n<t.length&&e.push({type:"TEXT",value:t.substring(n)});break}i>n&&e.push({type:"TEXT",value:t.substring(n,i)});const o=t.indexOf("}}",i);if(-1===o)throw new Error("Unclosed template expression at position "+i);const s=t.substring(i+2,o).trim(),a=this.parseExpression(s);e.push(a),n=o+2}return e}parseExpression(t){if(t.startsWith("#each ")){const e=t.match(/^#each\s+(\w+)\s*=\s*([\w.]+)$/);if(!e)throw new Error("Invalid each expression: "+t);return{type:"EACH_START",itemVar:e[1],arrayPath:e[2]}}if("/each"===t)return{type:"EACH_END"};if(t.startsWith("#if "))return{type:"IF_START",condition:t.substring(4).trim()};if("else"===t)return{type:"ELSE"};if("/if"===t)return{type:"IF_END"};const e=t.split("|").map(t=>t.trim());return{type:"VARIABLE",path:e[0],formatters:e.slice(1)}}parse(t){const e=[];let n=0;for(;n<t.length;){const i=this.parseNode(t,n);i?(e.push(i.node),n=i.nextIndex):n++}return e}parseNode(t,e){if(e>=t.length)return null;const n=t[e];switch(n.type){case"TEXT":return{node:{type:"text",value:n.value},nextIndex:e+1};case"VARIABLE":return{node:{type:"variable",path:n.path,formatters:n.formatters},nextIndex:e+1};case"EACH_START":return this.parseEachLoop(t,e);case"IF_START":return this.parseIfStatement(t,e);case"EACH_END":case"IF_END":case"ELSE":return console.warn("Orphaned token:",n.type,"at index",e),null;default:throw new Error("Unknown token type: "+n.type)}}parseEachLoop(t,e){const n=t[e],i=[];let o=e+1,s=1;for(;o<t.length&&s>0;){const e=t[o];if("EACH_START"===e.type){const e=this.parseEachLoop(t,o);i.push(e.node),o=e.nextIndex}else if("EACH_END"===e.type){if(s--,0===s)break;console.error(`Unexpected EACH_END at depth ${s} for ${n.itemVar}`),o++}else{const e=this.parseNode(t,o);e?(i.push(e.node),o=e.nextIndex):o++}}if(s>0)throw console.error(`Unclosed each loop for ${n.itemVar}, depth: ${s}, current: ${o}, tokens.length: ${t.length}`),console.error("Remaining tokens:",t.slice(o).map(t=>`${t.type}: ${JSON.stringify(t.value||t.path)}`)),new Error(`Unclosed each loop for ${n.itemVar}`);return{node:{type:"each",itemVar:n.itemVar,arrayPath:n.arrayPath,children:i},nextIndex:o+1}}parseIfStatement(t,e){const n=t[e],i=[],o=[];let s=e+1,a=1,r=!1;for(;s<t.length&&a>0;){const e=t[s];if("IF_START"===e.type){a++;const e=this.parseIfStatement(t,s);r?o.push(e.node):i.push(e.node),s=e.nextIndex}else if("IF_END"===e.type){if(a--,0===a)break;s++}else if("ELSE"===e.type&&1===a)r=!0,s++;else{const e=this.parseNode(t,s);e?(r?o.push(e.node):i.push(e.node),s=e.nextIndex):s++}}return{node:{type:"if",condition:n.condition,ifChildren:i,elseChildren:o},nextIndex:s+1}}evaluate(t,e,n=0){return"  ".repeat(n),t.map(t=>this.evaluateNode(t,e,n)).join("")}evaluateNode(t,e,n=0){const i="  ".repeat(n);switch(t.type){case"text":return t.value;case"variable":let o=this.getValue(e,t.path);for(const e of t.formatters||[])o=this.applyFormatter(o,e);return null!=o?String(o):"";case"each":const s=this.getValue(e,t.arrayPath);return Array.isArray(s)?s.map((i,o)=>{const a={...e,[t.itemVar]:i,index:o,first:0===o,last:o===s.length-1};return this.evaluate(t.children,a,n+1)}).join(""):(console.warn(`${i}Not an array:`,s),"");case"if":const a=this.getValue(e,t.condition),r=this.isTruthy(a)?t.ifChildren:t.elseChildren;return this.evaluate(r,e,n+1);default:throw new Error("Unknown node type: "+t.type)}}getValue(t,e){if(!e||!t)return;const n=e.split(".");let i=t;for(const t of n){if(null==i)return;i=i[t]}return i}isTruthy(t){return null!=t&&("boolean"==typeof t?t:"number"==typeof t?0!==t:"string"==typeof t||Array.isArray(t)?t.length>0:"object"==typeof t?Object.keys(t).length>0:!!t)}applyFormatter(t,e){const n=e.match(/^(\w+)(?:\s*\(\s*['"]?(.*?)['"]?\s*\))?$/);if(!n)return t;const[,i,o]=n;if(!this.formatters[i])return console.warn("Unknown formatter:",i),t;try{return void 0!==o?this.formatters[i](t,o):this.formatters[i](t)}catch(e){return console.warn("Formatter error:",i,e),t}}formatDate(t,e){const n=new Date(t);if(isNaN(n.getTime()))return"Invalid Date";const i=n.getFullYear(),o=n.getMonth(),s=n.getDate();let a=e.replace(/mmm/g,["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o]);return a=a.replace(/yyyy/g,i).replace(/mm/g,String(o+1).padStart(2,"0")).replace(/dd/g,String(s).padStart(2,"0")),a}formatDuration(t){if(isNaN(t)||t<0)return"";const e=Math.floor(t/60),n=t%60;let i="";return e>0&&(i+=`${e}h `),n>0&&(i+=`${n}m`),i.trim()}escapeHtml(t){return null==t?"":String(t).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}escapeCsv(t){if(null==t)return"";let e=String(t);return e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e}cleanHashtags(t){return null==t?"":String(t).replace(/#([\w][\w-_]*)/g,(t,e)=>e.replace(/[-_]/g," "))}}window.TemplatingEngine=TemplatingEngine,window.ReportTemplates={"detailed-html":{name:"Detailed Report (HTML)",description:"A comprehensive HTML report with timings and full descriptions.",type:"html",template:'<!DOCTYPE html>\n<html lang="en-GB">\n<head>\n    <meta charset="UTF-8">\n    <title>Activity Report: {{ report.startDate | date(\'dd/mm/yyyy\') }} - {{ report.endDate | date(\'dd/mm/yyyy\') }}</title>\n    <style>\n        body { font-family: sans-serif; line-height: 1.5; color: #333; }\n        .report-container { max-width: 800px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }\n        .report-header { text-align: center; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin-bottom: 20px; }\n        .report-summary { background: #f0f2ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }\n        .day-group { margin-bottom: 20px; }\n        .day-header { font-size: 1.2em; font-weight: bold; color: #667eea; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; }\n        .entry { margin-bottom: 10px; padding-left: 15px; border-left: 3px solid #ccc; }\n        .entry-time { font-weight: bold; }\n        .entry-activity { font-size: 1.1em; }\n        .entry-description { color: #555; font-style: italic; }\n        .duration { font-size: 0.9em; color: #888; }\n    </style>\n</head>\n<body>\n    <div class="report-container">\n        <div class="report-header">\n            <h1>Activity Report</h1>\n            <p>{{ report.startDate | date(\'dd mmm yyyy\') }} to {{ report.endDate | date(\'dd mmm yyyy\') }}</p>\n        </div>\n        <div class="report-summary">\n            <h3>Report Summary</h3>\n            <p><strong>Total Entries:</strong> {{ report.totalEntries }}</p>\n            <p><strong>Total Duration:</strong> {{ report.totalDuration | duration }}</p>\n            <p><strong>Active Days:</strong> {{ report.activeDays }}</p>\n        </div>\n        \n        {{#each day = days}}\n        <div class="day-group">\n            <h2 class="day-header">{{ day.date }} ({{ day.entries.length }} entries, {{ day.totalDuration | duration }})</h2>\n            {{#each entry = day.entries}}\n            <div class="entry">\n                <p><span class="entry-time">{{ entry.timestamp | time }}</span>: <span class="entry-activity">{{ entry.activity | cleanHashtags | escapeHtml }}</span></p>\n                {{#if entry.description}}\n                <div class="entry-description">{{ entry.description | cleanHashtags | markdown }}</div>\n                {{/if}}\n                <p class="duration">Duration: {{ entry.duration | duration }}</p>\n            </div>\n            {{/each}}\n        </div>\n        {{/each}}\n    </div>\n</body>\n</html>'},"summary-markdown":{name:"Summary (Markdown)",description:"A summary report in Markdown, suitable for pasting into documents.",type:"markdown",template:"# Activity Report\n\n**Period:** {{ report.startDate | date('dd mmm yyyy') }} to {{ report.endDate | date('dd mmm yyyy') }}\n\n## Summary\n- **Total Entries:** {{ report.totalEntries }}\n- **Total Duration:** {{ report.totalDuration | duration }}\n- **Active Days:** {{ report.activeDays }}\n\n---\n\n{{#each day = days}}\n## {{ day.date }} (Total: {{ day.totalDuration | duration }})\n{{#each entry = day.entries}}\n- **{{ entry.timestamp | time }} ({{ entry.duration | duration }})**: {{ entry.activity | cleanHashtags }}\n{{/each}}\n{{/each}}"},"basic-csv":{name:"Basic Export (CSV)",description:"A simple CSV file with core activity data.",type:"csv",template:"Date,Time,Activity,Description\n{{#each entry = entries}}{{ entry.timestamp | date('yyyy-mm-dd') }},{{ entry.timestamp | time }},{{ entry.activity | cleanHashtags | escapeCsv | stripLinebreaks }},{{ entry.description | cleanHashtags | escapeCsv | stripLinebreaks }}\n{{/each}}"},"timed-csv":{name:"Timed Export (CSV)",description:"A detailed CSV file including calculated durations.",type:"csv",template:'Date,StartTime,EndTime,DurationMinutes,Activity,Description\n{{#each entry = entries}}{{ entry.timestamp | date(\'yyyy-mm-dd\') }},{{ entry.timestamp | time }},{{ entry.endTime | time }},{{ entry.duration }},"{{ entry.activity | cleanHashtags | escapeCsv | stripLinebreaks }}","{{ entry.description | cleanHashtags | escapeCsv | stripLinebreaks }}"\n{{/each}}'}};const VERSION_HISTORY=[{commit:"TBD",date:"2025-08-12",summary:"Enhanced service worker diagnostics with comprehensive modal interface, statistics collection, and interactive features"},{commit:"46ff2e2",date:"2025-08-07",summary:"Added SVG logo overlay to background. Fixed more todo/notes UI bugs. Updated Service Worker notifications"},{commit:"31b0120",date:"2025-08-07",summary:"Fixed todo/notes form submissions, improved contextual entry creation across all form types"},{commit:"24dacd7",date:"2025-08-05",summary:"Added complex activity schedule support"},{commit:"5398868",date:"2025-08-05",summary:"Added workspace system for organising separate projects and schedules"}];function getVersionHistory(){return VERSION_HISTORY}function getCurrentVersion(){return APP_VERSION}function formatVersionHistory(){let t=`<div class="version-current">\n        <strong>Current Build:</strong> ${getCurrentVersion()}\n    </div>\n    <div class="version-history-list">\n        <h5 style="margin: 16px 0 12px 0; color: #4a5568;">Recent Major Changes</h5>`;return VERSION_HISTORY.forEach((e,n)=>{t+=`<div class="${0===n?"version-entry current":"version-entry"}">\n            <div class="version-header">\n                <span class="version-number">${e.commit}</span>\n                <span class="version-date">${e.date}</span>\n            </div>\n            <div class="version-summary">${e.summary}</div>\n        </div>`}),t+="</div>",t}"undefined"!=typeof window&&(window.VersionHistory={getVersionHistory:getVersionHistory,getCurrentVersion:getCurrentVersion,formatVersionHistory:formatVersionHistory});class ActivityTracker{constructor(){let t=[];try{const e=JSON.parse(localStorage.getItem("activityEntries"));Array.isArray(e)&&(t=e.filter(t=>t&&"object"==typeof t&&t.timestamp).map(t=>(void 0===t.isTodo&&(t.isTodo=!1),void 0===t.isNote&&(t.isNote=!1),t.tags||(t.tags=[]),t.dueDate||(t.dueDate=null),t.startedAt||(t.startedAt=null),t)))}catch(t){console.error("Error parsing activity entries from localStorage",t),localStorage.removeItem("activityEntries")}this.entries=t,this.defaultSettings={notificationInterval:60,startTime:"08:00",endTime:"18:00",workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},complexSchedule:{monday:[{start:"09:00",end:"17:00"}],tuesday:[{start:"09:00",end:"17:00"}],wednesday:[{start:"09:00",end:"17:00"}],thursday:[{start:"09:00",end:"17:00"}],friday:[{start:"09:00",end:"17:00"}],saturday:[],sunday:[]},useComplexSchedule:!1,pauseDuration:60,notificationsPausedUntil:null,notificationsEnabled:!0,autoStartAlerts:!1,hasRequestedNotificationPermission:!1,sendSystemNotifications:!0,soundMuteMode:"none",notificationSoundType:"classic",reminderTimerReset:"on_add",darkModePreference:"system",paginationSize:20,hashtagCloudLimit:50,warnOnActivityDelete:!0,warnOnSessionReset:!0},this.settings={...this.defaultSettings,...JSON.parse(localStorage.getItem("activitySettings")||"{}")},this.notificationTimer=null,this.currentReportEntries=[],this.currentWeekStart=null,this.soundManager=null,this.pauseManager=null,this.state=this.loadState(),this.currentWorkspace=localStorage.getItem("currentWorkspace")||"Default",this.initializeWorkspaces(),this.init()}init(){this.loadSettings(),this.migrateExistingEntries(),this.initMarkdownRenderer(),this.initReportTemplates(),this.loadReportTemplatesIntoEditor(),this.initTemplatePreviewGrid(),this.displayEntries(),this.displayTodos(),this.displayNotes(),this.updateNotificationStatus(),this.updateDebugInfo(),this.updatePauseButtonState(),this.updateHeaderWorkspaceName(),this.settings.autoStartAlerts&&this.startNotificationTimer(),this.setWeeklyReport(),this.initSoundManager(),this.initPauseManager(),this.initPomodoroManager(),this.attachEventListeners(),this.initSearch(),this.initHashtagCompletion(),this.setCurrentTime(),this.checkNotificationSetup(),document.getElementById("activity").focus(),"file:"===window.location.protocol&&console.warn("Running from local file - notifications may have limitations"),"function"==typeof initializeDueDateSystem&&initializeDueDateSystem()}migrateExistingEntries(){let t=!1;this.entries.forEach(e=>{e.tags&&0!==e.tags.length||(e.tags=this.extractHashtags(e.activity+" "+(e.description||"")),t=!0)}),t&&this.saveEntries()}getReportTemplates(){const t={...window.ReportTemplates||{}},e=localStorage.getItem("customReportTemplates");if(e)try{const n=JSON.parse(e);Object.assign(t,n)}catch(t){console.error("Error parsing custom report templates from localStorage",t)}return t}loadReportTemplatesIntoEditor(){const t=document.getElementById("report-templates-editor");if(!t)return;const e=this.getReportTemplates();t.innerHTML=Object.keys(e).map(t=>`\n            <div class="template-group">\n                <label for="template-${t}">${e[t].name}</label>\n                <textarea id="template-${t}" data-key="${t}">${escapeHtml(e[t].template)}</textarea>\n            </div>\n        `).join("")}saveReportTemplates(){const t=document.getElementById("report-templates-editor");if(!t)return;const e=this.getReportTemplates();t.querySelectorAll("textarea").forEach(t=>{const n=t.dataset.key;e[n]&&(e[n].template=t.value)}),localStorage.setItem("reportTemplates",JSON.stringify(e)),showNotification("Report templates saved successfully!","success"),this.initReportTemplates(),this.currentReportData&&this.previewReport()}resetReportTemplates(){confirm("Are you sure you want to reset all report templates to their default values?")&&(localStorage.removeItem("reportTemplates"),this.loadReportTemplatesIntoEditor(),this.initReportTemplates(),this.currentReportData&&this.previewReport(),showNotification("Report templates have been reset to default.","success"))}initMarkdownRenderer(){try{this.markdownRenderer=new MarkdownRenderer}catch(t){console.warn("Markdown Renderer initialization failed:",t)}}initPauseManager(){try{this.pauseManager=new PauseManager(this)}catch(t){console.warn("Pause Manager initialization failed:",t)}}attachEventListeners(){document.getElementById("activityForm").addEventListener("submit",t=>{t.preventDefault(),this.addEntry("tracker")});const t=document.getElementById("todoActivityForm");t&&t.addEventListener("submit",t=>{t.preventDefault(),this.addEntry("todo")});const e=document.getElementById("notesActivityForm");e&&e.addEventListener("submit",t=>{t.preventDefault(),this.addEntry("notes")}),document.getElementById("editForm").addEventListener("submit",t=>{t.preventDefault(),this.updateEntry()}),this.attachSettingsListeners()}attachSettingsListeners(){["notificationInterval","startTime","endTime","pauseDuration","soundMuteMode","notificationSoundType","darkModePreference","autoStartAlerts","paginationSize","hashtagCloudLimit","pomodoroEnabled","pomodoroWorkDuration","pomodoroBreakDuration","pomodoroLongBreakDuration","pomodoroLongBreakInterval","pomodoroTickSound","pomodoroTickInterval","pomodoroShortBreakSound","pomodoroLongBreakSound","pomodoroResumeSound","pomodoroAutoStart","pomodoroAutoLog","pomodoroLogBreaks","pomodoroLongBreak","warnOnActivityDelete","warnOnSessionReset","pomodoroPauseAllowed","monday","tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(t=>{const e=document.getElementById(t);if(e){let t;t="checkbox"===e.type||"select"===e.tagName.toLowerCase()?"change":"input",e.addEventListener(t,()=>{this.autoSaveSettings()})}})}autoSaveSettings(){this.settings.notificationInterval=parseInt(document.getElementById("notificationInterval").value),this.settings.startTime=document.getElementById("startTime").value,this.settings.endTime=document.getElementById("endTime").value,this.settings.pauseDuration=parseInt(document.getElementById("pauseDuration").value),this.settings.soundMuteMode=document.getElementById("soundMuteMode").value,this.settings.notificationSoundType=document.getElementById("notificationSoundType").value,this.settings.darkModePreference=document.getElementById("darkModePreference").value,this.settings.autoStartAlerts="true"===document.getElementById("autoStartAlerts")?.value,this.settings.paginationSize=parseInt(document.getElementById("paginationSize").value),this.settings.hashtagCloudLimit=parseInt(document.getElementById("hashtagCloudLimit").value),this.settings.pomodoroAutoStart=document.getElementById("pomodoroAutoStart")?.checked||!1,this.settings.pomodoroAutoLog=!1!==document.getElementById("pomodoroAutoLog")?.checked,this.settings.pomodoroLogBreaks=document.getElementById("pomodoroLogBreaks")?.checked||!1,["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(t=>{this.settings.workingDays[t]=document.getElementById(t).checked}),this.applyTheme(),document.getElementById("paginationSize")&&this.updatePaginationSettings(),this.saveSettings(),this.settings.notificationsEnabled&&this.startNotificationTimer(),this.updateDebugInfo(),this.pomodoroManager&&(this.pomodoroManager.saveSettings(),this.pomodoroManager.loadSettings())}initSoundManager(){try{this.soundManager=new SoundManager}catch(t){console.warn("Sound Manager failed to initialise:",t)}}isNotificationSoundMuted(){return"all"===this.settings.soundMuteMode||"notifications"===this.settings.soundMuteMode}isPomodoroSoundMuted(){return"all"===this.settings.soundMuteMode||"pomodoro"===this.settings.soundMuteMode}playNotificationSound(){this.soundManager&&this.soundManager.playSound(this.settings.notificationSoundType,this.isNotificationSoundMuted())}testNotificationSound(){if(this.soundManager){if(this.isNotificationSoundMuted()){let t="Sound is muted because: ";const e=[];return this.settings.muteSound&&e.push("Global sound is disabled in Settings"),this.isOutsideWorkingHours()&&e.push("Currently outside activity hours"),this.pomodoroManager&&this.pomodoroManager.isActive()&&e.push("Pomodoro mode is active"),t+=e.join(", "),void alert(t+"\n\nTo hear test sounds, please adjust your settings or check the time.")}this.soundManager.playSound(this.settings.notificationSoundType,!1),showNotification("Test sound played!","success")}else alert("Sound manager is not available")}addEntry(t){let e,n;if(t&&"object"==typeof t&&t.id?(e=t,n=null):(n=t||"tracker",e=null),e){if("pomodoro"===e.source){const t=this.generatePomodoroHashtags(),n=[...new Set([...e.tags||[],...t])];e.tags=n}}else{let t,i,o,s,a,r;"todo"===n?(t="todoActivity",i="todoDescription",o="todoTimestamp",s="todoDueDate",a=!0,r=!1):"notes"===n?(t="notesActivity",i="notesDescription",o="notesTimestamp",s="notesDueDate",a=!1,r=!0):(t="activity",i="description",o="timestamp",s="dueDate",a=isTodoModeActive(),r=isNoteModeActive());const c=document.getElementById(t).value,d=document.getElementById(i).value,l=document.getElementById(o).value;let u,m;"todo"===n?(m=document.getElementById("todoNoteToggleBtn")?.classList.contains("active")||!1,u=!0):"notes"===n?(u=document.getElementById("notesTodToggleBtn")?.classList.contains("active")||!1,m=!0):(u=a,m=r);const p=document.getElementById(s)?.value||null,h=this.extractHashtags(c+" "+(d||"")),g=this.generatePomodoroHashtags(),y=[...new Set([...h,...g])];e={id:generateId(),activity:c,description:d,timestamp:new Date(l).toISOString(),created:(new Date).toISOString(),isTodo:u,isNote:m,tags:y,dueDate:p?new Date(p).toISOString():null,startedAt:u?new Date(l).toISOString():null}}this.validateDebugModeFlags(e.tags),this.entries.unshift(e),this.saveEntries(),this.displayEntries(),this.displayTodos(),this.displayNotes(),n&&(this.resetFormByContext(n),this.handleReminderTimerReset("add")),showNotification("Entry added successfully!","success")}resetFormByContext(t){if("todo"===t)resetTodoForm();else if("notes"===t)resetNotesForm();else{document.getElementById("activityForm").reset();const t=document.getElementById("todoToggleBtn");t&&(t.classList.remove("active"),t.textContent="Mark as Todo");const e=document.getElementById("noteToggleBtn");e&&(e.classList.remove("active"),e.textContent="Mark as Note"),this.setCurrentTime(),document.getElementById("activity").focus()}}updateEntry(){const t=document.getElementById("editId").value,e=document.getElementById("editActivity").value,n=document.getElementById("editDescription").value,i=document.getElementById("editTimestamp").value,o=document.getElementById("editTodoButton"),s=!!o&&"true"===o.dataset.isTodo,a=document.getElementById("editNoteButton"),r=!!a&&"true"===a.dataset.isNote,c=document.getElementById("editDueDate").value,d=this.entries.findIndex(e=>e.id===t);if(-1!==d){const t=this.entries[d],o=[...this.extractHashtags(e+" "+(n||"")),...this.generatePomodoroHashtags()];this.entries[d]={...t,activity:e,description:n,timestamp:new Date(i).toISOString(),isTodo:s,isNote:r,tags:o,dueDate:c?new Date(c).toISOString():null,startedAt:s?t.startedAt||new Date(i).toISOString():t.startedAt},this.saveEntries(),this.displayEntries(),this.displayTodos(),this.displayNotes(),this.closeEditModal(),this.handleReminderTimerReset("edit"),showNotification("Entry updated successfully!","success")}}deleteEntry(t){const e=this.entries.find(e=>e.id===t);e&&(this.settings.warnOnActivityDelete?showConfirmationDialog("Delete Activity",`Are you sure you want to delete "${e.activity}"? This action can be undone.`,e=>{if(e){this.settings.warnOnActivityDelete=!1;const t=document.getElementById("warnOnActivityDelete");t&&(t.value="false"),this.saveSettings()}this.performDeletion(t)},{confirmText:"Delete",buttonClass:"btn-danger",allowSkip:!0}):this.performDeletion(t))}performDeletion(t){const e=this.entries.find(e=>e.id===t);e&&(this.addToUndoBuffer(e),this.entries=this.entries.filter(e=>e.id!==t),this.saveEntries(),this.displayEntries(),this.displayTodos(),this.displayNotes(),showNotification('Entry deleted successfully! <button onclick="tracker.undoLastDeletion()" class="undo-btn">Undo</button>',"success",5e3))}addToUndoBuffer(t){this.state||(this.state=this.loadState()),this.state.deletedEntriesBuffer||(this.state.deletedEntriesBuffer=[]);const e={...t,deletedAt:(new Date).toISOString()};this.state.deletedEntriesBuffer.unshift(e),this.state.deletedEntriesBuffer.length>5&&(this.state.deletedEntriesBuffer=this.state.deletedEntriesBuffer.slice(0,5)),this.saveState()}undoLastDeletion(){if(this.state||(this.state=this.loadState()),this.state.deletedEntriesBuffer||(this.state.deletedEntriesBuffer=[]),0===this.state.deletedEntriesBuffer.length)return void showNotification("No deletions to undo","info");const t=this.state.deletedEntriesBuffer.shift();delete t.deletedAt,this.entries.find(e=>e.id===t.id)&&(t.id=Date.now().toString()+Math.random().toString(36).substr(2,9)),this.entries.unshift(t),this.saveEntries(),this.displayEntries(),this.displayTodos(),this.displayNotes(),this.saveState(),showNotification(`Restored "${t.activity}"`,"success")}getUndoBuffer(){return this.deletedEntriesBuffer.map(t=>({id:t.id,activity:t.activity,description:t.description,timestamp:t.timestamp,deletedAt:t.deletedAt}))}editEntry(t){const e=this.entries.find(e=>e.id===t);if(e){document.getElementById("editId").value=e.id,document.getElementById("editActivity").value=e.activity;let t=e.description||"";if(e.tags&&e.tags.length>0){const n=e.activity+" "+t,i=this.extractHashtags(n),o=e.tags.filter(t=>!i.includes(t));if(o.length>0){const e=o.map(t=>`#${t}`).join(" ");t=t?`${t} ${e}`:e}}document.getElementById("editDescription").value=t,document.getElementById("editTimestamp").value=new Date(e.timestamp).toISOString().slice(0,16),this.setEditTodoButtonState(e.isTodo||!1),this.setEditNoteButtonState(e.isNote||!1),document.getElementById("editDueDate").value=e.dueDate?new Date(e.dueDate).toISOString().slice(0,16):"",document.getElementById("editModal").style.display="block"}}setEditTodoButtonState(t){const e=document.getElementById("editTodoButton"),n=document.getElementById("editTodoButtonText"),i=document.getElementById("editDueDateSection");e&&n&&(e.dataset.isTodo=t.toString(),t?(e.classList.add("active"),n.textContent="Remove from Todos",i&&(i.style.display="block")):(e.classList.remove("active"),n.textContent="Mark as Todo",i&&(i.style.display="none")))}setEditNoteButtonState(t){const e=document.getElementById("editNoteButton"),n=document.getElementById("editNoteButtonText");e&&n&&(e.dataset.isNote=t.toString(),t?(e.classList.add("active"),n.textContent="Remove from Notes"):(e.classList.remove("active"),n.textContent="Mark as Note"))}closeEditModal(){document.getElementById("editModal").style.display="none"}displayEntries(){const t=document.getElementById("entriesList");this.entriesPagination||(this.entriesPagination={currentPage:1,itemsPerPage:this.settings.paginationSize||20}),this.entriesPagination.itemsPerPage=this.settings.paginationSize||20;const e=this.getSortedEntriesWithOverduePriority(),n=(this.entriesPagination.currentPage-1)*this.entriesPagination.itemsPerPage,i=n+this.entriesPagination.itemsPerPage,o=e.slice(n,i);0!==o.length?(t.innerHTML=o.map(t=>this.renderEntry(t,{showTodoIndicator:!0,showNoteIndicator:!0})).join(""),this.updateEntriesPagination(e.length)):t.innerHTML="<p>No entries yet. Add your first activity above!</p>"}getSortedEntriesWithOverduePriority(){const t=new Date,e=this.entries.filter(e=>e.dueDate&&e.isTodo&&new Date(e.dueDate)<t),n=this.entries.filter(e=>!e.dueDate||!e.isTodo||new Date(e.dueDate)>=t);return[...e.sort((t,e)=>new Date(t.dueDate)-new Date(e.dueDate)),...n]}renderEntry(t,e={}){const{showTodoIndicator:n=!1,showNoteIndicator:i=!1,showCreatedTime:o=!1}=e,s=new Date,a=t.isTodo&&t.dueDate&&new Date(t.dueDate)<s,r=t.isTodo;let c="entry-item";r&&(c+=a?" entry-todo entry-overdue":" entry-todo");let d="";if(t.dueDate&&r&&"function"==typeof formatTimeUntilDue){const e=formatTimeUntilDue(t.dueDate);e&&(d=`<div class="entry-due-date"><span class="due-countdown-badge ${"function"==typeof a&&a(t.dueDate)?"due-badge-overdue":"due-badge-normal"}">${e}</span></div>`)}else t.dueDate&&r&&(d=`<div class="entry-due-date">Due: ${formatDateTime(t.dueDate)}</div>`);const l=o&&t.created?t.created:t.timestamp,u=n&&t.isTodo?'<span class="entry-todo-indicator"> Todo</span>':"",m=i&&t.isNote?'<span class="entry-note-indicator"> Note</span>':"",p=t.description?this.renderDescriptionWithInlineHashtags(t.description,t.tags):"";return`\n            <div class="${c}">\n                <div class="entry-content">\n                    <div class="entry-time">${formatDateTime(l)} ${u}${m}</div>\n                    <div class="entry-activity">${escapeHtml(t.activity)}</div>\n                    ${p?`<div class="entry-description">${p}</div>`:""}\n                    ${d}\n                </div>\n                <div class="entry-actions">\n                    ${t.isTodo?`<button class="btn btn-success btn-small" onclick="tracker.completeEntry('${t.id}')" title="Mark as completed">Mark Complete</button>`:""}\n                    <button class="btn btn-secondary btn-small" onclick="tracker.editEntry('${t.id}')">Edit</button>\n                    <button class="btn btn-danger btn-small" onclick="tracker.deleteEntry('${t.id}')">Delete</button>\n                </div>\n            </div>\n        `}renderDescriptionMarkdown(t){return this.markdownRenderer||void 0===MarkdownRenderer||this.initMarkdownRenderer(),this.markdownRenderer&&t?this.markdownRenderer.renderInlineWithClasses(t):escapeHtml(t)}renderDescriptionWithInlineHashtags(t,e=[]){let n=t;if(e&&e.length>0){const i=this.extractHashtags(t),o=e.filter(t=>!i.includes(t));if(o.length>0){const t=o.map(t=>`#${t}`).join(" ");n=n?`${n} ${t}`:t}}let i=this.renderDescriptionMarkdown(n);return i=i.replace(/(https?:\/\/[^\s<>"\[\]]+)/gi,(t,e)=>`<a href="${e}" target="_blank" rel="noopener noreferrer" class="external-link">${e}</a>`),i=i.replace(/(?<!href="[^"]*|href='[^']*)#([\w][\w-]*)/g,(t,e)=>`<a href="#" class="hashtag-link" onclick="tracker.searchByHashtag('${e}'); return false;">#${e}</a>`),i}saveEntries(){localStorage.setItem("activityEntries",JSON.stringify(this.entries))}saveSettings(){try{this.settings={...this.settings,notificationInterval:parseInt(document.getElementById("notificationInterval").value),startTime:document.getElementById("startTime").value,endTime:document.getElementById("endTime").value,pauseDuration:parseInt(document.getElementById("pauseDuration").value),soundMuteMode:document.getElementById("soundMuteMode").value,notificationSoundType:document.getElementById("notificationSoundType").value,reminderTimerReset:document.getElementById("reminderTimerReset").value,darkModePreference:document.getElementById("darkModePreference").value,autoStartAlerts:"true"===document.getElementById("autoStartAlerts")?.value,hasRequestedNotificationPermission:this.settings.hasRequestedNotificationPermission,sendSystemNotifications:"true"===document.getElementById("sendSystemNotifications")?.value,paginationSize:parseInt(document.getElementById("paginationSize").value),hashtagCloudLimit:parseInt(document.getElementById("hashtagCloudLimit").value),warnOnActivityDelete:"true"===document.getElementById("warnOnActivityDelete")?.value,warnOnSessionReset:"true"===document.getElementById("warnOnSessionReset")?.value,workingDays:{monday:document.getElementById("monday").checked,tuesday:document.getElementById("tuesday").checked,wednesday:document.getElementById("wednesday").checked,thursday:document.getElementById("thursday").checked,friday:document.getElementById("friday").checked,saturday:document.getElementById("saturday").checked,sunday:document.getElementById("sunday").checked},pomodoroEnabled:document.getElementById("pomodoroEnabled")?.checked||!1,pomodoroWorkDuration:parseInt(document.getElementById("pomodoroWorkDuration")?.value)||25,pomodoroBreakDuration:parseInt(document.getElementById("pomodoroBreakDuration")?.value)||5,pomodoroAutoStart:document.getElementById("pomodoroAutoStart")?.checked||!1,pomodoroAutoLog:!1!==document.getElementById("pomodoroAutoLog")?.checked,pomodoroLogBreaks:document.getElementById("pomodoroLogBreaks")?.checked||!1,pomodoroLongBreak:document.getElementById("pomodoroLongBreak")?.checked||!1,pomodoroPauseAllowed:!1!==document.getElementById("pomodoroPauseAllowed")?.checked},localStorage.setItem("activitySettings",JSON.stringify(this.settings)),this.applyTheme(),this.startNotificationTimer(),this.pomodoroManager&&(this.pomodoroManager.saveSettings(),this.pomodoroManager.loadSettings()),this.pauseManager&&this.pauseManager.updatePauseButtonDisplay(),this.templateManagerState&&this.templateManagerState.hasUnsavedChanges&&this.saveTemplatesQuietly(),this.updatePaginationSettings()}catch(t){console.error("Error saving settings:",t),showNotification("Failed to save settings. Please try again.","error")}}checkNotificationSetup(){!this.settings.hasRequestedNotificationPermission&&this.isNotificationSupported()?setTimeout(()=>{this.showNotificationPermissionDialog()},1e3):this.updateSystemNotificationsVisibility()}isNotificationSupported(){if("file:"===window.location.protocol)return!1;if(!("Notification"in window))return!1;const t=navigator.userAgent.toLowerCase();return!(/iphone|ipad|ipod/.test(t)&&/safari/.test(t)&&!/chrome|crios|fxios/.test(t))}showNotificationPermissionDialog(){const t=document.getElementById("notificationPermissionModal");t&&(t.style.display="block")}async requestNotificationPermission(){try{const t=await Notification.requestPermission();this.settings.hasRequestedNotificationPermission=!0,"granted"===t?(this.settings.sendSystemNotifications=!0,showNotification("System notifications enabled! You'll receive reminders through your operating system.","success")):(this.settings.sendSystemNotifications=!1,showNotification("System notifications disabled. You'll still receive sound alerts within the app.","info")),this.saveSettings(),this.updateSystemNotificationsVisibility(),this.closeNotificationPermissionDialog()}catch(t){console.error("Error requesting notification permission:",t),this.declineNotificationPermission()}}declineNotificationPermission(){this.settings.hasRequestedNotificationPermission=!0,this.settings.sendSystemNotifications=!1,this.saveSettings(),this.updateSystemNotificationsVisibility(),this.closeNotificationPermissionDialog(),showNotification("Sound alerts enabled. You can enable system notifications later in General Settings.","info")}closeNotificationPermissionDialog(){const t=document.getElementById("notificationPermissionModal");t&&(t.style.display="none")}updateSystemNotificationsVisibility(){const t=document.getElementById("systemNotificationsGroup");t&&(this.settings.hasRequestedNotificationPermission&&this.isNotificationSupported()?t.style.display="block":t.style.display="none")}forceEnableNotificationCapability(){this.settings.hasRequestedNotificationPermission=!1,this.saveSettings(),this.showNotificationPermissionDialog()}toggleActivityReminders(){this.settings.notificationsEnabled?(this.settings.notificationsEnabled=!1,this.stopNotificationTimer(),showNotification("Activity reminders turned off","info")):(this.settings.notificationsEnabled=!0,this.startNotificationTimer(),showNotification("Activity reminders turned on","success")),this.saveSettings(),this.updateNotificationStatus(),this.updatePauseButtonState()}loadState(){try{const t=localStorage.getItem("activityState");if(t)return JSON.parse(t)}catch(t){console.warn("Error loading state from localStorage:",t)}return{deletedEntriesBuffer:[],pomodoro:{isRunning:!1,isPaused:!1,currentPhase:null,sessionNumber:0,startTime:null,originalDuration:null,remainingTime:null,pausedAt:null,workActivity:null,cycleCount:0,totalSessions:0},currentActivity:{name:"",description:"",startTime:null,tags:[]},todos:{currentTodo:null,completedSinceLastLog:[]},timestamp:Date.now()}}saveState(){this.state.timestamp=Date.now(),localStorage.setItem("activityState",JSON.stringify(this.state))}clearState(){localStorage.removeItem("activityState"),this.state=this.loadState()}updatePomodoroState(t){this.state.pomodoro={...this.state.pomodoro,...t},this.saveState()}updatePaginationSettings(){const t=this.settings.paginationSize||20;this.entriesPagination&&(this.entriesPagination.itemsPerPage=t,this.entriesPagination.currentPage=1),this.todoPagination&&(this.todoPagination.itemsPerPage=t,this.todoPagination.currentPage=1),this.notesPagination&&(this.notesPagination.itemsPerPage=t,this.notesPagination.currentPage=1),this.searchState&&this.searchState.searchPagination&&(this.searchState.searchPagination.itemsPerPage=t,this.searchState.searchPagination.currentPage=1),this.displayEntries(),this.displayTodos(),this.displayNotes(),this.searchState&&this.searchState.currentQuery&&this.performSearch(this.searchState.currentQuery)}loadSettings(){document.getElementById("notificationInterval").value=this.settings.notificationInterval,document.getElementById("startTime").value=this.settings.startTime,document.getElementById("endTime").value=this.settings.endTime,document.getElementById("pauseDuration").value=this.settings.pauseDuration,document.getElementById("soundMuteMode").value=this.settings.soundMuteMode,document.getElementById("darkModePreference").value=this.settings.darkModePreference,document.getElementById("autoStartAlerts").value=this.settings.autoStartAlerts.toString(),document.getElementById("paginationSize").value=this.settings.paginationSize,document.getElementById("hashtagCloudLimit").value=this.settings.hashtagCloudLimit,document.getElementById("sendSystemNotifications").value=this.settings.sendSystemNotifications.toString(),document.getElementById("warnOnActivityDelete").value=this.settings.warnOnActivityDelete.toString(),document.getElementById("warnOnSessionReset").value=this.settings.warnOnSessionReset.toString(),document.getElementById("reminderTimerReset").value=this.settings.reminderTimerReset,this.populateSoundDropdowns(),Object.entries(this.settings.workingDays).forEach(([t,e])=>{document.getElementById(t).checked=e});const t=document.getElementById("useComplexSchedule");if(t&&(t.checked=this.settings.useComplexSchedule||!1,"function"==typeof toggleScheduleMode)){const t=document.getElementById("simpleSchedule"),e=document.getElementById("complexSchedule");this.settings.useComplexSchedule?(t&&(t.style.display="none"),e&&(e.style.display="block"),"function"==typeof populateComplexSchedule&&populateComplexSchedule()):(t&&(t.style.display="block"),e&&(e.style.display="none"))}this.updateSystemNotificationsVisibility(),this.applyTheme()}populateSoundDropdowns(){[{id:"notificationSoundType",selectedValue:this.settings.notificationSoundType},{id:"pomodoroShortBreakSound",selectedValue:this.settings.pomodoroShortBreakSound||"gentle"},{id:"pomodoroLongBreakSound",selectedValue:this.settings.pomodoroLongBreakSound||"bell"},{id:"pomodoroResumeSound",selectedValue:this.settings.pomodoroResumeSound||"digital"}].forEach(({id:t,selectedValue:e})=>{const n=document.getElementById(t);n&&"function"==typeof generateSoundOptions&&(n.innerHTML=generateSoundOptions([],e))})}applyTheme(){let t=!1;switch(this.settings.darkModePreference){case"dark":t=!0;break;case"light":default:t=!1;break;case"system":t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),"system"===this.settings.darkModePreference&&(this.systemThemeListener||(this.systemThemeListener=t=>{"system"===this.settings.darkModePreference&&this.applyTheme()},window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",this.systemThemeListener)))}async enableNotifications(){if(!("Notification"in window)||!("serviceWorker"in navigator))return alert("This browser does not support notifications or service workers."),void this.updateDebugInfo();if(this.settings.notificationsEnabled&&"granted"===Notification.permission)return this.settings.notificationsEnabled=!1,this.saveSettings(),this.stopNotificationTimer(),showNotification("Notifications disabled","success"),this.updateNotificationStatus(),void this.updateDebugInfo();try{const t=await Notification.requestPermission();"granted"===t?(this.settings.notificationsEnabled=!0,this.saveSettings(),showNotification("Notifications enabled successfully!","success"),this.startNotificationTimer(),setTimeout(()=>{this.testNotification(!0)},1e3)):showNotification("denied"===t?"Notifications were denied. Please check your browser settings and try again.":"Notification permission was not granted. Please try again.","error"),setTimeout(()=>{this.updateNotificationStatus(),this.updateDebugInfo()},500)}catch(t){console.error("Error requesting notification permission:",t),showNotification("Error requesting notification permission: "+t.message,"error"),this.updateDebugInfo()}}async showNotificationWithServiceWorker(t,e){if("Notification"in window){if(this.settings.sendSystemNotifications)if("granted"===Notification.permission){try{if("serviceWorker"in navigator){const n=await navigator.serviceWorker.ready;return void await n.showNotification(t,e)}}catch(t){console.warn("Service Worker notification failed, falling back to direct notification:",t)}try{const n={body:e.body,icon:e.icon,tag:e.tag,requireInteraction:e.requireInteraction},i=new Notification(t,n);i.onclick=()=>{window.focus(),i.close()},e.requireInteraction||setTimeout(()=>{i.close()},5e3)}catch(t){console.error("Both Service Worker and direct notification failed:",t),showNotification("Activity reminder: "+(e.body||"Time to log your activity!"),"info",8e3)}}else console.warn("Notification permission not granted")}else console.warn("Notifications not supported")}testNotification(t=!1){if("undefined"==typeof Notification)return t||showNotification("This browser does not support notifications.","error"),this.playNotificationSound(),void this.updateDebugInfo();if(this.updateDebugInfo(),"granted"===Notification.permission)try{this.showActivityReminderNotification(),t||showNotification("Test notification sent successfully!","success")}catch(t){console.error("Error creating test notification:",t),showNotification("Error creating test notification: "+t.message,"error"),this.updateDebugInfo()}else t||showNotification("Please enable notifications first! Current permission: "+Notification.permission,"error")}refreshNotificationStatus(){this.updateNotificationStatus(),this.updateDebugInfo(),showNotification("Notification status refreshed","success")}updateNotificationStatus(){const t=document.getElementById("notificationStatus"),e=document.getElementById("statusIndicator"),n=document.getElementById("statusText"),i=document.querySelector('button[onclick="enableNotifications()"]');this.settings.notificationsEnabled?(t.className="notification-status notification-enabled",e.className="status-indicator status-active",this.settings.hasRequestedNotificationPermission&&this.settings.sendSystemNotifications&&"granted"===Notification.permission?n.textContent="Activity reminders active with system notifications":n.textContent="Activity reminders active with sound alerts",i&&(i.textContent="Turn off activity reminders")):(t.className="notification-status notification-warning",e.className="status-indicator status-inactive",n.textContent="Activity reminders are disabled",i&&(i.textContent="Turn on activity reminders")),this.isNotificationSupported()||(this.settings.notificationsEnabled?n.textContent="Activity reminders active with sound alerts only":n.textContent="Activity reminders are disabled")}showReminderBanner(){const t=document.getElementById("statusBanner"),e=document.getElementById("reminderStatusSection");if(t&&e&&this.settings.notificationsEnabled)if(this.shouldShowReminderCountdown())t.style.display="block",e.style.display="flex";else{e.style.display="none";const n=document.getElementById("pomodoroStatusSection");n&&"none"===n.style.display&&(t.style.display="none")}}getNextWorkingTime(t){const e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n=60*t.getHours()+t.getMinutes(),i=e[t.getDay()];if(this.settings.workingDays[i])if(this.settings.useComplexSchedule&&this.settings.complexSchedule&&this.settings.complexSchedule[i]){const e=this.settings.complexSchedule[i];for(const i of e){const[e,o]=i.start.split(":").map(Number);if(60*e+o>n){const n=new Date(t);return n.setHours(e,o,0,0),n}}}else{const[e,i]=this.settings.startTime.split(":").map(Number);if(60*e+i>n){const n=new Date(t);return n.setHours(e,i,0,0),n}}for(let n=1;n<=7;n++){const i=new Date(t);i.setDate(i.getDate()+n),i.setHours(0,0,0,0);const o=e[i.getDay()];if(this.settings.workingDays[o]){if(!(this.settings.useComplexSchedule&&this.settings.complexSchedule&&this.settings.complexSchedule[o])){const[t,e]=this.settings.startTime.split(":").map(Number);return i.setHours(t,e,0,0),i}{const t=this.settings.complexSchedule[o];if(t.length>0){const[e,n]=t[0].start.split(":").map(Number);return i.setHours(e,n,0,0),i}}}}return null}isWithinWorkingHours(t=new Date){const e=60*t.getHours()+t.getMinutes(),n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()];if(!this.settings.workingDays[n])return!1;if(this.settings.useComplexSchedule&&this.settings.complexSchedule&&this.settings.complexSchedule[n]){const t=this.settings.complexSchedule[n];return!(!t||0===t.length)&&t.some(t=>{const[n,i]=t.start.split(":").map(Number),[o,s]=t.end.split(":").map(Number);return e>=60*n+i&&e<=60*o+s})}{const[t,n]=this.settings.startTime.split(":").map(Number),[i,o]=this.settings.endTime.split(":").map(Number);return e>=60*t+n&&e<=60*i+o}}shouldShowReminderCountdown(){if(!this.settings.notificationsEnabled)return!1;if(this.settings.notificationsPausedUntil&&(new Date).getTime()<this.settings.notificationsPausedUntil)return!0;const t=new Date,e=60*t.getHours()+t.getMinutes(),n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()];if(!this.settings.workingDays[n])return!1;if(this.isWithinWorkingHours(t))return!0;if(!this.settings.useComplexSchedule){const[t,n]=this.settings.startTime.split(":").map(Number),i=60*t+n;return e<i&&i-e<=120}return!1}hideReminderBanner(){const t=document.getElementById("reminderStatusSection");t&&(t.style.display="none");const e=document.getElementById("pomodoroStatusSection"),n=document.getElementById("statusBanner");n&&e&&"none"===t.style.display&&"none"===e.style.display&&(n.style.display="none")}startNotificationCountdown(){this.notificationCountdownTimer&&clearInterval(this.notificationCountdownTimer),this.showReminderBanner(),this.updateNotificationCountdown(),this.notificationCountdownTimer=setInterval(()=>{this.showReminderBanner(),this.updateNotificationCountdown(),this.pauseManager&&this.pauseManager.updatePauseButtonDisplay()},1e3)}updateNotificationCountdown(){const t=document.getElementById("reminderTimeRemaining");if(!t||!this.settings.notificationsEnabled)return;if(this.settings.notificationsPausedUntil&&(new Date).getTime()<this.settings.notificationsPausedUntil)return void(t.textContent="Paused");const e=new Date,n=(e.getHours(),e.getMinutes(),["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()]);if(!this.settings.workingDays[n])return void(t.textContent="Not working day");if(this.isWithinWorkingHours(e)){if(this.notificationTimer){const n=localStorage.getItem("lastNotificationTime"),i=60*this.settings.notificationInterval*1e3;if(!n||i<=0)return void(t.textContent="Ready for reminder");const o=i-(e.getTime()-parseInt(n));if(o<=0)return void(t.textContent="Ready for reminder");const s=Math.ceil(o/1e3),a=Math.floor(s/3600),r=Math.floor(s%3600/60),c=s%60;let d;d=a>0?`${a}h ${r}m ${c}s`:r>0?`${r}m ${c}s`:`${c}s`,t.textContent=d}else t.textContent="Ready to start";return}const i=this.getNextWorkingTime(e);if(i){const n=Math.ceil((i-e)/6e4),o=Math.floor(n/60),s=n%60;if(n<60)t.textContent=`Work starts in ${n}m`;else if(o<24)t.textContent=`Work starts in ${o}h ${s}m`;else{const e=Math.floor(o/24);t.textContent=`Next work day in ${e} day${1!==e?"s":""}`}}else t.textContent="No activity days scheduled"}updateDebugInfo(){const t=document.getElementById("debugText");if(!t)return;const e=[];e.push(`Version: ${APP_VERSION}`),e.push(""),e.push(`Browser: ${navigator.userAgent.split(" ").slice(-2).join(" ")}`),e.push(`Platform: ${navigator.platform||"Unknown"}`),e.push(`Protocol: ${window.location.protocol}`),e.push("Notification API: "+("Notification"in window?"Available":"Not Available")),"Notification"in window&&(e.push(`Permission: ${Notification.permission}`),e.push(`Max Actions: ${Notification.maxActions||"Unknown"}`)),"serviceWorker"in navigator?(e.push("Service Worker: Available"),navigator.serviceWorker.controller?(e.push(`SW State: ${navigator.serviceWorker.controller.state}`),e.push(`SW URL: ${navigator.serviceWorker.controller.scriptURL.split("/").pop()}`)):e.push("SW State: No controller"),navigator.serviceWorker.getRegistration().then(t=>{if(t){const e=document.getElementById("debugText");e&&e.innerHTML.includes("SW Scope: Checking...")&&(e.innerHTML=e.innerHTML.replace("SW Scope: Checking...",`SW Scope: ${t.scope}`))}}).catch(t=>{console.warn("SW registration check failed:",t)}),e.push("SW Scope: Checking...")):(e.push("Service Worker: Not Available"),"file:"===window.location.protocol&&e.push("SW Reason: file:// protocol (expected)")),e.push("Audio Support: "+(this.soundManager&&this.soundManager.audioContext?"Yes":"No")),e.push(`Sound Settings: ${"none"===this.settings.soundMuteMode?"All enabled":this.settings.soundMuteMode}`),e.push(`Sound Type: ${this.settings.notificationSoundType}`),e.push(`Last Updated: ${(new Date).toLocaleTimeString("en-GB")}`),t.innerHTML=e.join("<br>")}updateVersionHistory(){const t=document.getElementById("versionHistoryContainer");t&&(void 0!==window.VersionHistory?t.innerHTML=window.VersionHistory.formatVersionHistory():t.innerHTML="<p>Version history not available.</p>")}async updateAboutDebugInfo(){this.updateVersionHistory();const t=document.getElementById("aboutDebugInfo");if(!t)return;const e=[];if(e.push(`<strong>Version:</strong> ${APP_VERSION}`),e.push(""),e.push(`<strong>Browser:</strong> ${navigator.userAgent.split(" ").slice(-2).join(" ")}`),e.push(`<strong>Platform:</strong> ${navigator.platform||"Unknown"}`),e.push(`<strong>Protocol:</strong> ${window.location.protocol}`),e.push(""),e.push("<strong>Notification API:</strong> "+("Notification"in window?"Available":"Not Available")),"Notification"in window&&(e.push(`<strong>Permission:</strong> ${Notification.permission}`),e.push(`<strong>Max Actions:</strong> ${Notification.maxActions||"Unknown"}`)),e.push(""),"serviceWorker"in navigator){e.push("<strong>Service Worker:</strong> Available"),navigator.serviceWorker.controller?(e.push(`<strong>SW State:</strong> ${navigator.serviceWorker.controller.state}`),e.push(`<strong>SW URL:</strong> ${navigator.serviceWorker.controller.scriptURL.split("/").pop()}`)):e.push("<strong>SW State:</strong> No controller");try{const t=await navigator.serviceWorker.getRegistration();t?e.push(`<strong>SW Scope:</strong> ${t.scope}`):e.push("<strong>SW Scope:</strong> No registration")}catch(t){console.warn("SW registration check failed:",t),e.push("<strong>SW Scope:</strong> Check failed")}}else e.push("<strong>Service Worker:</strong> Not Available"),"file:"===window.location.protocol&&e.push("<strong>SW Reason:</strong> file:// protocol (expected)");e.push(""),e.push("<strong>Audio Support:</strong> "+(this.soundManager&&this.soundManager.audioContext?"Yes":"No")),e.push(`<strong>Sound Settings:</strong> ${"none"===this.settings.soundMuteMode?"All enabled":this.settings.soundMuteMode}`),e.push(`<strong>Sound Type:</strong> ${this.settings.notificationSoundType}`),e.push(`<strong>Last Updated:</strong> ${(new Date).toLocaleTimeString("en-GB")}`),t.innerHTML=e.join("<br>")}async runServiceWorkerDiagnostics(){const t={available:"serviceWorker"in navigator,protocol:window.location.protocol,userAgent:navigator.userAgent,platform:navigator.platform,registration:null,controller:null,error:null,comprehensive:null};if(!t.available)return t.error="Service Worker API not available",t;try{if(t.registration=await navigator.serviceWorker.getRegistration(),t.controller=navigator.serviceWorker.controller,t.controller)try{const e=new MessageChannel,n=await new Promise((n,i)=>{const o=setTimeout(()=>i(new Error("SW communication timeout")),5e3);e.port1.onmessage=t=>{clearTimeout(o),n(t.data)},t.controller.postMessage({type:"GET_VERSION"},[e.port2])});t.communication="Working",t.swVersion=n.version;const i=new MessageChannel,o=await new Promise((e,n)=>{const o=setTimeout(()=>n(new Error("SW diagnostics timeout")),1e4);i.port1.onmessage=t=>{clearTimeout(o),e(t.data)},t.controller.postMessage({type:"GET_DIAGNOSTICS"},[i.port2])});t.comprehensive=o}catch(e){t.communication=`Failed: ${e.message}`}}catch(e){t.error=e.message}return t}startNotificationTimer(){this.notificationTimer&&clearInterval(this.notificationTimer),this.notificationCountdownTimer&&clearInterval(this.notificationCountdownTimer),this.notificationTimer=setInterval(()=>{this.checkAndTriggerActivityReminder()},6e4),this.startNotificationCountdown(),this.showReminderBanner()}stopNotificationTimer(){this.notificationTimer&&(clearInterval(this.notificationTimer),this.notificationTimer=null),this.notificationCountdownTimer&&(clearInterval(this.notificationCountdownTimer),this.notificationCountdownTimer=null),this.hideReminderBanner()}handleReminderTimerReset(t){const e=this.settings.reminderTimerReset;"never"!==e&&("on_add"===e&&"add"===t?this.resetReminderTimer():"on_add_edit"!==e||"add"!==t&&"edit"!==t||this.resetReminderTimer())}resetReminderTimer(){if(this.notificationTimer){const t=new Date;localStorage.setItem("lastNotificationTime",t.getTime().toString())}}checkAndTriggerActivityReminder(){if(!this.settings.notificationsEnabled)return;if(this.settings.notificationsPausedUntil){if((new Date).getTime()<this.settings.notificationsPausedUntil)return;this.unpauseNotifications(!1)}const t=new Date,e=(t.getHours(),t.getMinutes(),["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()]);if(!this.settings.workingDays[e])return;if(!this.isWithinWorkingHours(t))return;const n=localStorage.getItem("lastNotificationTime"),i=t.getTime()-(n||0),o=60*this.settings.notificationInterval*1e3;o>0&&i>=o&&(this.playNotificationSound(),"undefined"!=typeof Notification&&"granted"===Notification.permission&&this.showActivityReminderNotification(),localStorage.setItem("lastNotificationTime",t.getTime().toString()))}showActivityReminderNotification(){this.setCurrentTime();try{const t={body:"What are you working on right now?",icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23667eea"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"activity-reminder",requireInteraction:!0,actions:[{action:"reply",type:"text",title:"Quick Log",placeholder:"What are you working on?"},{action:"open",title:"Open App"}]};this.showNotificationWithServiceWorker("Activity Tracker Reminder",t)}catch(t){console.error("Error showing activity reminder notification:",t)}}setCurrentTime(){const t=document.getElementById("timestamp");t&&(t.value=getCurrentTimeForInput())}initPomodoroManager(){void 0!==PomodoroManager?(this.pomodoroManager=new PomodoroManager(this),this.state.pomodoro&&this.pomodoroManager.restoreFromState(this.state.pomodoro)):console.warn("PomodoroManager class not found")}togglePause(t=!0){this.pauseManager?this.pauseManager.isPaused()?this.pauseManager.resume():this.pauseManager.startPause(this.settings.pauseDuration):(this.settings.notificationsEnabled?(this.settings.notificationsEnabled=!1,this.stopNotificationTimer(),t&&showNotification("Reminders stopped","info")):(this.settings.notificationsEnabled=!0,this.startNotificationTimer(),t&&showNotification("Reminders started","success")),this.updatePauseButtonState(),this.saveSettings(),this.updateNotificationStatus(),this.updateDebugInfo())}unpauseNotifications(t=!0){this.settings.notificationsPausedUntil=null,t&&showNotification("Notifications resumed","success"),this.updatePauseButtonState(),this.saveSettings()}updatePauseButtonState(){this.pauseManager&&this.pauseManager.updatePauseButtonDisplay()}clearAllData(){confirm("Are you sure you want to clear all data? This cannot be undone.")&&(localStorage.removeItem("activityEntries"),localStorage.removeItem("activitySettings"),localStorage.removeItem("lastNotificationTime"),this.entries=[],this.currentReportEntries=[],this.displayEntries(),document.getElementById("reportPreview").innerHTML="",showNotification("All data cleared successfully!","success"))}exportDatabase(){try{this.exportAllWorkspaces(),showNotification("All workspaces exported successfully!","success")}catch(t){console.error("Error exporting database:",t),showNotification("Error exporting database: "+t.message,"error")}}importDatabase(t){try{const e=JSON.parse(t);if(e.workspaces&&"object"==typeof e.workspaces)return this.importAllWorkspaces(e);if(e.entries&&Array.isArray(e.entries))return this.importLegacyDatabase(e);throw new Error("Invalid backup file: missing or invalid backup data structure")}catch(t){console.error("Error importing database:",t),showNotification("Error importing database: "+t.message,"error")}}importLegacyDatabase(t){const e=t.entries.length,n=t.timestamp?new Date(t.timestamp).toLocaleDateString("en-GB"):"unknown date";if(!confirm(`Import ${e} entries from legacy backup created on ${n}? This will replace current workspace data.`))return;const i=t.entries.filter(t=>t&&"object"==typeof t&&t.timestamp);i.length!==t.entries.length&&console.warn(`Filtered out ${t.entries.length-i.length} invalid entries`),this.entries=i,localStorage.setItem("activityEntries",JSON.stringify(this.entries)),t.settings&&"object"==typeof t.settings&&(this.settings={...this.settings,...t.settings},localStorage.setItem("activitySettings",JSON.stringify(this.settings)),this.loadSettings()),t.state&&"object"==typeof t.state&&(this.state={...this.state,...t.state},localStorage.setItem("activityState",JSON.stringify(this.state))),this.displayEntries(),this.currentReportEntries=[],document.getElementById("reportPreview").innerHTML="",showNotification(`Database imported successfully! Restored ${i.length} entries.`,"success")}importAllWorkspaces(t){let e=0;const n=Object.keys(t.workspaces||{});n.forEach(n=>{const i=t.workspaces[n];if(i&&i.data&&i.data.activityEntries&&Array.isArray(i.data.activityEntries)){const t=i.data.activityEntries.length;e+=t}else console.warn(`Workspace "${n}" has invalid structure or no entries`)});const i=t.exportDate?new Date(t.exportDate).toLocaleDateString("en-GB"):"unknown date";if(!confirm(`Import ${e} entries from ${n.length} workspace${1!==n.length?"s":""} (${n.join(", ")}) from backup created on ${i}? This will replace all current data.`))return;this.saveCurrentWorkspaceData(this.currentWorkspace),localStorage.setItem("workspaces",JSON.stringify(t.workspaces));const o=t.currentWorkspace||this.currentWorkspace||"Default";this.currentWorkspace=o,localStorage.setItem("currentWorkspace",o),this.loadWorkspaceData(o),this.updateHeaderWorkspaceName(),this.displayEntries(),this.currentReportEntries=[],document.getElementById("reportPreview").innerHTML="",showNotification(`All workspaces imported successfully! Restored ${e} entries across ${n.length} workspace${1!==n.length?"s":""}.`,"success")}initTemplatePreviewGrid(){}openTemplateManager(){this.templateManagerState={templates:{...this.getReportTemplates()},currentTemplateId:null,hasUnsavedChanges:!1,originalTemplates:{...this.getReportTemplates()}};const t=document.getElementById("templateManagerOverlay");t&&(t.classList.add("active"),this.populateTemplateList(),this.clearTemplateEditor())}closeTemplateManager(){if(this.templateManagerState&&this.templateManagerState.hasUnsavedChanges&&!confirm("You have unsaved changes. Are you sure you want to close without saving?"))return;const t=document.getElementById("templateManagerOverlay");t&&t.classList.remove("active"),this.templateManagerState=null}populateTemplateList(){const t=document.getElementById("templateList");if(!t||!this.templateManagerState)return;const e=this.templateManagerState.templates,n=this.settings.defaultTemplate||"detailed-html";t.innerHTML="",Object.keys(e).forEach(i=>{const o=e[i],s=i===n,a=i===this.templateManagerState.currentTemplateId,r=document.createElement("div");r.className=`template-list-item ${a?"active":""} ${s?"default":""}`,r.onclick=()=>this.selectTemplate(i),r.innerHTML=`\n                <div class="template-list-item-name">${o.name}</div>\n                <div class="template-list-item-desc">${o.description}</div>\n                <div class="template-list-item-type">${o.type}</div>\n            `,t.appendChild(r)})}selectTemplate(t){this.templateManagerState&&this.templateManagerState.hasUnsavedChanges&&!confirm("You have unsaved changes. Continue without saving?")||(this.templateManagerState.currentTemplateId=t,this.templateManagerState.hasUnsavedChanges=!1,this.populateTemplateList(),this.loadTemplateIntoEditor(t),this.refreshTemplatePreview())}loadTemplateIntoEditor(t){const e=this.templateManagerState.templates[t];if(!e)return;document.getElementById("templateEditorTitle").textContent=`Editing: ${e.name}`,document.getElementById("templateEditorActions").style.display="flex",document.getElementById("templateEditorTabs").style.display="flex",this.switchTemplateTab("editor"),document.getElementById("templateName").value=e.name,document.getElementById("templateDescription").value=e.description,document.getElementById("templateType").value=e.type,document.getElementById("templateContent").value=e.template;const n=this.settings.defaultTemplate||"detailed-html";document.getElementById("templateIsDefault").checked=t===n,["templateName","templateDescription","templateType","templateContent","templateIsDefault"].forEach(t=>{const e=document.getElementById(t);e&&e.addEventListener("input",()=>{this.templateManagerState.hasUnsavedChanges=!0})})}clearTemplateEditor(){document.getElementById("templateEditorTitle").textContent="Select a template to edit",document.getElementById("templateEditorActions").style.display="none",document.getElementById("templateEditorTabs").style.display="none",document.getElementById("templateEditorForm").style.display="none",document.getElementById("templatePreviewPanel").style.display="none",document.getElementById("templatePreviewContent").innerHTML='<p class="template-preview-placeholder">Select a template to see preview</p>'}addNewTemplate(){const t="custom-"+Date.now();this.templateManagerState.templates[t]={name:"New Template",description:"Custom template",type:"html",template:"# {{report.startDate}} - {{report.endDate}}\n\n{{#each entry = entries}}\n- {{entry.activity}}\n{{/each}}"},this.templateManagerState.hasUnsavedChanges=!0,this.populateTemplateList(),this.selectTemplate(t)}saveCurrentTemplate(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=document.getElementById("templateName").value.trim(),n=document.getElementById("templateDescription").value.trim(),i=document.getElementById("templateType").value,o=document.getElementById("templateContent").value,s=document.getElementById("templateIsDefault").checked;e&&o?(this.templateManagerState.templates[t]={name:e,description:n,type:i,template:o},s?this.settings.defaultTemplate=t:this.settings.defaultTemplate===t&&(this.settings.defaultTemplate="detailed-html"),this.templateManagerState.hasUnsavedChanges=!1,this.populateTemplateList(),this.refreshTemplatePreview(),showNotification("Template saved","success")):showNotification("Template name and content are required","error")}deleteCurrentTemplate(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=this.templateManagerState.templates[t];confirm(`Delete template "${e.name}"? This cannot be undone.`)&&(window.ReportTemplates&&window.ReportTemplates[t]?showNotification("Cannot delete default templates","error"):(delete this.templateManagerState.templates[t],this.settings.defaultTemplate===t&&(this.settings.defaultTemplate="detailed-html"),this.templateManagerState.hasUnsavedChanges=!0,this.templateManagerState.currentTemplateId=null,this.populateTemplateList(),this.clearTemplateEditor(),showNotification("Template deleted","success")))}duplicateCurrentTemplate(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=this.templateManagerState.templates[t],n="custom-"+Date.now(),i={name:e.name+" (Copy)",description:e.description,type:e.type,template:e.template};this.templateManagerState.templates[n]=i,this.templateManagerState.hasUnsavedChanges=!0,this.populateTemplateList(),this.selectTemplate(n),showNotification("Template duplicated","success")}resetToDefaults(){confirm("Reset all templates to defaults? This will delete all custom templates.")&&(this.templateManagerState.templates={...window.ReportTemplates},this.settings.defaultTemplate="detailed-html",this.templateManagerState.hasUnsavedChanges=!0,this.templateManagerState.currentTemplateId=null,this.populateTemplateList(),this.clearTemplateEditor(),showNotification("Templates reset to defaults","success"))}generateTestData(){const t=new Date,e=new Date(t.getTime()-6048e5),n=t,i=new Date(e),o=new Date(e.getTime()+864e5),s=new Date(e.getTime()+1728e5),a=[{id:"1",timestamp:i.toISOString(),activity:"Planning project roadmap",description:"Defined key milestones and deliverables for Q3",duration:45,endTime:new Date(i.getTime()+27e5).toISOString()},{id:"2",timestamp:new Date(i.getTime()+72e5).toISOString(),activity:"Team standup meeting",description:"Discussed progress and blocked items",duration:30,endTime:new Date(i.getTime()+72e5+18e5).toISOString()}],r=[{id:"3",timestamp:o.toISOString(),activity:"Code review",description:"Reviewed pull requests for **authentication module**",duration:60,endTime:new Date(o.getTime()+36e5).toISOString()}],c=[{id:"4",timestamp:s.toISOString(),activity:"Documentation update",description:"Updated API documentation with new endpoints",duration:90,endTime:new Date(s.getTime()+54e5).toISOString()}],d=[...a,...r,...c],l=d.reduce((t,e)=>t+e.duration,0);return{report:{startDate:e.toISOString(),endDate:n.toISOString(),totalEntries:d.length,totalDuration:l,activeDays:3},entries:d,days:[{date:i.toDateString(),entries:a,totalDuration:a.reduce((t,e)=>t+e.duration,0)},{date:o.toDateString(),entries:r,totalDuration:r.reduce((t,e)=>t+e.duration,0)},{date:s.toDateString(),entries:c,totalDuration:c.reduce((t,e)=>t+e.duration,0)}]}}refreshTemplatePreview(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=this.templateManagerState.templates[t],n=document.getElementById("templatePreviewContent");if(!e||!n)return;const i=document.getElementById("templateContent"),o={...e,template:i?i.value:e.template},s=document.getElementById("previewTabRendered"),a=s&&s.classList.contains("active");try{const t=this.generateTestData();this.templatingEngine||(this.templatingEngine=new TemplatingEngine);const e=this.templatingEngine.render(o.template,t);if(a){if("html"===o.type){const t=document.createElement("iframe");return t.style.width="100%",t.style.height="400px",t.style.border="none",t.style.borderRadius="4px",n.innerHTML="",n.appendChild(t),t.contentDocument.open(),t.contentDocument.write(e),void t.contentDocument.close()}if("markdown"===o.type&&this.markdownRenderer){const t=this.markdownRenderer.render(e);return void(n.innerHTML=`<div class="markdown-preview">${t}</div>`)}n.innerHTML=`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${this.escapeHtml(e)}</pre>`}else n.innerHTML=`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${this.escapeHtml(e)}</pre>`}catch(t){n.innerHTML=`<div style="color: #e53e3e; padding: 20px; text-align: center;">\n                <strong>Error generating preview:</strong><br>\n                <code style="background: #fed7d7; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 8px;">${t.message}</code>\n            </div>`}}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}switchPreviewTab(t){document.getElementById("previewTabRendered").classList.toggle("active","rendered"===t),document.getElementById("previewTabSource").classList.toggle("active","source"===t),this.refreshTemplatePreview()}switchReportPreviewTab(t){document.getElementById("reportPreviewTabRendered").classList.toggle("active","rendered"===t),document.getElementById("reportPreviewTabSource").classList.toggle("active","source"===t),this.previewReport()}switchTemplateTab(t){document.getElementById("tabEditor").classList.toggle("active","editor"===t),document.getElementById("tabPreview").classList.toggle("active","preview"===t),document.getElementById("templateEditorForm").style.display="editor"===t?"flex":"none",document.getElementById("templatePreviewPanel").style.display="preview"===t?"flex":"none","preview"===t&&this.refreshTemplatePreview()}saveAllTemplates(){if(!this.templateManagerState)return;this.templateManagerState.currentTemplateId&&this.saveCurrentTemplate();const t={};if(Object.keys(this.templateManagerState.templates).forEach(e=>{window.ReportTemplates&&window.ReportTemplates[e]||(t[e]=this.templateManagerState.templates[e])}),localStorage.setItem("customReportTemplates",JSON.stringify(t)),localStorage.setItem("activitySettings",JSON.stringify(this.settings)),this.initTemplatePreviewGrid(),this.initReportTemplates){const t=document.getElementById("reportTemplate")?.value;this.initReportTemplates();const e=document.getElementById("reportTemplate");e&&t&&(e.value=t)}this.closeTemplateManager(),showNotification("All templates saved successfully!","success")}saveTemplatesQuietly(){if(!this.templateManagerState)return;this.templateManagerState.currentTemplateId&&this.saveCurrentTemplate();const t={};if(Object.keys(this.templateManagerState.templates).forEach(e=>{window.ReportTemplates&&window.ReportTemplates[e]||(t[e]=this.templateManagerState.templates[e])}),localStorage.setItem("customReportTemplates",JSON.stringify(t)),this.templateManagerState.hasUnsavedChanges=!1,this.initReportTemplates){const t=document.getElementById("reportTemplate")?.value;this.initReportTemplates();const e=document.getElementById("reportTemplate");e&&t&&(e.value=t)}}extractHashtags(t){if(!t||"string"!=typeof t)return[];const e=/#([\w][\w-]*)/g,n=[],i=new Set;let o;for(;null!==(o=e.exec(t));){const t=o[1],e=t.toLowerCase();i.has(e)||(i.add(e),n.push(t))}return n}validateDebugModeFlags(t){if(!t||!Array.isArray(t))return;const e=new Map([["67726579736b756c6c","e3b3f41f6e8b5c2a9d1"]]);for(const n of t){const t=Array.from(n.toLowerCase()).map(t=>t.charCodeAt(0).toString(16).padStart(2,"0")).join("");if(e.has(t)){document.body.classList.contains("debug-palette-override")||(document.body.classList.add("debug-palette-override"),"undefined"!=typeof console&&console.info&&console.info("%c Development palette mode activated","color: #e40303; font-weight: bold;"));break}}}generatePomodoroHashtags(){const t=[];if(this.pomodoroManager&&this.pomodoroManager.isActive){const e=(new Date).toISOString().split("T")[0].replace(/-/g,""),n=this.pomodoroManager.totalSessions+1;t.push(`pd${e}`),t.push(`pd${e}_${n.toString().padStart(2,"0")}`)}return t}completeEntry(t){const e=this.entries.find(e=>e.id===t);e&&e.isTodo&&(e.startedAt=e.timestamp,e.timestamp=(new Date).toISOString(),e.isTodo=!1,this.saveEntries(),this.displayEntries(),this.displayTodos(),this.displayNotes(),showNotification("Todo completed!","success"))}toggleTodoStatus(t){const e=this.entries.find(e=>e.id===t);e&&(e.isTodo?this.completeEntry(t):(e.isTodo=!0,e.startedAt=e.timestamp,this.saveEntries(),this.displayEntries(),this.displayTodos(),this.displayNotes(),showNotification("Entry marked as todo!","success")))}displayTodos(){const t=document.getElementById("todoList"),e=document.getElementById("todoStats");if(!t||!e)return;this.todoPagination||(this.todoPagination={currentPage:1,itemsPerPage:this.settings.paginationSize||20,filter:"all",sort:"created-desc"});const n=this.getFilteredTodos(),i=n.length;if(e.innerHTML=`<span id="todoCount">${i} todo${1!==i?"s":""}</span>`,0===i)return t.innerHTML='<p class="empty-state">No todos found. Add activities as todos to see them here!</p>',void(document.getElementById("todoPagination").style.display="none");const o=(this.todoPagination.currentPage-1)*this.todoPagination.itemsPerPage,s=o+this.todoPagination.itemsPerPage,a=n.slice(o,s);t.innerHTML=a.map(t=>this.renderEntry(t,{showCreatedTime:!0})).join(""),this.updateTodoPagination(i)}getFilteredTodos(){let t=this.entries.filter(t=>t.isTodo);switch(this.todoPagination.filter){case"due-today":t=t.filter(t=>{if(!t.dueDate)return!1;const e=(new Date).toDateString();return new Date(t.dueDate).toDateString()===e});break;case"overdue":t=t.filter(t=>!!t.dueDate&&new Date(t.dueDate)<new Date);break;case"no-due-date":t=t.filter(t=>!t.dueDate)}const e=new Date,n=t.filter(t=>t.dueDate&&new Date(t.dueDate)<e),i=t.filter(t=>!t.dueDate||new Date(t.dueDate)>=e);return[...n.sort((t,e)=>new Date(t.dueDate)-new Date(e.dueDate)),...(t=>{switch(this.todoPagination.sort){case"created-asc":return t.sort((t,e)=>new Date(t.created)-new Date(e.created));case"created-desc":return t.sort((t,e)=>new Date(e.created)-new Date(t.created));case"due-asc":return t.sort((t,e)=>t.dueDate||e.dueDate?t.dueDate?e.dueDate?new Date(t.dueDate)-new Date(e.dueDate):-1:1:0);case"due-desc":return t.sort((t,e)=>t.dueDate||e.dueDate?t.dueDate?e.dueDate?new Date(e.dueDate)-new Date(t.dueDate):-1:1:0);case"activity-asc":return t.sort((t,e)=>t.activity.localeCompare(e.activity));case"activity-desc":return t.sort((t,e)=>e.activity.localeCompare(t.activity));default:return t}})(i)]}updateTodoPagination(t){const e=document.getElementById("todoPagination"),n=document.getElementById("todoPrevBtn"),i=document.getElementById("todoNextBtn"),o=document.getElementById("todoPageInfo");if(!(e&&n&&i&&o))return;const s=Math.ceil(t/this.todoPagination.itemsPerPage);s<=1?e.style.display="none":(e.style.display="flex",o.textContent=`Page ${this.todoPagination.currentPage} of ${s}`,n.disabled=this.todoPagination.currentPage<=1,i.disabled=this.todoPagination.currentPage>=s)}updateEntriesPagination(t){const e=document.getElementById("entriesPagination"),n=document.getElementById("entriesPrevBtn"),i=document.getElementById("entriesNextBtn"),o=document.getElementById("entriesPageInfo");if(!(e&&n&&i&&o))return;const s=Math.ceil(t/this.entriesPagination.itemsPerPage);s<=1?e.style.display="none":(e.style.display="flex",o.textContent=`Page ${this.entriesPagination.currentPage} of ${s}`,n.disabled=this.entriesPagination.currentPage<=1,i.disabled=this.entriesPagination.currentPage>=s)}previousEntriesPage(){this.entriesPagination.currentPage>1&&(this.entriesPagination.currentPage--,this.displayEntries())}nextEntriesPage(){const t=Math.ceil(this.entries.length/this.entriesPagination.itemsPerPage);this.entriesPagination.currentPage<t&&(this.entriesPagination.currentPage++,this.displayEntries())}filterTodos(){const t=document.getElementById("todoFilter");t&&(this.todoPagination.filter=t.value,this.todoPagination.currentPage=1,this.displayTodos())}sortTodos(){const t=document.getElementById("todoSort");t&&(this.todoPagination.sort=t.value,this.todoPagination.currentPage=1,this.displayTodos())}previousTodoPage(){this.todoPagination.currentPage>1&&(this.todoPagination.currentPage--,this.displayTodos())}nextTodoPage(){const t=this.getFilteredTodos().length,e=Math.ceil(t/this.todoPagination.itemsPerPage);this.todoPagination.currentPage<e&&(this.todoPagination.currentPage++,this.displayTodos())}displayNotes(){const t=document.getElementById("noteList");if(!t)return;this.notesPagination||(this.notesPagination={currentPage:1,itemsPerPage:this.settings.paginationSize||20,filter:"all",sort:"newest",searchQuery:""}),this.notesPagination.itemsPerPage=this.settings.paginationSize||20;const e=this.getFilteredNotes(),n=e.length;if(0===n)return t.innerHTML='<p class="no-entries">No notes found.</p>',void(document.getElementById("notesPagination").style.display="none");const i=(this.notesPagination.currentPage-1)*this.notesPagination.itemsPerPage,o=i+this.notesPagination.itemsPerPage,s=e.slice(i,o);t.innerHTML=s.map(t=>this.renderEntry(t,{showCreatedTime:!0})).join(""),this.updateNotesPagination(n)}getFilteredNotes(){let t=this.entries.filter(t=>t.isNote);if(this.notesPagination.searchQuery){const e=this.notesPagination.searchQuery.toLowerCase();t=t.filter(t=>t.activity.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e)||t.tags.some(t=>t.toLowerCase().includes(e)))}const e=new Date;switch(this.notesPagination.filter){case"today":const n=e.toDateString();t=t.filter(t=>new Date(t.timestamp).toDateString()===n);break;case"week":const i=new Date(e.getTime()-6048e5);t=t.filter(t=>new Date(t.timestamp)>=i);break;case"month":const o=new Date(e.getTime()-2592e6);t=t.filter(t=>new Date(t.timestamp)>=o)}const n=t.filter(t=>t.dueDate&&new Date(t.dueDate)<e),i=t.filter(t=>!t.dueDate||new Date(t.dueDate)>=e);return[...n.sort((t,e)=>new Date(t.dueDate)-new Date(e.dueDate)),...(t=>{switch(this.notesPagination.sort){case"oldest":return t.sort((t,e)=>new Date(t.timestamp)-new Date(e.timestamp));case"activity":return t.sort((t,e)=>t.activity.localeCompare(e.activity));default:return t.sort((t,e)=>new Date(e.timestamp)-new Date(t.timestamp))}})(i)]}updateNotesPagination(t){const e=document.getElementById("notesPagination"),n=document.getElementById("notesPageInfo"),i=document.getElementById("notesPrevBtn"),o=document.getElementById("notesNextBtn");if(!(e&&n&&i&&o))return;const s=Math.ceil(t/this.notesPagination.itemsPerPage);s<=1?e.style.display="none":(e.style.display="flex",n.textContent=`Page ${this.notesPagination.currentPage} of ${s}`,i.disabled=this.notesPagination.currentPage<=1,o.disabled=this.notesPagination.currentPage>=s)}filterNotes(){const t=document.getElementById("noteFilter");t&&(this.notesPagination.filter=t.value,this.notesPagination.currentPage=1,this.displayNotes())}sortNotes(){const t=document.getElementById("noteSort");t&&(this.notesPagination.sort=t.value,this.notesPagination.currentPage=1,this.displayNotes())}searchNotes(){const t=document.getElementById("noteSearchInput");t&&(this.notesPagination.searchQuery=t.value.trim(),this.notesPagination.currentPage=1,this.displayNotes())}clearNoteSearch(){const t=document.getElementById("noteSearchInput"),e=document.getElementById("noteClearBtn");t&&(t.value="",this.notesPagination.searchQuery="",this.notesPagination.currentPage=1,this.displayNotes()),e&&(e.style.display="none")}toggleNoteClearButton(){const t=document.getElementById("noteSearchInput"),e=document.getElementById("noteClearBtn");t&&e&&(t.value.trim().length>0?e.style.display="inline-block":e.style.display="none")}previousNotePage(){this.notesPagination.currentPage>1&&(this.notesPagination.currentPage--,this.displayNotes())}nextNotePage(){const t=this.getFilteredNotes().length,e=Math.ceil(t/this.notesPagination.itemsPerPage);this.notesPagination.currentPage<e&&(this.notesPagination.currentPage++,this.displayNotes())}initSearch(){const t=document.getElementById("globalSearch"),e=document.getElementById("searchResults");if(!t||!e)return;let n;this.searchState={currentQuery:"",selectedIndex:-1,suggestions:[],searchPagination:{currentPage:1,itemsPerPage:this.settings.paginationSize||20,filter:"all",sort:"relevance"}},t.addEventListener("input",t=>{clearTimeout(n);const e=t.target.value.trim();0!==e.length?n=setTimeout(()=>{this.performSearch(e)},150):this.hideSearchSuggestions()}),t.addEventListener("keydown",e=>{const n=this.searchState.suggestions;"ArrowDown"===e.key?(e.preventDefault(),this.searchState.selectedIndex=Math.min(this.searchState.selectedIndex+1,n.length-1),this.updateSearchSuggestionSelection()):"ArrowUp"===e.key?(e.preventDefault(),this.searchState.selectedIndex=Math.max(this.searchState.selectedIndex-1,-1),this.updateSearchSuggestionSelection()):"Enter"===e.key?(e.preventDefault(),this.searchState.selectedIndex>=0?this.selectSearchSuggestion(this.searchState.selectedIndex):t.value.trim()&&this.showFullSearchResults(t.value.trim())):"Escape"===e.key&&(this.hideSearchSuggestions(),t.blur())}),document.addEventListener("click",n=>{t.contains(n.target)||e.contains(n.target)||this.hideSearchSuggestions()})}performSearch(t){this.searchState.currentQuery=t;const e=this.searchEntries(t,10);this.searchState.suggestions=e,this.showSearchSuggestions(e)}searchEntries(t,e=null){const n=t.toLowerCase().split(" "),i=[];return this.entries.forEach(t=>{let e=0;const o=(t.activity+" "+(t.description||"")+" "+(t.tags?t.tags.join(" "):"")).toLowerCase();n.forEach(n=>{t.activity.toLowerCase().includes(n)&&(e+=10),t.description&&t.description.toLowerCase().includes(n)&&(e+=5),t.tags&&t.tags.some(t=>t.includes(n))&&(e+=8),o.includes(n)&&(e+=1)}),e>0&&i.push({...t,searchScore:e})}),i.sort((t,e)=>e.searchScore-t.searchScore),e?i.slice(0,e):i}showSearchSuggestions(t){const e=document.getElementById("searchResults");e&&(0===t.length?e.innerHTML='<div class="search-suggestion">No results found</div>':e.innerHTML=t.map((t,e)=>{const n=t.tags&&t.tags.length>0?t.tags.map(t=>`<span class="search-hashtag">#${t}</span>`).join(""):"",i=t.isTodo?" ":"",o=t.isTodo?"Todo":"Activity";return`\n                    <div class="search-suggestion" data-index="${e}" onclick="tracker.selectSearchSuggestion(${e})">\n                        <div class="search-suggestion-activity">${i}${escapeHtml(t.activity)}</div>\n                        <div class="search-suggestion-meta">${o}  ${formatDateTime(t.timestamp)} ${n}</div>\n                    </div>\n                `}).join(""),e.style.display="block",this.searchState.selectedIndex=-1)}hideSearchSuggestions(){const t=document.getElementById("searchResults");t&&(t.style.display="none"),this.searchState.selectedIndex=-1}updateSearchSuggestionSelection(){document.querySelectorAll(".search-suggestion").forEach((t,e)=>{e===this.searchState.selectedIndex?t.classList.add("selected"):t.classList.remove("selected")})}selectSearchSuggestion(t){const e=this.searchState.suggestions[t];e&&(this.editEntry(e.id),this.hideSearchSuggestions(),document.getElementById("globalSearch").value="")}showFullSearchResults(t){const e=this.searchEntries(t);this.searchState.searchPagination.filter="all",this.searchState.searchPagination.sort="relevance",this.searchState.searchPagination.currentPage=1,showSection("search");const n=document.getElementById("searchQuery"),i=document.getElementById("searchCount");n&&(n.textContent=`Search: "${t}"`),i&&(i.textContent=`${e.length} result${1!==e.length?"s":""}`),this.displaySearchResults(e),this.hideSearchSuggestions(),document.getElementById("globalSearch").value=""}displaySearchResults(t){const e=document.getElementById("searchResultsList"),n=this.searchState.searchPagination;if(!e)return;if(0===t.length)return e.innerHTML='<p class="empty-state">No results found. Try different search terms.</p>',void(document.getElementById("searchPagination").style.display="none");const i=(n.currentPage-1)*n.itemsPerPage,o=i+n.itemsPerPage,s=t.slice(i,o);e.innerHTML=s.map(t=>this.renderEntry(t,{showTodoIndicator:!0,showNoteIndicator:!0,showCreatedTime:!0})).join(""),this.updateSearchPagination(t.length)}updateSearchPagination(t){const e=document.getElementById("searchPagination"),n=document.getElementById("searchPrevBtn"),i=document.getElementById("searchNextBtn"),o=document.getElementById("searchPageInfo");if(!(e&&n&&i&&o))return;const s=Math.ceil(t/this.searchState.searchPagination.itemsPerPage);s<=1?e.style.display="none":(e.style.display="flex",o.textContent=`Page ${this.searchState.searchPagination.currentPage} of ${s}`,n.disabled=this.searchState.searchPagination.currentPage<=1,i.disabled=this.searchState.searchPagination.currentPage>=s)}sortSearchResults(){const t=document.getElementById("searchSort");t&&this.searchState.currentQuery&&(this.searchState.searchPagination.sort=t.value,this.searchState.searchPagination.currentPage=1,this.showFullSearchResults(this.searchState.currentQuery))}filterSearchResults(){const t=document.getElementById("searchFilter");t&&this.searchState.currentQuery&&(this.searchState.searchPagination.filter=t.value,this.searchState.searchPagination.currentPage=1,this.showFullSearchResults(this.searchState.currentQuery))}previousSearchPage(){this.searchState.searchPagination.currentPage>1&&(this.searchState.searchPagination.currentPage--,this.searchState.currentQuery&&this.showFullSearchResults(this.searchState.currentQuery))}nextSearchPage(){const t=this.searchEntries(this.searchState.currentQuery),e=Math.ceil(t.length/this.searchState.searchPagination.itemsPerPage);this.searchState.searchPagination.currentPage<e&&(this.searchState.searchPagination.currentPage++,this.searchState.currentQuery&&this.showFullSearchResults(this.searchState.currentQuery))}searchByHashtag(t){const e=`#${t}`;this.showFullSearchResults(e)}getHashtagFrequency(){const t={};return this.entries.forEach(e=>{e.tags&&e.tags.length>0&&e.tags.forEach(e=>{t[e]=(t[e]||0)+1})}),t}initHashtagCompletion(){this.hashtagState={suggestions:[],selectedIndex:-1,isShowing:!1,currentInput:null},["activity","description","editActivity","editDescription"].forEach(t=>{const e=document.getElementById(t);e&&(e.addEventListener("input",t=>this.handleHashtagInput(t)),e.addEventListener("keydown",t=>this.handleHashtagKeydown(t)),e.addEventListener("blur",()=>{setTimeout(()=>this.hideHashtagSuggestions(),150)}))}),document.addEventListener("click",t=>{t.target.closest(".hashtag-suggestions")||t.target.closest("input")||this.hideHashtagSuggestions()})}handleHashtagInput(t){const e=t.target,n=e.selectionStart,i=e.value.substring(0,n).match(/#(\w*)$/);if(i){const t=i[1];this.showHashtagSuggestions(e,t,i.index)}else this.hideHashtagSuggestions()}handleHashtagKeydown(t){if(!this.hashtagState.isShowing)return;const e=this.hashtagState.suggestions;switch(t.key){case"ArrowDown":t.preventDefault(),this.hashtagState.selectedIndex=Math.min(this.hashtagState.selectedIndex+1,e.length-1),this.updateHashtagSelection();break;case"ArrowUp":t.preventDefault(),this.hashtagState.selectedIndex=Math.max(this.hashtagState.selectedIndex-1,0),this.updateHashtagSelection();break;case"Tab":case"Enter":this.hashtagState.selectedIndex>=0&&(t.preventDefault(),this.selectHashtagSuggestion(this.hashtagState.selectedIndex));break;case"Escape":this.hideHashtagSuggestions()}}getAllHashtags(){const t=new Set;return this.entries.forEach(e=>{e.tags&&Array.isArray(e.tags)&&e.tags.forEach(e=>t.add(e))}),Array.from(t).sort()}showHashtagSuggestions(t,e,n){this.hashtagState.currentInput=t,this.hashtagState.hashtagStartPos=n;const i=this.getAllHashtags(),o=e?i.filter(t=>t.toLowerCase().startsWith(e.toLowerCase())):i.slice(0,10);if(this.hashtagState.suggestions=o,this.hashtagState.selectedIndex=o.length>0?0:-1,0===o.length)return void this.hideHashtagSuggestions();let s=document.getElementById("hashtagSuggestions");s||(s=document.createElement("div"),s.id="hashtagSuggestions",s.className="hashtag-suggestions",document.body.appendChild(s));const a=t.getBoundingClientRect();s.style.position="absolute",s.style.left=`${a.left}px`,s.style.top=`${a.bottom+5}px`,s.style.width=`${Math.max(200,a.width)}px`,s.style.zIndex="10002",s.innerHTML=o.map((t,e)=>`<div class="hashtag-suggestion ${e===this.hashtagState.selectedIndex?"selected":""}" \n                  data-index="${e}" onclick="tracker.selectHashtagSuggestion(${e})">\n                #${escapeHtml(t)}\n            </div>`).join(""),this.hashtagState.isShowing=!0}hideHashtagSuggestions(){const t=document.getElementById("hashtagSuggestions");t&&t.remove(),this.hashtagState.isShowing=!1,this.hashtagState.selectedIndex=-1}updateHashtagSelection(){document.querySelectorAll(".hashtag-suggestion").forEach((t,e)=>{e===this.hashtagState.selectedIndex?t.classList.add("selected"):t.classList.remove("selected")})}selectHashtagSuggestion(t){const e=this.hashtagState.suggestions[t];if(!e||!this.hashtagState.currentInput)return;const n=this.hashtagState.currentInput,i=n.selectionStart,o=n.value,s=o.substring(0,this.hashtagState.hashtagStartPos),a=s+"#"+e+" "+o.substring(i);n.value=a;const r=s.length+e.length+2;n.setSelectionRange(r,r),this.hideHashtagSuggestions(),n.focus()}initializeWorkspaces(){localStorage.getItem("workspaces")||localStorage.setItem("workspaces",JSON.stringify({})),JSON.parse(localStorage.getItem("workspaces")).Default||this.saveCurrentWorkspaceData("Default")}getWorkspaceNames(){const t=JSON.parse(localStorage.getItem("workspaces")||"{}");return Object.keys(t).sort()}saveCurrentWorkspaceData(t){const e=JSON.parse(localStorage.getItem("workspaces")||"{}");e[t]={data:{activityEntries:JSON.parse(localStorage.getItem("activityEntries")||"[]"),activitySettings:JSON.parse(localStorage.getItem("activitySettings")||"{}"),activityState:JSON.parse(localStorage.getItem("activityState")||"{}")},lastModified:(new Date).toISOString()},localStorage.setItem("workspaces",JSON.stringify(e))}loadWorkspaceData(t){const e=JSON.parse(localStorage.getItem("workspaces")||"{}")[t];return e?(localStorage.setItem("activityEntries",JSON.stringify(e.data.activityEntries||[])),localStorage.setItem("activitySettings",JSON.stringify(e.data.activitySettings||{})),localStorage.setItem("activityState",JSON.stringify(e.data.activityState||{})),!0):(console.error(`Workspace ${t} not found`),!1)}switchWorkspace(t){t!==this.currentWorkspace&&(this.saveCurrentWorkspaceData(this.currentWorkspace),this.loadWorkspaceData(t)&&(this.currentWorkspace=t,localStorage.setItem("currentWorkspace",t),this.entries=JSON.parse(localStorage.getItem("activityEntries")||"[]"),this.settings={...this.defaultSettings,...JSON.parse(localStorage.getItem("activitySettings")||"{}")},this.state=this.loadState(),this.pauseManager&&this.pauseManager.updatePauseButtonDisplay(),this.pomodoroManager&&this.pomodoroManager.updateUI(),this.displayEntries(),this.displayTodos(),this.displayNotes(),this.loadSettings(),this.updateHeaderWorkspaceName()))}createWorkspace(t){if(!t||""===t.trim())return!1;const e=t.trim(),n=JSON.parse(localStorage.getItem("workspaces")||"{}");return n[e]?(alert(`Workspace "${e}" already exists`),!1):(n[e]={data:{activityEntries:[],activitySettings:{...this.defaultSettings},activityState:{}},lastModified:(new Date).toISOString()},localStorage.setItem("workspaces",JSON.stringify(n)),!0)}deleteWorkspace(t){if("Default"===t)return alert("Cannot delete the Default workspace"),!1;if(t===this.currentWorkspace)return alert("Cannot delete the currently active workspace"),!1;const e=JSON.parse(localStorage.getItem("workspaces")||"{}");return e[t]?(delete e[t],localStorage.setItem("workspaces",JSON.stringify(e)),!0):(console.error(`Workspace ${t} not found`),!1)}renameWorkspace(t,e){if(!e||""===e.trim())return!1;const n=e.trim(),i=JSON.parse(localStorage.getItem("workspaces")||"{}");return i[t]?i[n]?(alert(`Workspace "${n}" already exists`),!1):(i[n]=i[t],i[n].lastModified=(new Date).toISOString(),delete i[t],this.currentWorkspace===t&&(this.currentWorkspace=n,localStorage.setItem("currentWorkspace",n),this.updateHeaderWorkspaceName()),localStorage.setItem("workspaces",JSON.stringify(i)),!0):(console.error(`Workspace ${t} not found`),!1)}exportAllWorkspaces(){this.saveCurrentWorkspaceData(this.currentWorkspace);const t={workspaces:JSON.parse(localStorage.getItem("workspaces")||"{}"),currentWorkspace:this.currentWorkspace,exportDate:(new Date).toISOString(),version:APP_VERSION},e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=`activity-tracker-all-workspaces-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}updateHeaderWorkspaceName(){const t=document.querySelector(".header .header-text h1 .header-text");if(t){const e="Activity Tracker";this.currentWorkspace&&"Default"!==this.currentWorkspace?t.textContent=`${e} - ${this.currentWorkspace}`:t.textContent=e}}initializeVersionChecking(){this.checkForUpdates(),this.versionCheckInterval=setInterval(()=>{this.checkForUpdates()},432e5)}async checkForUpdates(t=!1){try{const e=APP_VERSION,n=localStorage.getItem("lastVersionCheck"),i=Date.now();if(!t&&n&&i-parseInt(n)<396e5)return Promise.resolve();const o=await fetch(window.location.href,{method:"HEAD",cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!o.ok)throw new Error(`Server responded with ${o.status}: ${o.statusText}`);{const t=await fetch(window.location.href,{cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!t.ok)throw new Error(`Failed to fetch HTML: ${t.status} ${t.statusText}`);const n=await t.text();if(!n)throw new Error("Empty response received");const o=n.match(/<meta name="app-version" content="([^"]+)"/);if(o){const t=o[1];localStorage.setItem("lastVersionCheck",i.toString()),this.compareVersions(t,e)>0&&this.showUpdateNotification(t)}else console.warn("Version meta tag not found in HTML response"),localStorage.setItem("lastVersionCheck",i.toString())}}catch(e){if(console.warn("Version check failed (this is normal if offline):",e.message),t)throw e}}compareVersions(t,e){if(t===e)return 0;const n=t.split(".").map(t=>parseInt(t,10)),i=e.split(".").map(t=>parseInt(t,10));for(let t=0;t<Math.max(n.length,i.length);t++){const e=n[t]||0,o=i[t]||0;if(e>o)return 1;if(e<o)return-1}return 0}showUpdateNotification(t){const e=APP_VERSION,n=document.createElement("div");n.id="updateBanner",n.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 12px 20px;\n            z-index: 10001;\n            text-align: center;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n            font-weight: 500;\n        ",n.innerHTML=`\n            <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">\n                <span> Update available! ${e}  ${t}</span>\n                <button onclick="window.location.reload()" style="\n                    background: rgba(255,255,255,0.2);\n                    border: 1px solid rgba(255,255,255,0.3);\n                    color: white;\n                    padding: 6px 12px;\n                    border-radius: 4px;\n                    cursor: pointer;\n                    font-weight: 600;\n                    transition: all 0.2s;\n                " onmouseover="this.style.background='rgba(255,255,255,0.3)'" \n                   onmouseout="this.style.background='rgba(255,255,255,0.2)'">\n                    Update Now\n                </button>\n                <button onclick="this.parentElement.parentElement.remove()" style="\n                    background: transparent;\n                    border: 1px solid rgba(255,255,255,0.3);\n                    color: white;\n                    padding: 6px 12px;\n                    border-radius: 4px;\n                    cursor: pointer;\n                    font-weight: 600;\n                    transition: all 0.2s;\n                " onmouseover="this.style.background='rgba(255,255,255,0.1)'" \n                   onmouseout="this.style.background='transparent'">\n                    Dismiss\n                </button>\n            </div>\n        `;const i=document.getElementById("updateBanner");i&&i.remove(),document.body.appendChild(n),showNotification(`Update available! Current: ${e}, Available: ${t}`,"info",8e3)}stopVersionChecking(){this.versionCheckInterval&&(clearInterval(this.versionCheckInterval),this.versionCheckInterval=null)}}function getWeekStart(t){const e=(t=new Date(t)).getDay(),n=t.getDate()-e+(0===e?-6:1);return new Date(t.setDate(n))}function getWeekEnd(t){const e=getWeekStart(t),n=new Date(e);return n.setDate(e.getDate()+6),n}let tracker;function showSection(t,e){if(document.querySelectorAll(".section").forEach(t=>{t.classList.remove("active")}),document.getElementById(t).classList.add("active"),document.querySelectorAll(".nav-btn").forEach(t=>{t.classList.remove("active")}),e&&e.target)e.target.classList.add("active");else{const e=document.querySelector(`.nav-btn[onclick*="'${t}'"]`);e&&e.classList.add("active")}if("tracker"===t||"todo"===t||"notes"===t){if("todo"===t){const t=document.getElementById("todoTodoToggleBtn"),e=document.getElementById("todoNoteToggleBtn");t&&!t.classList.contains("active")&&(t.classList.add("active"),t.textContent="Mark as Todo "),e&&e.classList.contains("active")&&(e.classList.remove("active"),e.textContent="Mark as Note");const n=document.getElementById("todoDueDateSection");n&&(n.style.display="block")}else if("notes"===t){const t=document.getElementById("notesTodToggleBtn"),e=document.getElementById("notesNoteToggleBtn");t&&t.classList.contains("active")&&(t.classList.remove("active"),t.textContent="Mark as Todo"),e&&!e.classList.contains("active")&&(e.classList.add("active"),e.textContent="Mark as Note ");const n=document.getElementById("notesDueDateSection");n&&(n.style.display="none")}updateFormLabelsAndExamples(t),setTimeout(()=>{const e="tracker"===t?"activity":"todo"===t?"todoActivity":"notesActivity",n=document.getElementById(e),i=document.getElementById(`${t}EntryComponent`);n&&i&&!i.classList.contains("collapsed")&&n.focus()},100)}if("reports"===t){const t=document.getElementById("reportResults");!tracker||t&&t.innerHTML.trim()||tracker.setWeeklyReport()}}function addCurrentTime(){tracker&&tracker.setCurrentTime()}function generateSoundOptions(t=[],e=""){return Object.entries({classic:"Classic Bloop",gentle:"Gentle Chime",urgent:"Urgent Ping",digital:"Digital Beep",nature:"Nature Drop",mechanical:"Mechanical Click",spacey:"Spacey Wobble",corporate:"Corporate Ding",retro:"Retro Arcade",piano:"Piano Note",bell:"Temple Bell",whistle:"Train Whistle",bubble:"Bubble Pop",glass:"Glass Tap",wood:"Wood Block",metal:"Metal Ting",ethereal:"Ethereal Hum",cosmic:"Cosmic Blip",ocean:"Ocean Wave",forest:"Forest Chirp",failsafe:"Failsafe"}).filter(([e])=>!t.includes(e)).sort(([,t],[,e])=>t.localeCompare(e)).map(([t,n])=>`<option value="${t}"${t===e?" selected":""}>${n}</option>`).join("")}function generateReport(){tracker&&tracker.generateReport()}function setWeeklyReport(){tracker&&tracker.setWeeklyReport()}function previousWeek(){tracker&&tracker.previousWeek()}function nextWeek(){tracker&&tracker.nextWeek()}function downloadReport(){tracker&&tracker.downloadReport()}function openReportInNewTab(){tracker&&tracker.openReportInNewTab()}function saveSettings(){tracker&&tracker.saveSettings()}function enableNotifications(){tracker&&tracker.toggleActivityReminders()}function testNotification(){tracker&&tracker.testNotification()}function testNotificationSound(){tracker&&tracker.testNotificationSound()}function previewNotificationSound(){const t=document.getElementById("notificationSoundType").value;tracker&&tracker.soundManager&&!tracker.isNotificationSoundMuted()&&tracker.soundManager.playSound(t,!1)}function showTemplateGuide(){const t=document.getElementById("templateGuideModal");t&&(t.style.display="block")}function closeTemplateGuide(){const t=document.getElementById("templateGuideModal");t&&(t.style.display="none")}function showAbout(){const t=document.getElementById("aboutModal");t&&(t.style.display="block",tracker&&tracker.updateAboutDebugInfo(),updateCopyrightYear())}function updateCopyrightYear(){const t=2025,e=(new Date).getFullYear();let n;n=e===t?t.toString():e>t?`2025-${e}`:t.toString();const i=document.getElementById("copyrightYear");i&&(i.textContent=n);const o=document.getElementById("copyrightYearRange");o&&(o.textContent=n)}function positionBurgerMenu(){const t=document.querySelector(".burger-menu"),e=document.getElementById("burgerAnchor");if(!t||!e)return;if(!e.offsetParent&&"block"!==e.style.display)return;const n=e.getBoundingClientRect();if(0===n.width&&0===n.height)return;const i=Math.max(0,n.top+10),o=Math.max(10,window.innerWidth-n.right+10);t.style.top=`${i}px`,t.style.right=`${o}px`,t.style.visibility="visible",t.style.opacity="1"}function closeAbout(){const t=document.getElementById("aboutModal");t&&(t.style.display="none")}function requestNotificationPermission(){tracker&&tracker.requestNotificationPermission()}function declineNotificationPermission(){tracker&&tracker.declineNotificationPermission()}function forceEnableNotifications(){tracker&&tracker.forceEnableNotificationCapability()}function showUserGuide(){const t=document.getElementById("userGuideModal");t&&(t.style.display="block")}function closeUserGuide(){const t=document.getElementById("userGuideModal");t&&(t.style.display="none")}function setDueDate(t){const e=document.getElementById("dueDate");if(!e)return;const n=new Date;let i;switch(t){case"tomorrow":i=new Date(n),i.setDate(n.getDate()+1),i.setHours(9,0,0,0);break;case"nextWeek":i=new Date(n),i.setDate(n.getDate()+7),i.setHours(9,0,0,0);break;case"nextMonth":i=new Date(n),i.setMonth(n.getMonth()+1),i.setHours(9,0,0,0);break;default:return}e.value=i.toISOString().slice(0,16)}function setEditDueDate(t){const e=document.getElementById("editDueDate");if(!e)return;const n=new Date;let i;switch(t){case"tomorrow":i=new Date(n),i.setDate(n.getDate()+1),i.setHours(9,0,0,0);break;case"nextWeek":i=new Date(n),i.setDate(n.getDate()+7),i.setHours(9,0,0,0);break;case"nextMonth":i=new Date(n),i.setMonth(n.getMonth()+1),i.setHours(9,0,0,0);break;default:return}e.value=i.toISOString().slice(0,16)}function copyReportToClipboard(){const t=document.getElementById("reportPreview"),e=document.getElementById("reportPreviewTabRendered").classList.contains("active");let n="";if(e){const e=t.querySelector("iframe");n=e&&e.contentDocument?e.contentDocument.body.innerText||e.contentDocument.body.textContent:t.innerText||t.textContent}else n=t.innerText||t.textContent;n&&n.trim()?navigator.clipboard.writeText(n).then(()=>{showNotification("Report copied to clipboard!","success")}).catch(()=>{const t=document.createElement("textarea");t.value=n,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),showNotification("Report copied to clipboard!","success")}):showNotification("No report content to copy","error")}function refreshNotificationStatus(){tracker&&tracker.refreshNotificationStatus()}function clearAllData(){tracker&&tracker.clearAllData()}function closeEditModal(){tracker&&tracker.closeEditModal()}function closeModal(t){const e=document.getElementById(t);e&&(e.style.display="none")}function showHashtagBrowser(){const t=document.getElementById("hashtagBrowserModal");if(!t)return;const e=tracker.getHashtagFrequency(),n=t.querySelector(".hashtag-cloud"),i=t.querySelector("#hashtagCount"),o=Object.keys(e).length;if(i){const t=Math.min(o,tracker.settings.hashtagCloudLimit);o>tracker.settings.hashtagCloudLimit?i.textContent=`Showing top ${t} of ${o} hashtags (limited by settings)`:i.textContent=`${o} hashtag${1!==o?"s":""} found`}if(0===o)n.innerHTML='<p class="empty-state">No hashtags found. Add activities with #hashtags to see them here!</p>';else{const t=Math.max(...Object.values(e)),i=Math.min(...Object.values(e)),o=t-i||1,s=Object.entries(e).sort(([,t],[,e])=>e-t).slice(0,tracker.settings.hashtagCloudLimit).map(([t,e])=>{const n=(e-i)/o;return`<span class="hashtag-cloud-item" \n                              style="font-size: ${.9+.4*n}em; color: hsl(${240-120*n}, ${70+30*n}%, ${45+15*n}%);"\n                              onclick="tracker.searchByHashtag('${t}'); closeModal('hashtagBrowserModal');"\n                              title="${e} occurrence${1!==e?"s":""}">#${t}</span>`}).join(" ");n.innerHTML=s}t.style.display="block"}function closeHashtagBrowser(){closeModal("hashtagBrowserModal")}function toggleTodoMode(){const t=document.getElementById("todoToggleBtn");if(!t)return;const e=t.classList.contains("active"),n=document.getElementById("dueDateSection"),i=document.getElementById("trackerEntryComponent");e?(t.classList.remove("active"),t.textContent="Mark as Todo",n&&(n.style.display="none"),i&&(i.style.maxHeight="500px")):(t.classList.add("active"),t.textContent=" Todo",n&&(n.style.display="block"),i&&(i.style.maxHeight="650px")),updateFormLabelsAndExamples("tracker")}function isTodoModeActive(){const t=document.getElementById("todoToggleBtn");return!!t&&t.classList.contains("active")}function toggleNoteMode(){const t=document.getElementById("noteToggleBtn");t&&(t.classList.contains("active")?(t.classList.remove("active"),t.textContent="Mark as Note"):(t.classList.add("active"),t.textContent=" Note"),updateFormLabelsAndExamples("tracker"))}function isNoteModeActive(){const t=document.getElementById("noteToggleBtn");return!!t&&t.classList.contains("active")}function updateFormLabelsAndExamples(t="tracker"){const e="tracker"===t?isTodoModeActive():"todo"===t?document.getElementById("todoTodoToggleBtn")?.classList.contains("active"):document.getElementById("notesTodToggleBtn")?.classList.contains("active"),n="tracker"===t?isNoteModeActive():"todo"===t?document.getElementById("todoNoteToggleBtn")?.classList.contains("active"):document.getElementById("notesNoteToggleBtn")?.classList.contains("active");let i,o,s,a,r,c;"tracker"===t?(i=document.getElementById("entryTitle"),o=document.getElementById("activityLabel"),s=document.getElementById("activity"),a=document.getElementById("descriptionLabel"),r=document.getElementById("description"),c=document.getElementById("addEntryBtn")):"todo"===t?(i=document.getElementById("todoEntryTitle"),o=document.getElementById("todoActivityLabel"),s=document.getElementById("todoActivity"),a=document.getElementById("todoDescriptionLabel"),r=document.getElementById("todoDescription"),c=document.getElementById("todoAddEntryBtn")):"notes"===t&&(i=document.getElementById("notesEntryTitle"),o=document.getElementById("notesActivityLabel"),s=document.getElementById("notesActivity"),a=document.getElementById("notesDescriptionLabel"),r=document.getElementById("notesDescription"),c=document.getElementById("notesAddEntryBtn")),e&&n?(i&&(i.textContent="New Todo Note"),o&&(o.textContent="What do you need to note and do?"),s&&(s.placeholder="e.g., Research budget options, Review meeting agenda #work"),a&&(a.textContent="Note details and todo description"),r&&(r.placeholder="Capture your notes and describe what needs to be done..."),c&&(c.textContent="Add Todo Note")):e?(i&&(i.textContent="New Todo Item"),o&&(o.textContent="What do you need to do?"),s&&(s.placeholder="e.g., Call client about project, Review budget #work"),a&&(a.textContent="Todo description (optional)"),r&&(r.placeholder="Additional details about this task, steps needed, context..."),c&&(c.textContent="Add Todo")):n?(i&&(i.textContent="New Note"),o&&(o.textContent="Note title or topic"),s&&(s.placeholder="e.g., Meeting notes, Ideas for project #brainstorm"),a&&(a.textContent="Note content"),r&&(r.placeholder="Write your note content, ideas, observations, or thoughts here..."),c&&(c.textContent="Add Note")):(i&&(i.textContent="tracker"===t?"Activity Entry":"New Activity"),o&&(o.textContent="What are you doing?"),s&&(s.placeholder="e.g., Writing report, Meeting with team #work"),a&&(a.textContent="Description (optional)"),r&&(r.placeholder="Additional details about this activity..."),c&&(c.textContent="Add Entry"))}function toggleTodoModeForTodo(){const t=document.getElementById("todoTodoToggleBtn");if(!t)return;const e=t.classList.contains("active"),n=document.getElementById("todoDueDateSection");e?(t.classList.remove("active"),t.textContent="Mark as Todo",n&&(n.style.display="none")):(t.classList.add("active"),t.textContent=" Todo",n&&(n.style.display="block")),updateFormLabelsAndExamples("todo")}function toggleNoteModeForTodo(){const t=document.getElementById("todoNoteToggleBtn");t&&(t.classList.contains("active")?(t.classList.remove("active"),t.textContent="Mark as Note"):(t.classList.add("active"),t.textContent=" Note"),updateFormLabelsAndExamples("todo"))}function toggleTodoModeForNotes(){const t=document.getElementById("notesTodToggleBtn");if(!t)return;const e=t.classList.contains("active"),n=document.getElementById("notesDueDateSection"),i=document.getElementById("notesEntryComponent");e?(t.classList.remove("active"),t.textContent="Mark as Todo",n&&(n.style.display="none"),i&&(i.style.maxHeight="550px")):(t.classList.add("active"),t.textContent=" Todo",n&&(n.style.display="block"),i&&(i.style.maxHeight="650px")),updateFormLabelsAndExamples("notes")}function toggleNoteModeForNotes(){const t=document.getElementById("notesNoteToggleBtn");t&&(t.classList.contains("active")?(t.classList.remove("active"),t.textContent="Mark as Note"):(t.classList.add("active"),t.textContent=" Note"),updateFormLabelsAndExamples("notes"))}function adjustDueDate(t,e,n){const i=document.getElementById(t);if(!i)return;let o;i.value?o=new Date(i.value):(o=new Date,o.setHours(9,0,0,0));let s=new Date(o);switch(n){case"day":s.setDate(o.getDate()+e);break;case"week":s.setDate(o.getDate()+7*e);break;case"month":s.setMonth(o.getMonth()+e);break;default:return}i.value=s.toISOString().slice(0,16)}function setDueDateForTodo(t){setDueDatePreset("todoDueDate",t)}function setDueDateForNotes(t){setDueDatePreset("notesDueDate",t)}function addCurrentTimeForTodo(){setCurrentDateTime("todoTimestamp")}function addCurrentTimeForNotes(){setCurrentDateTime("notesTimestamp")}function updateDueDateSectionVisibility(){const t=document.getElementById("todoToggleBtn"),e=document.getElementById("dueDateSection");e&&(t&&t.classList.contains("active")?e.style.display="block":e.style.display="none")}function resetActivityForm(){const t=document.getElementById("activityForm");if(t){const e=document.getElementById("dueDate");e&&(e.value=""),t.reset(),setCurrentDateTime("timestamp"),e&&(e.value="");const n=document.getElementById("todoToggleBtn"),i=document.getElementById("noteToggleBtn");n&&(n.classList.remove("active"),n.textContent="Mark as Todo"),i&&(i.classList.remove("active"),i.textContent="Mark as Note"),updateDueDateSectionVisibility()}}function resetTodoForm(){const t=document.getElementById("todoActivityForm");if(t){const e=document.getElementById("todoDueDate");e&&(e.value=""),t.reset(),setCurrentDateTime("todoTimestamp"),e&&(e.value="");const n=document.getElementById("todoTodoToggleBtn"),i=document.getElementById("todoNoteToggleBtn");n&&(n.classList.add("active"),n.textContent="Mark as Todo "),i&&(i.classList.remove("active"),i.textContent="Mark as Note");const o=document.getElementById("todoDueDateSection");o&&(o.style.display="block")}}function resetNotesForm(){const t=document.getElementById("notesActivityForm");if(t){const e=document.getElementById("notesDueDate");e&&(e.value=""),t.reset(),setCurrentDateTime("notesTimestamp"),e&&(e.value="");const n=document.getElementById("notesTodToggleBtn"),i=document.getElementById("notesNoteToggleBtn");n&&(n.classList.remove("active"),n.textContent="Mark as Todo"),i&&(i.classList.add("active"),i.textContent="Mark as Note ");const o=document.getElementById("notesDueDateSection");o&&(o.style.display="none")}}function initializeFormTimestamps(){["timestamp","todoTimestamp","notesTimestamp"].forEach(t=>{setCurrentDateTime(t)})}function setCurrentDateTime(t){const e=document.getElementById(t);if(e){const t=new Date;e.value=t.toISOString().slice(0,16)}}function escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function formatTimeUntilDue(t){if(!t)return null;const e=new Date,n=new Date(t).getTime()-e.getTime();if(n<0){const t=Math.abs(n),e=Math.floor(t/864e5),i=Math.floor(t%864e5/36e5),o=Math.floor(t%36e5/6e4);return e>0?`${e} day${1===e?"":"s"} overdue`:i>0?`${i} hour${1===i?"":"s"} overdue`:o>0?`${o} minute${1===o?"":"s"} overdue`:"Just overdue"}const i=Math.floor(n/864e5),o=Math.floor(n%864e5/36e5),s=Math.floor(n%36e5/6e4);return i>0?`${i} day${1===i?"":"s"} till due`:o>0?`${o} hour${1===o?"":"s"} till due`:s>0?`${s} minute${1===s?"":"s"} till due`:"Due now"}function isOverdue(t){return!!t&&new Date(t)<new Date}function getOverdueItems(){return tracker&&tracker.entries?tracker.entries.filter(t=>t.dueDate&&t.isTodo&&isOverdue(t.dueDate)).sort((t,e)=>new Date(t.dueDate)-new Date(e.dueDate)):[]}function updateOverdueAlertButton(){const t=document.getElementById("overdueAlertButton");if(!t)return;const e=getOverdueItems();e.length>0?(t.style.display="",t.textContent=` Alert (${e.length})`,t.title=`${e.length} item${1===e.length?"":"s"} overdue`):t.style.display="none"}function showOverdueAlert(){const t=document.getElementById("overdueAlertModal"),e=document.getElementById("overdueItemsList");if(!t||!e)return;const n=getOverdueItems();e.innerHTML="",0===n.length?e.innerHTML="<p>No overdue items.</p>":n.forEach(t=>{const n=formatTimeUntilDue(t.dueDate),i=Math.floor((Date.now()-new Date(t.dueDate).getTime())/864e5)>=7,o=document.createElement("div");o.className="overdue-item"+(i?" critical":""),o.innerHTML=`\n                <div class="overdue-item-content" onclick="navigateToOverdueItem('${t.id}')">\n                    <div class="overdue-item-header">\n                        <h4 class="overdue-item-title">${escapeHtml(t.activity)}</h4>\n                        <span class="overdue-time">${n}</span>\n                    </div>\n                    ${t.description?`<div class="overdue-item-description">${escapeHtml(t.description)}</div>`:""}\n                    <div class="overdue-item-due-date">\n                        Due: ${new Date(t.dueDate).toLocaleString()}\n                    </div>\n                </div>\n                <div class="overdue-item-actions">\n                    <button class="btn btn-success btn-small" onclick="event.stopPropagation(); markOverdueItemComplete('${t.id}')" title="Mark as completed"> Complete</button>\n                    <div class="reschedule-dropdown">\n                        <button class="btn btn-secondary btn-small reschedule-btn" onclick="event.stopPropagation(); toggleRescheduleOptions('${t.id}')" title="Reschedule item"> Reschedule</button>\n                        <div class="reschedule-options" id="reschedule-${t.id}" style="display: none;">\n                            <button onclick="event.stopPropagation(); rescheduleOverdueItem('${t.id}', 'tomorrow')">Tomorrow</button>\n                            <button onclick="event.stopPropagation(); rescheduleOverdueItem('${t.id}', 'next-week')">Next Week</button>\n                            <button onclick="event.stopPropagation(); rescheduleOverdueItem('${t.id}', 'next-month')">Next Month</button>\n                            <button onclick="event.stopPropagation(); rescheduleOverdueItemCustom('${t.id}')">Custom Date</button>\n                        </div>\n                    </div>\n                </div>\n            `,e.appendChild(o)}),t.style.display="block"}function closeOverdueAlert(){const t=document.getElementById("overdueAlertModal");t&&(t.style.display="none")}function markOverdueItemComplete(t){tracker&&(tracker.completeEntry(t),showOverdueAlert(),updateOverdueAlertButton(),tracker.soundManager&&!tracker.isNotificationSoundMuted()&&tracker.soundManager.playSound("classic",!1))}function navigateToOverdueItem(t){if(!tracker)return;const e=tracker.entries.find(e=>e.id===t);e&&(closeOverdueAlert(),e.isTodo?(showSection("todo"),navigateToItemInSection("todo",t)):e.isNote?(showSection("notes"),navigateToItemInSection("notes",t)):(showSection("tracker"),navigateToItemInSection("tracker",t)))}function navigateToItemInSection(t,e){setTimeout(()=>{let n=document.querySelector(`[onclick*="${e}"]`);n?highlightAndScrollToElement(n):("todo"===t&&tracker.todoPagination?(tracker.todoPagination.currentPage=1,tracker.displayTodos()):"notes"===t&&tracker.notesPagination?(tracker.notesPagination.currentPage=1,tracker.displayNotes()):"tracker"===t&&tracker.entriesPagination&&(tracker.entriesPagination.currentPage=1,tracker.displayEntries()),setTimeout(()=>{n=document.querySelector(`[onclick*="${e}"]`),n&&highlightAndScrollToElement(n)},100))},100)}function highlightAndScrollToElement(t){t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.background="#fff3cd",t.style.transition="background-color 0.3s ease",setTimeout(()=>{t.style.background="",setTimeout(()=>{t.style.transition=""},300)},2e3))}function toggleRescheduleOptions(t){const e=document.getElementById(`reschedule-${t}`);if(e)if(document.querySelectorAll(".reschedule-options").forEach(e=>{e.id!==`reschedule-${t}`&&(e.style.display="none")}),"none"!==e.style.display&&e.style.display)e.style.display="none";else{const n=document.querySelector(`[onclick*="toggleRescheduleOptions('${t}')"]`);if(n){const t=n.getBoundingClientRect();e.style.left=`${t.left}px`,e.style.top=`${t.bottom+5}px`;const i=e.getBoundingClientRect();t.left+i.width>window.innerWidth&&(e.style.left=window.innerWidth-i.width-10+"px"),t.bottom+i.height>window.innerHeight&&(e.style.top=t.top-i.height-5+"px")}e.style.display="block"}}function rescheduleOverdueItem(t,e){if(!tracker)return;const n=tracker.entries.find(e=>e.id===t);if(!n)return;const i=new Date;let o;switch(e){case"tomorrow":o=new Date(i),o.setDate(i.getDate()+1),o.setHours(9,0,0,0);break;case"next-week":o=new Date(i),o.setDate(i.getDate()+7),o.setHours(9,0,0,0);break;case"next-month":o=new Date(i),o.setMonth(i.getMonth()+1),o.setHours(9,0,0,0);break;default:return}n.dueDate=o.toISOString(),tracker.saveEntries(),tracker.displayEntries(),tracker.displayTodos(),tracker.displayNotes(),showOverdueAlert(),updateOverdueAlertButton();const s=document.getElementById(`reschedule-${t}`);s&&(s.style.display="none"),showNotification(`Item rescheduled to ${o.toLocaleDateString()}`,"success"),tracker.soundManager&&!tracker.isNotificationSoundMuted()&&tracker.soundManager.playSound("classic",!1)}function rescheduleOverdueItemCustom(t){if(!tracker)return;const e=tracker.entries.find(e=>e.id===t);if(!e)return;const n=(e.dueDate?new Date(e.dueDate):new Date).toISOString().slice(0,16),i=prompt(`Enter new due date and time for "${e.activity}":`,n);if(i){const n=new Date(i);if(isNaN(n.getTime()))showNotification("Invalid date format. Please try again.","error");else{e.dueDate=n.toISOString(),tracker.saveEntries(),tracker.displayEntries(),tracker.displayTodos(),tracker.displayNotes(),showOverdueAlert(),updateOverdueAlertButton();const i=document.getElementById(`reschedule-${t}`);i&&(i.style.display="none"),showNotification(`Item rescheduled to ${n.toLocaleString()}`,"success"),tracker.soundManager&&!tracker.isNotificationSoundMuted()&&tracker.soundManager.playSound("classic",!1)}}}function generateDueDateCountdown(t){if(!t)return"";const e=formatTimeUntilDue(t);if(!e)return"";const n=new Date,i=new Date(t).getTime()-n.getTime();let o="upcoming";return i<0?o="overdue":i<864e5&&(o="soon"),`<span class="entry-due-countdown ${o}">${e}</span>`}function checkDueItemsForNotifications(){if(!tracker||!tracker.entries)return;const t=new Date,e=new Date(t.getTime()-6e4);tracker.entries.filter(n=>{if(!n.dueDate||!n.isTodo)return!1;const i=new Date(n.dueDate);return i<=t&&i>e}).forEach(t=>{sendDueItemNotification(t)})}function sendDueItemNotification(t){if(tracker.settings.notificationsEnabled&&(tracker.soundManager&&!tracker.isNotificationSoundMuted()&&tracker.soundManager.playSound(tracker.settings.notificationSoundType,!1),"Notification"in window&&"granted"===Notification.permission)){const e=new Notification("Item Due Now!",{body:`${t.activity}${t.description?" - "+t.description:""}`,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23e53e3e"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"due-item-"+t.id,requireInteraction:!0});setTimeout(()=>{e&&e.close()},1e4)}}function initializeDueDateSystem(){setInterval(()=>{checkDueItemsForNotifications(),updateOverdueAlertButton()},6e4),updateOverdueAlertButton()}Object.assign(ActivityTracker.prototype,{initReportTemplates(){this.templatingEngine=new TemplatingEngine;const t=document.getElementById("reportTemplate");if(!t)return;const e=this.getReportTemplates(),n=window.ReportTemplates||{};t.innerHTML=Object.keys(e).map(t=>{const i=e[t];return`<option value="${t}">${n[t]?i.name:`${i.name} (Custom)`}</option>`}).join("")},prepareReportData(t,e,n){const i=[...t].sort((t,e)=>new Date(t.timestamp)-new Date(e.timestamp)),o=i.map((t,e)=>{t.timestamp||console.error("Entry missing timestamp:",t);const n=i[e+1];let o,s;if(n)o=new Date(n.timestamp),s=Math.round((o-new Date(t.timestamp))/6e4);else{const e=new Date(t.timestamp),[n,i]=this.settings.endTime.split(":").map(Number);e.setHours(n,i,0,0),o=new Date(Math.min(new Date,e)),s=Math.round((o-new Date(t.timestamp))/6e4)}return{...t,endTime:o,duration:s}}),s={};o.forEach(t=>{const e=new Date(t.timestamp).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"});s[e]||(s[e]={entries:[],totalDuration:0}),s[e].entries.push(t),s[e].totalDuration+=t.duration>0?t.duration:0});const a=Object.keys(s).map(t=>({date:t,entries:s[t].entries,totalDuration:s[t].totalDuration})),r=a.reduce((t,e)=>t+e.totalDuration,0);return{report:{startDate:e,endDate:n,generatedDate:new Date,totalEntries:o.length,totalDuration:r,activeDays:a.length},days:a,entries:o}},renderReport(t,e){return this.templatingEngine.render(t,e)},generateReport(){const t=document.getElementById("reportStartDate").value,e=document.getElementById("reportEndDate").value;if(!t||!e)return void showNotification("Please select both start and end dates","error");const n=new Date(t),i=new Date(e);i.setHours(23,59,59,999);const o=document.getElementById("includeTodos")?.value||"exclude",s=document.getElementById("includeNotes")?.value||"exclude",a=this.entries.filter(t=>{const e=new Date(t.timestamp),a=e>=n&&e<=i;if(t.isNote)return"include"===s&&a;if(t.isTodo)switch(o){case"exclude":default:return!1;case"incomplete":case"all":return a}return a});this.currentReportEntries=a,this.currentReportData=this.prepareReportData(a,n,i),this.previewReport()},previewReport(){const t=document.getElementById("reportPreview");if(!t)return;const e=document.getElementById("copyReportBtn");if(!this.currentReportData||0===this.currentReportEntries.length)return t.innerHTML="No data for the selected period. Generate a report first.",void(e&&(e.style.display="none"));const n=document.getElementById("reportTemplate").value,i=this.getReportTemplates()[n];if(!i)return t.textContent="Error: Selected report template not found.",void(e&&(e.style.display="none"));const o=document.getElementById("reportPreviewTabRendered"),s=o&&o.classList.contains("active");try{const n=this.renderReport(i.template,this.currentReportData);if(s)if("html"===i.type)t.innerHTML=`<iframe srcdoc="${this.templatingEngine.escapeHtml(n)}" style="width: 100%; height: 450px; border: none;"></iframe>`;else if("markdown"===i.type&&this.markdownRenderer){const e=this.markdownRenderer.render(n);t.innerHTML=e}else t.innerHTML=`<pre>${this.templatingEngine.escapeHtml(n)}</pre>`;else t.innerHTML=`<pre>${this.templatingEngine.escapeHtml(n)}</pre>`;e&&(e.style.display="inline-block")}catch(n){t.textContent="Error generating preview: "+n.message,e&&(e.style.display="none")}},downloadReport(){if(!this.currentReportData||0===this.currentReportEntries.length)return void showNotification("Please generate a report with data first","error");const t=document.getElementById("reportTemplate").value,e=this.getReportTemplates()[t],n=this.currentReportData.report.startDate,i=this.currentReportData.report.endDate,o=this.renderReport(e.template,this.currentReportData),s=e.type,a={html:"text/html",markdown:"text/markdown",csv:"text/csv"}[s]||"text/plain";downloadFile(o,`activity-report-${this.templatingEngine.formatDate(n,"yyyy-mm-dd")}-to-${this.templatingEngine.formatDate(i,"yyyy-mm-dd")}.${s}`,a),showNotification(`Report downloaded as ${e.name}`,"success")},openReportInNewTab(){if(!this.currentReportData||0===this.currentReportEntries.length)return void showNotification("Please generate a report with data first","error");const t=document.getElementById("reportTemplate").value,e=this.getReportTemplates()[t],n=this.currentReportData.report.startDate,i=this.currentReportData.report.endDate,o=this.renderReport(e.template,this.currentReportData);let s=o,a="text/plain";"html"===e.type?(s=`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Activity Report ${this.templatingEngine.formatDate(n,"yyyy-mm-dd")} to ${this.templatingEngine.formatDate(i,"yyyy-mm-dd")}</title>\n    <style>\n        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }\n        table { border-collapse: collapse; width: 100%; margin: 1em 0; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #f2f2f2; }\n        h1, h2, h3 { color: #333; }\n        .hashtag { color: #38a169; font-weight: 500; }\n    </style>\n</head>\n<body>\n${o}\n</body>\n</html>`,a="text/html"):"markdown"===e.type?(s=`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Activity Report ${this.templatingEngine.formatDate(n,"yyyy-mm-dd")} to ${this.templatingEngine.formatDate(i,"yyyy-mm-dd")}</title>\n    <style>\n        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }\n        pre { white-space: pre-wrap; font-family: 'Monaco', 'Courier New', monospace; background: #f5f5f5; padding: 15px; border-radius: 5px; }\n    </style>\n</head>\n<body>\n    <pre>${o.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</pre>\n</body>\n</html>`,a="text/html"):"csv"===e.type&&(s=`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Activity Report ${this.templatingEngine.formatDate(n,"yyyy-mm-dd")} to ${this.templatingEngine.formatDate(i,"yyyy-mm-dd")}</title>\n    <style>\n        body { font-family: 'Monaco', 'Courier New', monospace; line-height: 1.4; max-width: 1200px; margin: 0 auto; padding: 20px; }\n        pre { white-space: pre-wrap; background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }\n    </style>\n</head>\n<body>\n    <h1>Activity Report (CSV Format)</h1>\n    <pre>${o.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</pre>\n</body>\n</html>`,a="text/html");try{const t=new Blob([s],{type:a}),e=URL.createObjectURL(t),n=window.open(e,"_blank");setTimeout(()=>{URL.revokeObjectURL(e)},1e3),n?showNotification("Report opened in new tab","success"):showNotification("Please allow popups for this site to open reports in new tabs","warning")}catch(t){console.error("Error opening report in new tab:",t),showNotification("Error opening report in new tab. Try downloading instead.","error")}},setWeeklyReport(){const t=new Date;this.currentWeekStart=getWeekStart(t),this.updateWeekFromCurrent(),this.generateReport()},previousWeek(){this.currentWeekStart||(this.currentWeekStart=getWeekStart(new Date)),this.currentWeekStart.setDate(this.currentWeekStart.getDate()-7),this.updateWeekFromCurrent(),this.generateReport()},nextWeek(){this.currentWeekStart||(this.currentWeekStart=getWeekStart(new Date)),this.currentWeekStart.setDate(this.currentWeekStart.getDate()+7),this.updateWeekFromCurrent(),this.generateReport()},updateWeekFromCurrent(){const t=new Date(this.currentWeekStart),e=getWeekEnd(t);document.getElementById("reportStartDate").value=t.toISOString().split("T")[0],document.getElementById("reportEndDate").value=e.toISOString().split("T")[0],this.updateWeekDisplay()},updateWeekDisplay(){if(!this.currentWeekStart)return;const t=new Date(this.currentWeekStart),e=getWeekEnd(t),n=`Week of ${t.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${e.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`;document.getElementById("weekDisplay").textContent=n}});let deferredPrompt,entryFormsVisible=!0,userStruggleTimeout=null;function createLatchClickSound(){const t=new(window.AudioContext||window.webkitAudioContext),e=.08,n=t.currentTime,i=t.createOscillator(),o=t.createGain();i.connect(o),o.connect(t.destination),i.frequency.setValueAtTime(800,n),i.frequency.exponentialRampToValueAtTime(200,n+.02),o.gain.setValueAtTime(.3,n),o.gain.exponentialRampToValueAtTime(.01,n+e);const s=t.createOscillator(),a=t.createGain();s.connect(a),a.connect(t.destination),s.frequency.setValueAtTime(1200,n+.01),s.frequency.exponentialRampToValueAtTime(400,n+.04),a.gain.setValueAtTime(.15,n+.01),a.gain.exponentialRampToValueAtTime(.01,n+e),i.start(n),i.stop(n+e),s.start(n+.01),s.stop(n+e)}function playLatchClick(){if(tracker&&tracker.settings&&!tracker.settings.muteSound)try{createLatchClickSound()}catch(t){}}function toggleEntryForm(t){const e=document.getElementById(`${t}EntryComponent`),n=document.getElementById(`${t}ToggleBtn${"tracker"===t?"":"2"}`);e&&n&&(entryFormsVisible=!entryFormsVisible,playLatchClick(),updateAllEntryForms(),clearStruggleHint(),entryFormsVisible&&setTimeout(()=>{const e="tracker"===t?"activity":"todo"===t?"todoActivity":"notesActivity",n=document.getElementById(e),i=document.getElementById(`${t}EntryComponent`);n&&i&&!i.classList.contains("collapsed")&&n.focus()},400))}function updateAllEntryForms(){["tracker","todo","notes"].forEach(t=>{const e=document.getElementById(`${t}EntryComponent`),n=document.getElementById(`${t}ToggleBtn${"tracker"===t?"":"2"}`);e&&n&&(entryFormsVisible?(e.classList.remove("collapsed"),n.classList.remove("hidden-form"),n.title="Hide entry form"):(e.classList.add("collapsed"),n.classList.add("hidden-form"),n.title="Show entry form"))})}function startStruggleDetection(){userStruggleTimeout&&clearTimeout(userStruggleTimeout),entryFormsVisible||(userStruggleTimeout=setTimeout(()=>{showStruggleHint()},1e4))}function showStruggleHint(){["tracker","todo","notes"].forEach(t=>{const e=document.getElementById(`${t}ToggleBtn${"tracker"===t?"":"2"}`);e&&!entryFormsVisible&&e.classList.add("glow-hint")}),setTimeout(()=>{clearStruggleHint()},5e3)}function clearStruggleHint(){userStruggleTimeout&&(clearTimeout(userStruggleTimeout),userStruggleTimeout=null),["tracker","todo","notes"].forEach(t=>{const e=document.getElementById(`${t}ToggleBtn${"tracker"===t?"":"2"}`);e&&e.classList.remove("glow-hint")})}function closePomodoroActivityModal(){const t=document.getElementById("pomodoroActivityModal");t&&(t.style.display="none",document.getElementById("pomodoroActivityForm").reset())}function showPomodoroActivityModal(){const t=document.getElementById("pomodoroActivityModal");t&&(t.style.display="block",updatePreviousActivityButton(),setTimeout(()=>{const t=document.getElementById("pomodoroActivityName");t&&t.focus()},100))}function togglePause(){if(tracker){const t=document.getElementById("pauseButton");if(t&&"Outside activity hours"===t.textContent)return void showActivityHoursInfo();if(t&&"All reminders disabled"===t.textContent){const t=document.querySelector(".notification-status");return void(t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="rgba(102, 126, 234, 0.1)",setTimeout(()=>{t.style.backgroundColor=""},3e3)))}tracker.togglePause()}}function showActivityHoursInfo(){const t=document.getElementById("activityHoursInfoModal");t&&(t.style.display="block")}function closeActivityHoursInfo(){const t=document.getElementById("activityHoursInfoModal");t&&(t.style.display="none")}function goToActivityHoursSettings(){closeActivityHoursInfo(),showSection("settings"),setTimeout(()=>{if(document.querySelector(".settings-section h3")){const t=document.querySelectorAll(".settings-section h3");for(let e of t)if(e.textContent.includes("Activity Schedule")||e.textContent.includes("Schedule")){e.scrollIntoView({behavior:"smooth",block:"start"}),e.parentElement.style.backgroundColor="rgba(102, 126, 234, 0.1)",setTimeout(()=>{e.parentElement.style.backgroundColor=""},3e3);break}}},200)}function togglePomodoro(){tracker&&tracker.pomodoroManager&&tracker.pomodoroManager.togglePomodoroFromButton()}function togglePomodoroPause(){tracker&&tracker.pomodoroManager&&tracker.pomodoroManager.togglePause()}function usePreviousActivity(){if(!tracker||!tracker.entries||0===tracker.entries.length)return void showNotification("No previous activities found","warning");let t=null;for(const e of tracker.entries){if("pomodoro"!==e.source){t=e;break}if(e.activity&&!e.activity.includes("break")&&!e.activity.includes("abandoned")){t=e;break}}if(!t)return void showNotification("No suitable previous activity found","warning");const e=document.getElementById("pomodoroActivityName"),n=document.getElementById("pomodoroActivityDescription");e&&(e.value=t.activity),n&&t.description&&(n.value=t.description),showNotification(`Using previous activity: "${t.activity}"`,"success")}function updatePreviousActivityButton(){const t=document.getElementById("usePreviousActivityBtn");if(!t)return;if(!tracker||!tracker.entries||0===tracker.entries.length)return t.disabled=!0,void(t.title="No previous activities available");let e=!1;for(const t of tracker.entries)if("pomodoro"!==t.source||t.activity&&!t.activity.includes("break")&&!t.activity.includes("abandoned")){e=!0;break}t.disabled=!e,t.title=e?"Fill form with your most recent activity":"No suitable previous activities available"}function showPomodoroAbandonDialog(){const t=document.getElementById("pomodoroAbandonModal");t&&(t.style.display="block",setTimeout(()=>{const t=document.getElementById("pomodoroAbandonActivityName");t&&t.focus()},100))}function closePomodoroAbandonDialog(){const t=document.getElementById("pomodoroAbandonModal");t&&(t.style.display="none",document.getElementById("pomodoroAbandonForm").reset())}function handlePomodoroAbandonmentSave(t){tracker&&tracker.pomodoroManager&&tracker.pomodoroManager.handleAbandonmentSave(t)}function resetPomodoroSessions(){tracker&&tracker.pomodoroManager?tracker.settings.warnOnSessionReset?showConfirmationDialog("Reset Session Counter","Are you sure you want to reset the Pomodoro session counter? This will start your session count back at 1.",t=>{if(t){tracker.settings.warnOnSessionReset=!1;const t=document.getElementById("warnOnSessionReset");t&&(t.value="false"),tracker.saveSettings()}tracker.pomodoroManager.resetSessionCounter()},{confirmText:"Reset",buttonClass:"btn-warning",allowSkip:!0}):tracker.pomodoroManager.resetSessionCounter():showNotification("Pomodoro manager not available","error")}function toggleEditTodo(){if(!tracker)return;const t=document.getElementById("editTodoButton");if(t){const e="true"===t.dataset.isTodo;tracker.setEditTodoButtonState(!e)}}function toggleEditNote(){if(!tracker)return;const t=document.getElementById("editNoteButton");if(t){const e="true"===t.dataset.isNote;tracker.setEditNoteButtonState(!e)}}function showConfirmationDialog(t,e,n,i={}){const o=document.getElementById("confirmationModal"),s=document.getElementById("confirmationTitle"),a=document.getElementById("confirmationMessage"),r=document.getElementById("confirmationConfirmBtn"),c=document.getElementById("confirmationSkipSection"),d=document.getElementById("confirmationSkipFuture");o&&s&&a&&r&&(s.textContent=t,a.textContent=e,r.textContent=i.confirmText||"Confirm",r.className=`btn ${i.buttonClass||"btn-danger"}`,i.allowSkip?(c.style.display="block",d.checked=!1):c.style.display="none",r.onclick=()=>{const t=d.checked;closeConfirmationDialog(),n(t)},o.style.display="block")}function closeConfirmationDialog(){const t=document.getElementById("confirmationModal");t&&(t.style.display="none")}function testPomodoroTick(t="soft"){tracker&&tracker.pomodoroManager?(tracker.pomodoroManager.settings.tickSound=t,tracker.pomodoroManager.playTickSound()):console.error("Tracker or Pomodoro Manager not available")}function saveReportTemplates(){tracker&&tracker.saveReportTemplates()}function resetReportTemplates(){tracker&&tracker.resetReportTemplates()}function exportDatabase(){tracker&&tracker.exportDatabase()}function importDatabase(){const t=document.getElementById("importFile");t&&t.click()}function handleImportFile(t){const e=t.target.files[0];if(!e)return;if("application/json"!==e.type&&!e.name.endsWith(".json"))return void showNotification("Please select a valid JSON backup file.","error");const n=new FileReader;n.onload=function(e){tracker&&tracker.importDatabase(e.target.result),t.target.value=""},n.onerror=function(){showNotification("Error reading backup file.","error"),t.target.value=""},n.readAsText(e)}function openTemplateManager(){tracker&&tracker.openTemplateManager()}function closeTemplateManager(){tracker&&tracker.closeTemplateManager()}function addNewTemplate(){tracker&&tracker.addNewTemplate()}function resetToDefaults(){tracker&&tracker.resetToDefaults()}function saveCurrentTemplate(){tracker&&tracker.saveCurrentTemplate()}function deleteCurrentTemplate(){tracker&&tracker.deleteCurrentTemplate()}function duplicateCurrentTemplate(){tracker&&tracker.duplicateCurrentTemplate()}function refreshTemplatePreview(){tracker&&tracker.refreshTemplatePreview()}function saveAllTemplates(){tracker&&tracker.saveAllTemplates()}function switchPreviewTab(t){tracker&&tracker.switchPreviewTab(t)}function switchReportPreviewTab(t){tracker&&tracker.switchReportPreviewTab(t)}function switchTemplateTab(t){tracker&&tracker.switchTemplateTab(t)}function formatBytes(t,e=2){if(0===t)return"0 B";const n=e<0?0:e,i=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,i)).toFixed(n))+" "+["B","KB","MB","GB","TB"][i]}async function runServiceWorkerTest(){tracker?openDiagnosticsModal():showNotification("Tracker not initialized","error")}async function openDiagnosticsModal(){const t=document.getElementById("swDiagnosticsModal"),e=document.getElementById("diagnosticsLoading"),n=document.getElementById("diagnosticsContent");t.style.display="block",e.style.display="flex",n.style.display="none";try{const t=await tracker.runServiceWorkerDiagnostics();renderDiagnosticsData(t),e.style.display="none",n.style.display="block",window.currentDiagnostics=t}catch(t){console.error("Diagnostic test failed:",t),n.innerHTML=`\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Error</div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Error Message:</span>\n                    <span class="diagnostics-value error">${t.message}</span>\n                </div>\n            </div>\n        `,e.style.display="none",n.style.display="block"}}function closeDiagnosticsModal(){document.getElementById("swDiagnosticsModal").style.display="none"}function refreshDiagnostics(){openDiagnosticsModal()}function copyDiagnosticsToClipboard(){if(!window.currentDiagnostics)return void showNotification("No diagnostics data available","error");const t=formatDiagnosticsAsText(window.currentDiagnostics);navigator.clipboard.writeText(t).then(()=>{showNotification("Diagnostics copied to clipboard!","success")}).catch(()=>{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),showNotification("Diagnostics copied to clipboard!","success")})}function renderDiagnosticsData(t){const e=document.getElementById("diagnosticsContent");let n="";if(n+=`\n        <div class="diagnostics-section">\n            <div class="diagnostics-header">Basic Information</div>\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Available:</span>\n                <span class="diagnostics-value ${t.available?"success":"error"}">${t.available}</span>\n            </div>\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Protocol:</span>\n                <span class="diagnostics-value">${t.protocol}</span>\n            </div>\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Platform:</span>\n                <span class="diagnostics-value">${t.platform}</span>\n            </div>\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">App Version:</span>\n                <span class="diagnostics-value">${APP_VERSION}</span>\n            </div>\n    `,t.registration?n+=`\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Registration:</span>\n                <span class="diagnostics-value success">Active</span>\n            </div>\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Scope:</span>\n                <span class="diagnostics-value">${t.registration.scope}</span>\n            </div>\n        `:n+='\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Registration:</span>\n                <span class="diagnostics-value error">None</span>\n            </div>\n        ',t.controller?n+=`\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Controller:</span>\n                <span class="diagnostics-value success">Active (${t.controller.state})</span>\n            </div>\n        `:n+='\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Controller:</span>\n                <span class="diagnostics-value error">None</span>\n            </div>\n        ',t.communication&&(n+=`\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">Communication:</span>\n                <span class="diagnostics-value ${"Working"===t.communication?"success":"error"}">${t.communication}</span>\n            </div>\n        `),t.swVersion&&(n+=`\n            <div class="diagnostics-item">\n                <span class="diagnostics-label">SW Version:</span>\n                <span class="diagnostics-value">${t.swVersion}</span>\n            </div>\n        `),n+="</div>",t.comprehensive){const e=t.comprehensive;n+=`\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Performance</div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">State:</span>\n                    <span class="diagnostics-value">${e.state}</span>\n                </div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Update Via Cache:</span>\n                    <span class="diagnostics-value">${e.updateViaCache}</span>\n                </div>\n        `,e.performance&&(n+=`\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Uptime:</span>\n                    <span class="diagnostics-value">${Math.round(e.performance.uptime/1e3)}s</span>\n                </div>\n            `),n+="</div>",n+=`\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Cache Statistics</div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Cache Count:</span>\n                    <span class="diagnostics-value">${e.caches?.count||0}</span>\n                </div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Total Cache Size:</span>\n                    <span class="diagnostics-value">${formatBytes(e.totalCacheSize||0)}</span>\n                </div>\n        `,e.cacheStats&&Object.entries(e.cacheStats).forEach(([t,e])=>{e.error||(n+=`\n                        <div class="diagnostics-subitem">\n                            <span class="diagnostics-label">${t}:</span>\n                            <span class="diagnostics-value">${e.keyCount} items, ${formatBytes(e.size)}</span>\n                        </div>\n                    `)}),n+="</div>",n+=`\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Client Information</div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Connected Clients:</span>\n                    <span class="diagnostics-value">${e.clients?.count||0}</span>\n                </div>\n        `,e.clients?.types&&Object.entries(e.clients.types).forEach(([t,e])=>{n+=`\n                    <div class="diagnostics-subitem">\n                        <span class="diagnostics-label">${t}:</span>\n                        <span class="diagnostics-value">${e}</span>\n                    </div>\n                `}),n+="</div>",n+='\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Event Statistics</div>\n        ',e.events&&(n+=`\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Fetch Requests:</span>\n                    <span class="diagnostics-value">${e.events.fetchRequests}</span>\n                </div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Notification Clicks:</span>\n                    <span class="diagnostics-value">${e.events.notificationClicks}</span>\n                </div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Push Messages:</span>\n                    <span class="diagnostics-value">${e.events.pushMessages}</span>\n                </div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Messages:</span>\n                    <span class="diagnostics-value">${e.events.messagesSent}</span>\n                </div>\n            `),n+="</div>",n+='\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Storage Information</div>\n        ',e.storage&&e.storage.quota?(n+=`\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Storage Used:</span>\n                    <span class="diagnostics-value">${formatBytes(e.storage.usage)} / ${formatBytes(e.storage.quota)} (${e.storage.percentUsed}%)</span>\n                </div>\n            `,e.storage.usageDetails&&Object.entries(e.storage.usageDetails).forEach(([t,e])=>{n+=`\n                        <div class="diagnostics-subitem">\n                            <span class="diagnostics-label">${t}:</span>\n                            <span class="diagnostics-value">${formatBytes(e)}</span>\n                        </div>\n                    `})):n+='\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Storage Info:</span>\n                    <span class="diagnostics-value warning">Not available</span>\n                </div>\n            ',n+="</div>",n+='\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Browser Capabilities</div>\n        ',e.capabilities&&Object.entries(e.capabilities).forEach(([t,e])=>{n+=`\n                    <div class="diagnostics-item">\n                        <span class="diagnostics-label">${t.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase())}:</span>\n                        <span class="diagnostics-value ${e?"success":"warning"}">${e?"":""}</span>\n                    </div>\n                `}),n+="</div>",e.timestamp&&(n+=`\n                <div class="diagnostics-section">\n                    <div class="diagnostics-header">Timestamp</div>\n                    <div class="diagnostics-item">\n                        <span class="diagnostics-label">Generated:</span>\n                        <span class="diagnostics-value">${new Date(e.timestamp).toLocaleString()}</span>\n                    </div>\n                </div>\n            `)}t.error&&(n+=`\n            <div class="diagnostics-section">\n                <div class="diagnostics-header">Errors</div>\n                <div class="diagnostics-item">\n                    <span class="diagnostics-label">Error:</span>\n                    <span class="diagnostics-value error">${t.error}</span>\n                </div>\n            </div>\n        `),e.innerHTML=n}function formatDiagnosticsAsText(t){let e="Service Worker Diagnostics\n\n";if(e+="=== BASIC INFO ===\n",e+=`Available: ${t.available}\n`,e+=`Protocol: ${t.protocol}\n`,e+=`Platform: ${t.platform}\n`,e+=`App Version: ${APP_VERSION}\n`,t.registration?(e+="Registration: Active\n",e+=`Scope: ${t.registration.scope}\n`):e+="Registration: None\n",t.controller?e+=`Controller: Active (${t.controller.state})\n`:e+="Controller: None\n",t.communication&&(e+=`Communication: ${t.communication}\n`),t.swVersion&&(e+=`SW Version: ${t.swVersion}\n`),t.comprehensive){const n=t.comprehensive;e+="\n=== PERFORMANCE ===\n",e+=`State: ${n.state}\n`,e+=`Update Via Cache: ${n.updateViaCache}\n`,n.performance&&(e+=`Uptime: ${Math.round(n.performance.uptime/1e3)}s\n`),e+="\n=== CACHE STATISTICS ===\n",e+=`Cache Count: ${n.caches?.count||0}\n`,e+=`Total Cache Size: ${formatBytes(n.totalCacheSize||0)}\n`,n.cacheStats&&Object.entries(n.cacheStats).forEach(([t,n])=>{n.error||(e+=`   ${t}: ${n.keyCount} items, ${formatBytes(n.size)}\n`)}),e+="\n=== CLIENT INFO ===\n",e+=`Connected Clients: ${n.clients?.count||0}\n`,n.clients?.types&&Object.entries(n.clients.types).forEach(([t,n])=>{e+=`   ${t}: ${n}\n`}),e+="\n=== EVENT STATISTICS ===\n",n.events&&(e+=`Fetch Requests: ${n.events.fetchRequests}\n`,e+=`Notification Clicks: ${n.events.notificationClicks}\n`,e+=`Push Messages: ${n.events.pushMessages}\n`,e+=`Messages: ${n.events.messagesSent}\n`),e+="\n=== STORAGE INFO ===\n",n.storage&&n.storage.quota?(e+=`Storage Used: ${formatBytes(n.storage.usage)} / ${formatBytes(n.storage.quota)} (${n.storage.percentUsed}%)\n`,n.storage.usageDetails&&Object.entries(n.storage.usageDetails).forEach(([t,n])=>{e+=`   ${t}: ${formatBytes(n)}\n`})):e+="Storage Info: Not available\n",e+="\n=== CAPABILITIES ===\n",n.capabilities&&Object.entries(n.capabilities).forEach(([t,n])=>{e+=`${t}: ${n?"":""}\n`}),n.timestamp&&(e+=`\nGenerated: ${new Date(n.timestamp).toLocaleString()}\n`)}return t.error&&(e+=`\n=== ERRORS ===\n${t.error}\n`),e}function initializeUIState(){const t=document.getElementById("dueDateSection");t&&(t.style.display="none");const e=document.getElementById("editDueDateSection");e&&(e.style.display="none")}function initializeEntryFormToggle(){updateAllEntryForms(),["click","scroll","keydown","mousemove"].forEach(t=>{document.addEventListener(t,()=>{clearStruggleHint(),startStruggleDetection()},{passive:!0})}),startStruggleDetection()}function scheduleRepositioning(){requestAnimationFrame(positionBurgerMenu)}function toggleBurgerMenu(){const t=document.getElementById("burgerDropdown");t&&(t.style.display="none"===t.style.display?"block":"none")}function closeBurgerMenu(){const t=document.getElementById("burgerDropdown");t&&(t.style.display="none")}function toggleScheduleMode(){const t=document.getElementById("useComplexSchedule").checked,e=document.getElementById("simpleSchedule"),n=document.getElementById("complexSchedule");t?(e.style.display="none",n.style.display="block",populateComplexSchedule()):(e.style.display="block",n.style.display="none"),tracker.settings.useComplexSchedule=t,saveSettings()}function populateComplexSchedule(){["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(t=>{const e=document.getElementById(`${t}-ranges`),n=tracker.settings.complexSchedule[t]||[];e.innerHTML="",0===n.length?e.innerHTML='<div class="empty-schedule">No activity hours set for this day</div>':n.forEach((e,n)=>{addTimeRangeElement(t,e.start,e.end,n)})})}function addTimeRange(t){const e=tracker.settings.complexSchedule[t]||[],n={start:"09:00",end:"17:00"};e.push(n),tracker.settings.complexSchedule[t]=e,saveSettings();const i=document.getElementById(`${t}-ranges`);i.querySelector(".empty-schedule")&&(i.innerHTML=""),addTimeRangeElement(t,n.start,n.end,e.length-1)}function addTimeRangeElement(t,e,n,i){const o=document.getElementById(`${t}-ranges`),s=document.createElement("div");s.className="time-range",s.dataset.index=i,s.innerHTML=`\n        <input type="time" value="${e}" onchange="updateTimeRange('${t}', ${i}, 'start', this.value)">\n        <span class="range-separator">to</span>\n        <input type="time" value="${n}" onchange="updateTimeRange('${t}', ${i}, 'end', this.value)">\n        <button type="button" class="remove-range" onclick="removeTimeRange('${t}', ${i})" title="Remove this time range"></button>\n    `,o.appendChild(s)}function updateTimeRange(t,e,n,i){const o=tracker.settings.complexSchedule[t]||[];o[e]&&(o[e][n]=i,tracker.settings.complexSchedule[t]=o,saveSettings())}function removeTimeRange(t,e){const n=tracker.settings.complexSchedule[t]||[];n.splice(e,1),tracker.settings.complexSchedule[t]=n,saveSettings();const i=document.getElementById(`${t}-ranges`);i.innerHTML="",0===n.length?i.innerHTML='<div class="empty-schedule">No activity hours set for this day</div>':n.forEach((e,n)=>{addTimeRangeElement(t,e.start,e.end,n)})}function openWorkspaceManager(){const t=document.getElementById("workspaceManagerModal");if(t&&tracker){const e=document.getElementById("currentWorkspaceName");e&&(e.textContent=tracker.currentWorkspace),populateWorkspaceList(),t.style.display="block"}}function closeWorkspaceManager(){const t=document.getElementById("workspaceManagerModal");t&&(t.style.display="none");const e=document.getElementById("newWorkspaceName");e&&(e.value="")}function populateWorkspaceList(){const t=document.getElementById("workspaceList");if(!t||!tracker)return;const e=tracker.getWorkspaceNames();if(0===e.length)return void(t.innerHTML='<p class="empty-state">No workspaces found.</p>');let n="";e.forEach(t=>{const e=t===tracker.currentWorkspace,i="Default"===t;n+=`<div class="workspace-item ${e?"current":""}">\n            <div class="workspace-info">\n                <span class="workspace-name">${t}</span>\n                ${e?'<span class="current-badge">Current</span>':""}\n            </div>\n            <div class="workspace-actions">\n                ${e?"":`<button class="btn btn-small btn-primary" onclick="switchToWorkspace('${t}')">Switch</button>`}\n                ${i||e?"":`<button class="btn btn-small btn-secondary" onclick="renameWorkspacePrompt('${t}')">Rename</button>`}\n                ${i||e?"":`<button class="btn btn-small btn-danger" onclick="deleteWorkspacePrompt('${t}')">Delete</button>`}\n            </div>\n        </div>`}),t.innerHTML=n}function createNewWorkspace(){const t=document.getElementById("newWorkspaceName");if(!t||!tracker)return;const e=t.value.trim();e?tracker.createWorkspace(e)&&(t.value="",populateWorkspaceList()):alert("Please enter a workspace name")}function switchToWorkspace(t){if(!tracker)return;tracker.switchWorkspace(t);const e=document.getElementById("currentWorkspaceName");e&&(e.textContent=t),populateWorkspaceList()}function renameWorkspacePrompt(t){const e=prompt(`Rename workspace "${t}" to:`,t);if(e&&e.trim()&&e.trim()!==t&&tracker&&tracker.renameWorkspace(t,e.trim())){populateWorkspaceList();const t=document.getElementById("currentWorkspaceName");t&&tracker.currentWorkspace===e.trim()&&(t.textContent=e.trim())}}function deleteWorkspacePrompt(t){confirm(`Are you sure you want to delete workspace "${t}"?\n\nThis action cannot be undone and will permanently delete all activities and settings in this workspace.`)&&tracker&&tracker.deleteWorkspace(t)&&populateWorkspaceList()}function checkForUpdatesManually(){if(tracker)try{const t=localStorage.getItem("lastVersionCheck");localStorage.removeItem("lastVersionCheck"),showNotification("Checking for updates...","info",2e3),tracker.checkForUpdates(!0).then(()=>{setTimeout(()=>{document.getElementById("updateBanner")||showNotification("You're running the latest version!","success",3e3)},500),t&&!document.getElementById("updateBanner")&&localStorage.setItem("lastVersionCheck",t)}).catch(e=>{console.warn("Manual version check failed:",e),t&&localStorage.setItem("lastVersionCheck",t),showNotification("Unable to check for updates. Please try again later.","error",4e3)})}catch(t){console.error("Error in checkForUpdatesManually:",t),showNotification("Error checking for updates. Please try again.","error",3e3)}else showNotification("App not ready. Please try again in a moment.","error",3e3)}document.addEventListener("DOMContentLoaded",()=>{if(initializeUIState(),initializeEntryFormToggle(),tracker=new ActivityTracker,tracker.initializeVersionChecking(),window.addEventListener("beforeunload",()=>{tracker&&tracker.stopVersionChecking()}),initializeFormTimestamps(),"serviceWorker"in navigator){if("file:"===window.location.protocol);else{const t=APP_VERSION;navigator.serviceWorker.register(`./sw.js?v=${t}`).then(t=>{t.addEventListener("updatefound",()=>{const e=t.installing;e&&e.addEventListener("statechange",()=>{if("installed"===e.state&&navigator.serviceWorker.controller){const t=showNotification('App updated! <button onclick="window.location.reload(); event.stopPropagation();" class="refresh-btn">Refresh Now</button>',"info",15e3);setTimeout(()=>{const e=document.querySelector(`[data-notification-id="${t}"]`);e&&(e.onclick=t=>{t.target.classList.contains("refresh-btn")||window.location.reload()})},100)}})}),tracker&&tracker.updateDebugInfo()}).catch(t=>{console.error("Service Worker registration failed:",t),navigator.platform.includes("Mac")&&"SecurityError"===t.name&&(console.warn("macOS Security Error: This may be due to strict security settings"),console.warn("Try serving over HTTP/HTTPS instead of file://")),tracker&&tracker.updateDebugInfo()})}navigator.serviceWorker.addEventListener("message",t=>{if(t.data&&"add-entry"===t.data.type&&tracker&&(tracker.addEntry(t.data.entry),showNotification("Activity logged from notification!","success")),t.data&&"navigate-to-tracker"===t.data.type){showSection("tracker");const e=()=>{if(document.hidden){const t=()=>{document.hidden||(document.removeEventListener("visibilitychange",t),setTimeout(e,100))};return void document.addEventListener("visibilitychange",t)}const t=document.getElementById("activity");if(t){void 0===entryFormsVisible||entryFormsVisible||(entryFormsVisible=!0,"function"==typeof updateAllEntryForms&&updateAllEntryForms());try{t.focus()}catch(t){console.warn("Failed to focus activity input:",t)}}};setTimeout(e,"notification-click"===t.data.source?200:100)}if(t.data&&"populate-activity-input"===t.data.type){showSection("tracker");const e=()=>{if(document.hidden){const t=()=>{document.hidden||(document.removeEventListener("visibilitychange",t),setTimeout(e,100))};return void document.addEventListener("visibilitychange",t)}const n=document.getElementById("activity");if(n&&t.data.text){n.value=t.data.text;try{n.focus(),n.select(),showNotification("Activity text populated from notification!","success")}catch(t){console.warn("Failed to focus/select activity input:",t),showNotification("Activity text populated from notification!","success")}}};setTimeout(e,"notification-action"===t.data.source?300:100)}}),navigator.serviceWorker.addEventListener("controllerchange",()=>{tracker&&tracker.updateDebugInfo()})}"#tracker"===window.location.hash&&(showSection("tracker"),setTimeout(()=>{const t=document.getElementById("activity");t&&(void 0===entryFormsVisible||entryFormsVisible||(entryFormsVisible=!0,"function"==typeof updateAllEntryForms&&updateAllEntryForms()),t.focus())},200),history.replaceState(null,document.title,window.location.pathname+window.location.search)),positionBurgerMenu()}),window.addEventListener("resize",()=>{positionBurgerMenu()}),window.addEventListener("focus",()=>{setTimeout(positionBurgerMenu,10)}),document.addEventListener("visibilitychange",()=>{document.hidden||setTimeout(positionBurgerMenu,10)}),window.addEventListener("orientationchange",()=>{setTimeout(positionBurgerMenu,100)}),window.ResizeObserver&&new ResizeObserver(()=>{scheduleRepositioning()}).observe(document.body),document.addEventListener("click",t=>{t.target.classList.contains("modal")&&("templateGuideModal"===t.target.id?closeTemplateGuide():"aboutModal"===t.target.id?closeAbout():"pomodoroActivityModal"===t.target.id?closePomodoroActivityModal():"pomodoroAbandonModal"===t.target.id?closePomodoroAbandonDialog():"confirmationModal"===t.target.id?closeConfirmationDialog():"hashtagBrowserModal"===t.target.id?closeHashtagBrowser():"userGuideModal"===t.target.id?closeUserGuide():closeEditModal()),t.target.closest(".reschedule-dropdown")||document.querySelectorAll(".reschedule-options").forEach(t=>{t.style.display="none"})}),document.addEventListener("keydown",t=>{if("Escape"===t.key){const t=document.getElementById("templateGuideModal"),e=document.getElementById("aboutModal"),n=document.getElementById("editModal"),i=document.getElementById("pomodoroActivityModal"),o=document.getElementById("pomodoroAbandonModal"),s=document.getElementById("confirmationModal"),a=document.getElementById("hashtagBrowserModal"),r=document.getElementById("userGuideModal"),c=document.getElementById("activityHoursInfoModal");t&&"block"===t.style.display?closeTemplateGuide():e&&"block"===e.style.display?closeAbout():i&&"block"===i.style.display?closePomodoroActivityModal():o&&"block"===o.style.display?closePomodoroAbandonDialog():s&&"block"===s.style.display?closeConfirmationDialog():a&&"block"===a.style.display?closeHashtagBrowser():r&&"block"===r.style.display?closeUserGuide():c&&"block"===c.style.display?closeActivityHoursInfo():document.getElementById("overdueAlertModal")&&"block"===document.getElementById("overdueAlertModal").style.display?closeOverdueAlert():n&&"block"===n.style.display&&closeEditModal()}if(t.shiftKey&&"Enter"===t.key){const e=document.activeElement;if(!e||"activity"!==e.id&&"description"!==e.id)if(!e||"todoActivity"!==e.id&&"todoDescription"!==e.id)if(!e||"notesActivity"!==e.id&&"notesDescription"!==e.id){if(e&&("editActivity"===e.id||"editDescription"===e.id||"editTimestamp"===e.id)){t.preventDefault();const e=document.getElementById("editForm");e&&e.dispatchEvent(new Event("submit"))}}else{t.preventDefault();const e=document.getElementById("notesActivityForm");e&&e.dispatchEvent(new Event("submit"))}else{t.preventDefault();const e=document.getElementById("todoActivityForm");e&&e.dispatchEvent(new Event("submit"))}else{t.preventDefault();const e=document.getElementById("activityForm");e&&e.dispatchEvent(new Event("submit"))}return}if(t.shiftKey&&" "===t.key){const e=document.activeElement;if(e&&("description"===e.id||"editDescription"===e.id))return;return t.preventDefault(),entryFormsVisible||(entryFormsVisible=!0,playLatchClick(),updateAllEntryForms(),clearStruggleHint()),void setTimeout(()=>{const t=document.getElementById("activity"),e=document.getElementById("trackerEntryComponent");showSection("tracker"),t&&e&&!e.classList.contains("collapsed")&&t.focus()},entryFormsVisible?0:400)}if((t.ctrlKey||t.metaKey)&&"t"===t.key){const e=document.activeElement;return!e||"activity"!==e.id&&"description"!==e.id||(t.preventDefault(),toggleTodoMode()),void(!e||"editActivity"!==e.id&&"editDescription"!==e.id&&"editTimestamp"!==e.id||(t.preventDefault(),toggleEditTodo()))}if((t.ctrlKey||t.metaKey)&&"n"===t.key){const e=document.activeElement;return!e||"activity"!==e.id&&"description"!==e.id||(t.preventDefault(),toggleNoteMode()),void(!e||"editActivity"!==e.id&&"editDescription"!==e.id&&"editTimestamp"!==e.id||(t.preventDefault(),toggleEditNote()))}if((t.ctrlKey||t.metaKey)&&"Enter"===t.key){const t=document.activeElement;if(t&&("activity"===t.id||"description"===t.id)){const t=document.getElementById("activityForm");t&&t.dispatchEvent(new Event("submit"))}if(t&&("editActivity"===t.id||"editDescription"===t.id||"editTimestamp"===t.id)){const t=document.getElementById("editForm");t&&t.dispatchEvent(new Event("submit"))}if(t&&("pomodoroActivityName"===t.id||"pomodoroActivityDescription"===t.id)){const t=document.getElementById("pomodoroActivityForm");t&&t.dispatchEvent(new Event("submit"))}}}),document.addEventListener("visibilitychange",()=>{tracker&&(document.hidden||tracker.updateDebugInfo())}),window.addEventListener("online",()=>{showNotification("Connection restored","success")}),window.addEventListener("offline",()=>{showNotification("Working offline","info")}),window.addEventListener("beforeunload",t=>{tracker&&tracker.pauseManager&&tracker.pauseManager.destroy();const e=document.getElementById("activity");if(e&&e.value.trim())return t.preventDefault(),t.returnValue="You have unsaved activity data. Are you sure you want to leave?",t.returnValue}),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),deferredPrompt=t,showNotification("This app can be installed on your device!","info")}),window.addEventListener("appinstalled",()=>{showNotification("Activity Tracker installed successfully!","success"),deferredPrompt=null}),window.addEventListener("error",t=>{console.error("Uncaught error:",t.error),showNotification("An unexpected error occurred. Please refresh the page.","error")}),window.addEventListener("unhandledrejection",t=>{console.error("Unhandled promise rejection:",t.reason),t.reason&&(t.reason.message?.includes("version")||t.reason.message?.includes("fetch")||t.reason.message?.includes("network")||t.reason.message?.includes("update"))?t.preventDefault():showNotification("An unexpected error occurred. Please refresh the page.","error")}),window.addEventListener("load",()=>{if(window.performance&&window.performance.timing){const t=window.performance.timing;t.loadEventEnd,t.navigationStart}}),document.addEventListener("click",t=>{const e=document.querySelector(".burger-menu"),n=document.getElementById("burgerDropdown");e&&n&&!e.contains(t.target)&&(n.style.display="none")}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("newWorkspaceName");t&&t.addEventListener("keypress",t=>{"Enter"===t.key&&createNewWorkspace()})}),"undefined"!=typeof module&&module.exports&&(module.exports={showSection:showSection,addCurrentTime:addCurrentTime,generateReport:generateReport,setWeeklyReport:setWeeklyReport,previousWeek:previousWeek,nextWeek:nextWeek,downloadReport:downloadReport,openReportInNewTab:openReportInNewTab,saveSettings:saveSettings,enableNotifications:enableNotifications,testNotification:testNotification,testNotificationSound:testNotificationSound,refreshNotificationStatus:refreshNotificationStatus,clearAllData:clearAllData,closeEditModal:closeEditModal,togglePause:togglePause,exportDatabase:exportDatabase,importDatabase:importDatabase,handleImportFile:handleImportFile,runServiceWorkerTest:runServiceWorkerTest,previewNotificationSound:previewNotificationSound,showTemplateGuide:showTemplateGuide,closeTemplateGuide:closeTemplateGuide,showAbout:showAbout,closeAbout:closeAbout,updateCopyrightYear:updateCopyrightYear,requestNotificationPermission:requestNotificationPermission,declineNotificationPermission:declineNotificationPermission,forceEnableNotifications:forceEnableNotifications,copyReportToClipboard:copyReportToClipboard,toggleBurgerMenu:toggleBurgerMenu,closeBurgerMenu:closeBurgerMenu,resetActivityForm:resetActivityForm,resetTodoForm:resetTodoForm,resetNotesForm:resetNotesForm,adjustDueDate:adjustDueDate,updateDueDateSectionVisibility:updateDueDateSectionVisibility,openWorkspaceManager:openWorkspaceManager,closeWorkspaceManager:closeWorkspaceManager,createNewWorkspace:createNewWorkspace,switchToWorkspace:switchToWorkspace,renameWorkspacePrompt:renameWorkspacePrompt,deleteWorkspacePrompt:deleteWorkspacePrompt,toggleScheduleMode:toggleScheduleMode,addTimeRange:addTimeRange,updateTimeRange:updateTimeRange,removeTimeRange:removeTimeRange,checkForUpdatesManually:checkForUpdatesManually}),"undefined"!=typeof window&&(window.resetActivityForm=resetActivityForm,window.resetTodoForm=resetTodoForm,window.resetNotesForm=resetNotesForm,window.adjustDueDate=adjustDueDate,window.updateDueDateSectionVisibility=updateDueDateSectionVisibility,window.openWorkspaceManager=openWorkspaceManager,window.closeWorkspaceManager=closeWorkspaceManager,window.createNewWorkspace=createNewWorkspace,window.switchToWorkspace=switchToWorkspace,window.renameWorkspacePrompt=renameWorkspacePrompt,window.deleteWorkspacePrompt=deleteWorkspacePrompt,window.toggleScheduleMode=toggleScheduleMode,window.addTimeRange=addTimeRange,window.updateTimeRange=updateTimeRange,window.removeTimeRange=removeTimeRange,window.checkForUpdatesManually=checkForUpdatesManually,window.openDiagnosticsModal=openDiagnosticsModal,window.closeDiagnosticsModal=closeDiagnosticsModal,window.refreshDiagnostics=refreshDiagnostics,window.copyDiagnosticsToClipboard=copyDiagnosticsToClipboard);</script></body></html>